import{r as O,j as f,a as cl,R as yg}from"./index-BW_4U9Iv.js";import{c as Ie,C as Sn,b as vg,z as X,a as md,s as wg,t as bg,l as Eg,u as xg,F as Tg}from"./useTheme-2Y53t6bE.js";const Ig=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Cg=Ie("arrow-left",Ig);const Ag=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ti=Ie("arrow-right",Ag);const Sg=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Oi=Ie("chevron-down",Sg);const Rg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],uu=Ie("circle-alert",Rg);const Ng=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],hu=Ie("circle-question-mark",Ng);const kg=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Pg=Ie("copy",kg);const Dg=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Vg=Ie("ellipsis-vertical",Dg);const Mg=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],Og=Ie("flag",Mg);const Lg=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],du=Ie("history",Lg);const jg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ii=Ie("info",jg);const Fg=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Ug=Ie("list",Fg);const Bg=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],$i=Ie("loader-circle",Bg);const zg=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],qg=Ie("mail",zg);const $g=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],la=Ie("message-square",$g);const Gg=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Wg=Ie("power",Gg);const Hg=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],pd=Ie("refresh-cw",Hg);const Kg=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Qg=Ie("send",Kg);const Yg=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Xg=Ie("settings",Yg);const Jg=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],Zg=Ie("text-align-start",Jg);const e_=[["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}],["path",{d:"M17 14V2",key:"8ymqnk"}]],t_=Ie("thumbs-down",e_);const n_=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],gd=Ie("thumbs-up",n_);const s_=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],r_=Ie("trash",s_);const i_=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],fu=Ie("user",i_);const o_=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],bo=Ie("x",o_);function _d(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=_d(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function a_(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=_d(n))&&(s&&(s+=" "),s+=e);return s}const l_=(n,e)=>{const t=new Array(n.length+e.length);for(let s=0;s<n.length;s++)t[s]=n[s];for(let s=0;s<e.length;s++)t[n.length+s]=e[s];return t},c_=(n,e)=>({classGroupId:n,validator:e}),yd=(n=new Map,e=null,t)=>({nextPart:n,validators:e,classGroupId:t}),Gi="-",mu=[],u_="arbitrary..",h_=n=>{const e=f_(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:s}=n;return{getClassGroupId:o=>{if(o.startsWith("[")&&o.endsWith("]"))return d_(o);const l=o.split(Gi),c=l[0]===""&&l.length>1?1:0;return vd(l,c,e)},getConflictingClassGroupIds:(o,l)=>{if(l){const c=s[o],h=t[o];return c?h?l_(h,c):c:h||mu}return t[o]||mu}}},vd=(n,e,t)=>{if(n.length-e===0)return t.classGroupId;const r=n[e],i=t.nextPart.get(r);if(i){const h=vd(n,e+1,i);if(h)return h}const o=t.validators;if(o===null)return;const l=e===0?n.join(Gi):n.slice(e).join(Gi),c=o.length;for(let h=0;h<c;h++){const m=o[h];if(m.validator(l))return m.classGroupId}},d_=n=>n.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=n.slice(1,-1),t=e.indexOf(":"),s=e.slice(0,t);return s?u_+s:void 0})(),f_=n=>{const{theme:e,classGroups:t}=n;return m_(t,e)},m_=(n,e)=>{const t=yd();for(const s in n){const r=n[s];ul(r,t,s,e)}return t},ul=(n,e,t,s)=>{const r=n.length;for(let i=0;i<r;i++){const o=n[i];p_(o,e,t,s)}},p_=(n,e,t,s)=>{if(typeof n=="string"){g_(n,e,t);return}if(typeof n=="function"){__(n,e,t,s);return}y_(n,e,t,s)},g_=(n,e,t)=>{const s=n===""?e:wd(e,n);s.classGroupId=t},__=(n,e,t,s)=>{if(v_(n)){ul(n(s),e,t,s);return}e.validators===null&&(e.validators=[]),e.validators.push(c_(t,n))},y_=(n,e,t,s)=>{const r=Object.entries(n),i=r.length;for(let o=0;o<i;o++){const[l,c]=r[o];ul(c,wd(e,l),t,s)}},wd=(n,e)=>{let t=n;const s=e.split(Gi),r=s.length;for(let i=0;i<r;i++){const o=s[i];let l=t.nextPart.get(o);l||(l=yd(),t.nextPart.set(o,l)),t=l}return t},v_=n=>"isThemeGetter"in n&&n.isThemeGetter===!0,w_=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),s=Object.create(null);const r=(i,o)=>{t[i]=o,e++,e>n&&(e=0,s=t,t=Object.create(null))};return{get(i){let o=t[i];if(o!==void 0)return o;if((o=s[i])!==void 0)return r(i,o),o},set(i,o){i in t?t[i]=o:r(i,o)}}},Aa="!",pu=":",b_=[],gu=(n,e,t,s,r)=>({modifiers:n,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:s,isExternal:r}),E_=n=>{const{prefix:e,experimentalParseClassName:t}=n;let s=r=>{const i=[];let o=0,l=0,c=0,h;const m=r.length;for(let R=0;R<m;R++){const k=r[R];if(o===0&&l===0){if(k===pu){i.push(r.slice(c,R)),c=R+1;continue}if(k==="/"){h=R;continue}}k==="["?o++:k==="]"?o--:k==="("?l++:k===")"&&l--}const p=i.length===0?r:r.slice(c);let y=p,T=!1;p.endsWith(Aa)?(y=p.slice(0,-1),T=!0):p.startsWith(Aa)&&(y=p.slice(1),T=!0);const N=h&&h>c?h-c:void 0;return gu(i,T,y,N)};if(e){const r=e+pu,i=s;s=o=>o.startsWith(r)?i(o.slice(r.length)):gu(b_,!1,o,void 0,!0)}if(t){const r=s;s=i=>t({className:i,parseClassName:r})}return s},x_=n=>{const e=new Map;return n.orderSensitiveModifiers.forEach((t,s)=>{e.set(t,1e6+s)}),t=>{const s=[];let r=[];for(let i=0;i<t.length;i++){const o=t[i],l=o[0]==="[",c=e.has(o);l||c?(r.length>0&&(r.sort(),s.push(...r),r=[]),s.push(o)):r.push(o)}return r.length>0&&(r.sort(),s.push(...r)),s}},T_=n=>({cache:w_(n.cacheSize),parseClassName:E_(n),sortModifiers:x_(n),...h_(n)}),I_=/\s+/,C_=(n,e)=>{const{parseClassName:t,getClassGroupId:s,getConflictingClassGroupIds:r,sortModifiers:i}=e,o=[],l=n.trim().split(I_);let c="";for(let h=l.length-1;h>=0;h-=1){const m=l[h],{isExternal:p,modifiers:y,hasImportantModifier:T,baseClassName:N,maybePostfixModifierPosition:R}=t(m);if(p){c=m+(c.length>0?" "+c:c);continue}let k=!!R,q=s(k?N.substring(0,R):N);if(!q){if(!k){c=m+(c.length>0?" "+c:c);continue}if(q=s(N),!q){c=m+(c.length>0?" "+c:c);continue}k=!1}const W=y.length===0?"":y.length===1?y[0]:i(y).join(":"),H=T?W+Aa:W,z=H+q;if(o.indexOf(z)>-1)continue;o.push(z);const ue=r(q,k);for(let B=0;B<ue.length;++B){const b=ue[B];o.push(H+b)}c=m+(c.length>0?" "+c:c)}return c},A_=(...n)=>{let e=0,t,s,r="";for(;e<n.length;)(t=n[e++])&&(s=bd(t))&&(r&&(r+=" "),r+=s);return r},bd=n=>{if(typeof n=="string")return n;let e,t="";for(let s=0;s<n.length;s++)n[s]&&(e=bd(n[s]))&&(t&&(t+=" "),t+=e);return t},S_=(n,...e)=>{let t,s,r,i;const o=c=>{const h=e.reduce((m,p)=>p(m),n());return t=T_(h),s=t.cache.get,r=t.cache.set,i=l,l(c)},l=c=>{const h=s(c);if(h)return h;const m=C_(c,t);return r(c,m),m};return i=o,(...c)=>i(A_(...c))},R_=[],Be=n=>{const e=t=>t[n]||R_;return e.isThemeGetter=!0,e},Ed=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,xd=/^\((?:(\w[\w-]*):)?(.+)\)$/i,N_=/^\d+\/\d+$/,k_=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,P_=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,D_=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,V_=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,M_=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,gs=n=>N_.test(n),te=n=>!!n&&!Number.isNaN(Number(n)),_n=n=>!!n&&Number.isInteger(Number(n)),ca=n=>n.endsWith("%")&&te(n.slice(0,-1)),Xt=n=>k_.test(n),O_=()=>!0,L_=n=>P_.test(n)&&!D_.test(n),Td=()=>!1,j_=n=>V_.test(n),F_=n=>M_.test(n),U_=n=>!F(n)&&!U(n),B_=n=>Bs(n,Ad,Td),F=n=>Ed.test(n),Qn=n=>Bs(n,Sd,L_),ua=n=>Bs(n,W_,te),_u=n=>Bs(n,Id,Td),z_=n=>Bs(n,Cd,F_),Ci=n=>Bs(n,Rd,j_),U=n=>xd.test(n),dr=n=>zs(n,Sd),q_=n=>zs(n,H_),yu=n=>zs(n,Id),$_=n=>zs(n,Ad),G_=n=>zs(n,Cd),Ai=n=>zs(n,Rd,!0),Bs=(n,e,t)=>{const s=Ed.exec(n);return s?s[1]?e(s[1]):t(s[2]):!1},zs=(n,e,t=!1)=>{const s=xd.exec(n);return s?s[1]?e(s[1]):t:!1},Id=n=>n==="position"||n==="percentage",Cd=n=>n==="image"||n==="url",Ad=n=>n==="length"||n==="size"||n==="bg-size",Sd=n=>n==="length",W_=n=>n==="number",H_=n=>n==="family-name",Rd=n=>n==="shadow",K_=()=>{const n=Be("color"),e=Be("font"),t=Be("text"),s=Be("font-weight"),r=Be("tracking"),i=Be("leading"),o=Be("breakpoint"),l=Be("container"),c=Be("spacing"),h=Be("radius"),m=Be("shadow"),p=Be("inset-shadow"),y=Be("text-shadow"),T=Be("drop-shadow"),N=Be("blur"),R=Be("perspective"),k=Be("aspect"),q=Be("ease"),W=Be("animate"),H=()=>["auto","avoid","all","avoid-page","page","left","right","column"],z=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],ue=()=>[...z(),U,F],B=()=>["auto","hidden","clip","visible","scroll"],b=()=>["auto","contain","none"],_=()=>[U,F,c],v=()=>[gs,"full","auto",..._()],x=()=>[_n,"none","subgrid",U,F],E=()=>["auto",{span:["full",_n,U,F]},_n,U,F],I=()=>[_n,"auto",U,F],w=()=>["auto","min","max","fr",U,F],ke=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],nt=()=>["start","end","center","stretch","center-safe","end-safe"],gt=()=>["auto",..._()],It=()=>[gs,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",..._()],$=()=>[n,U,F],Wt=()=>[...z(),yu,_u,{position:[U,F]}],ln=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Un=()=>["auto","cover","contain",$_,B_,{size:[U,F]}],Vt=()=>[ca,dr,Qn],Pe=()=>["","none","full",h,U,F],Re=()=>["",te,dr,Qn],Xe=()=>["solid","dashed","dotted","double"],Ht=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],be=()=>[te,ca,yu,_u],Kt=()=>["","none",N,U,F],Ct=()=>["none",te,U,F],Mt=()=>["none",te,U,F],ht=()=>[te,U,F],_t=()=>[gs,"full",..._()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Xt],breakpoint:[Xt],color:[O_],container:[Xt],"drop-shadow":[Xt],ease:["in","out","in-out"],font:[U_],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Xt],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Xt],shadow:[Xt],spacing:["px",te],text:[Xt],"text-shadow":[Xt],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",gs,F,U,k]}],container:["container"],columns:[{columns:[te,F,U,l]}],"break-after":[{"break-after":H()}],"break-before":[{"break-before":H()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:ue()}],overflow:[{overflow:B()}],"overflow-x":[{"overflow-x":B()}],"overflow-y":[{"overflow-y":B()}],overscroll:[{overscroll:b()}],"overscroll-x":[{"overscroll-x":b()}],"overscroll-y":[{"overscroll-y":b()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:v()}],"inset-x":[{"inset-x":v()}],"inset-y":[{"inset-y":v()}],start:[{start:v()}],end:[{end:v()}],top:[{top:v()}],right:[{right:v()}],bottom:[{bottom:v()}],left:[{left:v()}],visibility:["visible","invisible","collapse"],z:[{z:[_n,"auto",U,F]}],basis:[{basis:[gs,"full","auto",l,..._()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[te,gs,"auto","initial","none",F]}],grow:[{grow:["",te,U,F]}],shrink:[{shrink:["",te,U,F]}],order:[{order:[_n,"first","last","none",U,F]}],"grid-cols":[{"grid-cols":x()}],"col-start-end":[{col:E()}],"col-start":[{"col-start":I()}],"col-end":[{"col-end":I()}],"grid-rows":[{"grid-rows":x()}],"row-start-end":[{row:E()}],"row-start":[{"row-start":I()}],"row-end":[{"row-end":I()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":w()}],"auto-rows":[{"auto-rows":w()}],gap:[{gap:_()}],"gap-x":[{"gap-x":_()}],"gap-y":[{"gap-y":_()}],"justify-content":[{justify:[...ke(),"normal"]}],"justify-items":[{"justify-items":[...nt(),"normal"]}],"justify-self":[{"justify-self":["auto",...nt()]}],"align-content":[{content:["normal",...ke()]}],"align-items":[{items:[...nt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...nt(),{baseline:["","last"]}]}],"place-content":[{"place-content":ke()}],"place-items":[{"place-items":[...nt(),"baseline"]}],"place-self":[{"place-self":["auto",...nt()]}],p:[{p:_()}],px:[{px:_()}],py:[{py:_()}],ps:[{ps:_()}],pe:[{pe:_()}],pt:[{pt:_()}],pr:[{pr:_()}],pb:[{pb:_()}],pl:[{pl:_()}],m:[{m:gt()}],mx:[{mx:gt()}],my:[{my:gt()}],ms:[{ms:gt()}],me:[{me:gt()}],mt:[{mt:gt()}],mr:[{mr:gt()}],mb:[{mb:gt()}],ml:[{ml:gt()}],"space-x":[{"space-x":_()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":_()}],"space-y-reverse":["space-y-reverse"],size:[{size:It()}],w:[{w:[l,"screen",...It()]}],"min-w":[{"min-w":[l,"screen","none",...It()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[o]},...It()]}],h:[{h:["screen","lh",...It()]}],"min-h":[{"min-h":["screen","lh","none",...It()]}],"max-h":[{"max-h":["screen","lh",...It()]}],"font-size":[{text:["base",t,dr,Qn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,U,ua]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",ca,F]}],"font-family":[{font:[q_,F,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[r,U,F]}],"line-clamp":[{"line-clamp":[te,"none",U,ua]}],leading:[{leading:[i,..._()]}],"list-image":[{"list-image":["none",U,F]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",U,F]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:$()}],"text-color":[{text:$()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:[te,"from-font","auto",U,Qn]}],"text-decoration-color":[{decoration:$()}],"underline-offset":[{"underline-offset":[te,"auto",U,F]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",U,F]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",U,F]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Wt()}],"bg-repeat":[{bg:ln()}],"bg-size":[{bg:Un()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},_n,U,F],radial:["",U,F],conic:[_n,U,F]},G_,z_]}],"bg-color":[{bg:$()}],"gradient-from-pos":[{from:Vt()}],"gradient-via-pos":[{via:Vt()}],"gradient-to-pos":[{to:Vt()}],"gradient-from":[{from:$()}],"gradient-via":[{via:$()}],"gradient-to":[{to:$()}],rounded:[{rounded:Pe()}],"rounded-s":[{"rounded-s":Pe()}],"rounded-e":[{"rounded-e":Pe()}],"rounded-t":[{"rounded-t":Pe()}],"rounded-r":[{"rounded-r":Pe()}],"rounded-b":[{"rounded-b":Pe()}],"rounded-l":[{"rounded-l":Pe()}],"rounded-ss":[{"rounded-ss":Pe()}],"rounded-se":[{"rounded-se":Pe()}],"rounded-ee":[{"rounded-ee":Pe()}],"rounded-es":[{"rounded-es":Pe()}],"rounded-tl":[{"rounded-tl":Pe()}],"rounded-tr":[{"rounded-tr":Pe()}],"rounded-br":[{"rounded-br":Pe()}],"rounded-bl":[{"rounded-bl":Pe()}],"border-w":[{border:Re()}],"border-w-x":[{"border-x":Re()}],"border-w-y":[{"border-y":Re()}],"border-w-s":[{"border-s":Re()}],"border-w-e":[{"border-e":Re()}],"border-w-t":[{"border-t":Re()}],"border-w-r":[{"border-r":Re()}],"border-w-b":[{"border-b":Re()}],"border-w-l":[{"border-l":Re()}],"divide-x":[{"divide-x":Re()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Re()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Xe(),"hidden","none"]}],"divide-style":[{divide:[...Xe(),"hidden","none"]}],"border-color":[{border:$()}],"border-color-x":[{"border-x":$()}],"border-color-y":[{"border-y":$()}],"border-color-s":[{"border-s":$()}],"border-color-e":[{"border-e":$()}],"border-color-t":[{"border-t":$()}],"border-color-r":[{"border-r":$()}],"border-color-b":[{"border-b":$()}],"border-color-l":[{"border-l":$()}],"divide-color":[{divide:$()}],"outline-style":[{outline:[...Xe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[te,U,F]}],"outline-w":[{outline:["",te,dr,Qn]}],"outline-color":[{outline:$()}],shadow:[{shadow:["","none",m,Ai,Ci]}],"shadow-color":[{shadow:$()}],"inset-shadow":[{"inset-shadow":["none",p,Ai,Ci]}],"inset-shadow-color":[{"inset-shadow":$()}],"ring-w":[{ring:Re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:$()}],"ring-offset-w":[{"ring-offset":[te,Qn]}],"ring-offset-color":[{"ring-offset":$()}],"inset-ring-w":[{"inset-ring":Re()}],"inset-ring-color":[{"inset-ring":$()}],"text-shadow":[{"text-shadow":["none",y,Ai,Ci]}],"text-shadow-color":[{"text-shadow":$()}],opacity:[{opacity:[te,U,F]}],"mix-blend":[{"mix-blend":[...Ht(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Ht()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[te]}],"mask-image-linear-from-pos":[{"mask-linear-from":be()}],"mask-image-linear-to-pos":[{"mask-linear-to":be()}],"mask-image-linear-from-color":[{"mask-linear-from":$()}],"mask-image-linear-to-color":[{"mask-linear-to":$()}],"mask-image-t-from-pos":[{"mask-t-from":be()}],"mask-image-t-to-pos":[{"mask-t-to":be()}],"mask-image-t-from-color":[{"mask-t-from":$()}],"mask-image-t-to-color":[{"mask-t-to":$()}],"mask-image-r-from-pos":[{"mask-r-from":be()}],"mask-image-r-to-pos":[{"mask-r-to":be()}],"mask-image-r-from-color":[{"mask-r-from":$()}],"mask-image-r-to-color":[{"mask-r-to":$()}],"mask-image-b-from-pos":[{"mask-b-from":be()}],"mask-image-b-to-pos":[{"mask-b-to":be()}],"mask-image-b-from-color":[{"mask-b-from":$()}],"mask-image-b-to-color":[{"mask-b-to":$()}],"mask-image-l-from-pos":[{"mask-l-from":be()}],"mask-image-l-to-pos":[{"mask-l-to":be()}],"mask-image-l-from-color":[{"mask-l-from":$()}],"mask-image-l-to-color":[{"mask-l-to":$()}],"mask-image-x-from-pos":[{"mask-x-from":be()}],"mask-image-x-to-pos":[{"mask-x-to":be()}],"mask-image-x-from-color":[{"mask-x-from":$()}],"mask-image-x-to-color":[{"mask-x-to":$()}],"mask-image-y-from-pos":[{"mask-y-from":be()}],"mask-image-y-to-pos":[{"mask-y-to":be()}],"mask-image-y-from-color":[{"mask-y-from":$()}],"mask-image-y-to-color":[{"mask-y-to":$()}],"mask-image-radial":[{"mask-radial":[U,F]}],"mask-image-radial-from-pos":[{"mask-radial-from":be()}],"mask-image-radial-to-pos":[{"mask-radial-to":be()}],"mask-image-radial-from-color":[{"mask-radial-from":$()}],"mask-image-radial-to-color":[{"mask-radial-to":$()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":z()}],"mask-image-conic-pos":[{"mask-conic":[te]}],"mask-image-conic-from-pos":[{"mask-conic-from":be()}],"mask-image-conic-to-pos":[{"mask-conic-to":be()}],"mask-image-conic-from-color":[{"mask-conic-from":$()}],"mask-image-conic-to-color":[{"mask-conic-to":$()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Wt()}],"mask-repeat":[{mask:ln()}],"mask-size":[{mask:Un()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",U,F]}],filter:[{filter:["","none",U,F]}],blur:[{blur:Kt()}],brightness:[{brightness:[te,U,F]}],contrast:[{contrast:[te,U,F]}],"drop-shadow":[{"drop-shadow":["","none",T,Ai,Ci]}],"drop-shadow-color":[{"drop-shadow":$()}],grayscale:[{grayscale:["",te,U,F]}],"hue-rotate":[{"hue-rotate":[te,U,F]}],invert:[{invert:["",te,U,F]}],saturate:[{saturate:[te,U,F]}],sepia:[{sepia:["",te,U,F]}],"backdrop-filter":[{"backdrop-filter":["","none",U,F]}],"backdrop-blur":[{"backdrop-blur":Kt()}],"backdrop-brightness":[{"backdrop-brightness":[te,U,F]}],"backdrop-contrast":[{"backdrop-contrast":[te,U,F]}],"backdrop-grayscale":[{"backdrop-grayscale":["",te,U,F]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[te,U,F]}],"backdrop-invert":[{"backdrop-invert":["",te,U,F]}],"backdrop-opacity":[{"backdrop-opacity":[te,U,F]}],"backdrop-saturate":[{"backdrop-saturate":[te,U,F]}],"backdrop-sepia":[{"backdrop-sepia":["",te,U,F]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":_()}],"border-spacing-x":[{"border-spacing-x":_()}],"border-spacing-y":[{"border-spacing-y":_()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",U,F]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[te,"initial",U,F]}],ease:[{ease:["linear","initial",q,U,F]}],delay:[{delay:[te,U,F]}],animate:[{animate:["none",W,U,F]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[R,U,F]}],"perspective-origin":[{"perspective-origin":ue()}],rotate:[{rotate:Ct()}],"rotate-x":[{"rotate-x":Ct()}],"rotate-y":[{"rotate-y":Ct()}],"rotate-z":[{"rotate-z":Ct()}],scale:[{scale:Mt()}],"scale-x":[{"scale-x":Mt()}],"scale-y":[{"scale-y":Mt()}],"scale-z":[{"scale-z":Mt()}],"scale-3d":["scale-3d"],skew:[{skew:ht()}],"skew-x":[{"skew-x":ht()}],"skew-y":[{"skew-y":ht()}],transform:[{transform:[U,F,"","none","gpu","cpu"]}],"transform-origin":[{origin:ue()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:_t()}],"translate-x":[{"translate-x":_t()}],"translate-y":[{"translate-y":_t()}],"translate-z":[{"translate-z":_t()}],"translate-none":["translate-none"],accent:[{accent:$()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:$()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",U,F]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_()}],"scroll-mx":[{"scroll-mx":_()}],"scroll-my":[{"scroll-my":_()}],"scroll-ms":[{"scroll-ms":_()}],"scroll-me":[{"scroll-me":_()}],"scroll-mt":[{"scroll-mt":_()}],"scroll-mr":[{"scroll-mr":_()}],"scroll-mb":[{"scroll-mb":_()}],"scroll-ml":[{"scroll-ml":_()}],"scroll-p":[{"scroll-p":_()}],"scroll-px":[{"scroll-px":_()}],"scroll-py":[{"scroll-py":_()}],"scroll-ps":[{"scroll-ps":_()}],"scroll-pe":[{"scroll-pe":_()}],"scroll-pt":[{"scroll-pt":_()}],"scroll-pr":[{"scroll-pr":_()}],"scroll-pb":[{"scroll-pb":_()}],"scroll-pl":[{"scroll-pl":_()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",U,F]}],fill:[{fill:["none",...$()]}],"stroke-w":[{stroke:[te,dr,Qn,ua]}],stroke:[{stroke:["none",...$()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Q_=S_(K_);function Me(...n){return Q_(a_(n))}const Y_="https://script.google.com/macros/s/AKfycbyeohAlB3zqDoIK1Qtr2K9zClnsIaRxTrDv7k2bx_scTvCJ_F-_KYAZLESl8t8YA8gTEg/exec",X_=({open:n,onOpenChange:e,userEmail:t})=>{const[s,r]=O.useState(1),[i,o]=O.useState(null),[l,c]=O.useState({}),[h,m]=O.useState(!1),[p,y]=O.useState(0),T=O.useRef(!1);O.useEffect(()=>{n?(s===0&&r(1),o(null),c({}),m(!1)):T.current=!1},[n]),O.useEffect(()=>{(async()=>{const B=await chrome.storage.local.get(["summarizeCount","pulseCheckDismissed","pulseCheckDismissedFinal"]),b=B.summarizeCount||0;y(b);const _=B.pulseCheckDismissed||!1,v=B.pulseCheckDismissedFinal||!1;(b>=4&&!v||b>=2&&!_)&&(T.current=!0,e(!0),r(1))})();const ue=B=>{if(B.summarizeCount){const b=B.summarizeCount.newValue;y(b),chrome.storage.local.get(["pulseCheckDismissed","pulseCheckDismissedFinal"],_=>{const v=_.pulseCheckDismissed||!1,x=_.pulseCheckDismissedFinal||!1;(b>=4&&!x||b>=2&&!v)&&(T.current=!0,e(!0),r(1))})}};return chrome.storage.onChanged.addListener(ue),()=>chrome.storage.onChanged.removeListener(ue)},[]);const N=()=>{e(!1),T.current&&(p>=4?chrome.storage.local.set({pulseCheckDismissed:!0,pulseCheckDismissedFinal:!0}):chrome.storage.local.set({pulseCheckDismissed:!0})),T.current=!1},R=z=>{o(z),r(2)},k=(z,ue)=>{c(B=>({...B,[z]:ue}))},q=async()=>{if(h)return;m(!0);const z={timestamp:new Date().toISOString(),rating:i,email:t||"anonymous",...l};try{fetch(Y_,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)})}catch(ue){console.error("Failed to submit feedback",ue)}r(3)},W=()=>{r(1),o(null),c({}),m(!1)};if(!n)return null;const H=i==="Game Changer"||i==="Useful";return f.jsx("div",{className:"popup-content absolute bottom-full left-1/2 -translate-x-1/2 mb-2 z-[300] w-full",onClick:z=>z.stopPropagation(),children:f.jsxs("div",{className:"w-full rounded-2xl shadow-xl overflow-hidden",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},children:[f.jsxs("div",{className:"flex justify-between items-center px-4 pt-3 pb-1",children:[f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",style:{color:"var(--text-primary)"},children:"Pulse Check"}),f.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors",children:f.jsx(bo,{className:"w-4 h-4"})})]}),f.jsxs("div",{className:"px-5 pb-5 pt-1",children:[s===1&&f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-sm font-semibold text-center",style:{color:"var(--text-primary)"},children:"What is your initial feeling?"}),f.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Game Changer","Useful","Okay","Not helpful"].map(z=>f.jsxs("button",{onClick:()=>R(z),className:"flex flex-col items-center justify-center gap-1 p-3 rounded-xl border transition-all group hover:scale-[1.02]",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)"},children:[f.jsx("span",{className:"text-xl group-hover:scale-110 transition-transform",children:z==="Game Changer"?"ðŸ¤©":z==="Useful"?"ðŸ™‚":z==="Okay"?"ðŸ˜":"ðŸ™"}),f.jsx("span",{className:"text-xs font-medium",style:{color:"var(--text-secondary)"},children:z})]},z))})]}),s===2&&f.jsxs("div",{className:"space-y-4 animate-fade-in",children:[H?f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Should I invest more time into this?"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>k("investTime",!0),className:Me("flex-1 py-1.5 text-xs rounded-lg border transition-colors",l.investTime===!0?"bg-black text-white border-black":"bg-[var(--bg-primary)] border-[var(--border-primary)] text-[var(--text-secondary)] hover:opacity-80"),children:"Yes"}),f.jsx("button",{onClick:()=>k("investTime",!1),className:Me("flex-1 py-1.5 text-xs rounded-lg border transition-colors",l.investTime===!1?"bg-gray-800 text-white border-gray-800":"bg-[var(--bg-primary)] border-[var(--border-primary)] text-[var(--text-secondary)] hover:opacity-80"),children:"No"})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("p",{className:"text-xs font-medium text-gray-700",children:["Share more thoughts? ",f.jsx("span",{className:"text-gray-400 font-normal",children:"(Optional)"})]}),f.jsx("textarea",{className:"w-full text-xs p-2 rounded-lg border border-gray-200 focus:border-black focus:ring-1 focus:ring-black outline-none resize-none bg-gray-50",rows:2,placeholder:"What was your impression?",onChange:z=>k("feedbackText",z.target.value)})]})]}):f.jsx("div",{className:"space-y-3",children:f.jsxs("div",{className:"space-y-2",children:[f.jsx("p",{className:"text-xs font-medium text-gray-700",children:"What went wrong?"}),f.jsx("div",{className:"flex flex-col gap-1.5",children:["Buggy","Confusing","Didn't solve problem"].map(z=>f.jsx("button",{onClick:()=>k("whatWentWrong",z),className:Me("w-full text-left px-3 py-2 text-xs rounded-lg border transition-colors",l.whatWentWrong===z?"bg-gray-100 border-gray-400 text-black font-medium":"bg-[var(--bg-primary)] border-[var(--border-primary)] text-[var(--text-secondary)] hover:opacity-80"),children:z},z))})]})}),f.jsx("button",{onClick:q,disabled:h,className:"w-full py-2.5 bg-black hover:bg-gray-800 text-white text-xs font-semibold rounded-xl shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2 mt-2 disabled:opacity-70 disabled:cursor-not-allowed",children:h?"Sending...":f.jsxs(f.Fragment,{children:["Submit Feedback ",f.jsx(Qg,{className:"w-3 h-3"})]})})]}),s===3&&f.jsxs("div",{className:"py-6 text-center animate-fade-in",children:[f.jsx("div",{className:"w-12 h-12 bg-gray-100 text-black rounded-full flex items-center justify-center mx-auto mb-3",children:f.jsx(gd,{className:"w-6 h-6"})}),f.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Thank You!"}),f.jsx("p",{className:"text-xs text-gray-500 mt-1 mb-6",children:"Your feedback helps us build better."}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx("button",{onClick:W,className:"w-full py-2.5 bg-black hover:bg-gray-800 text-white text-xs font-semibold rounded-xl shadow-sm transition-all active:scale-95",children:"Submit Another Response"}),f.jsx("button",{onClick:N,className:"w-full py-2.5 bg-white border border-gray-200 hover:bg-gray-50 text-gray-600 text-xs font-semibold rounded-xl transition-all active:scale-95",children:"Close"})]})]})]})]})})},J_=({children:n,header:e})=>f.jsxs("div",{className:"flex flex-col h-screen w-full font-sans overflow-hidden",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:[e&&f.jsx("header",{className:"flex items-center justify-between px-4 py-3 backdrop-blur-md sticky top-0 z-40",style:{backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border-primary)"},children:e}),f.jsx("main",{className:"flex-1 flex flex-col p-4 relative overflow-hidden min-h-0",children:n})]}),Ae=({content:n,children:e,disabled:t,side:s="top"})=>{const[r,i]=O.useState(!1);if(t)return f.jsx(f.Fragment,{children:e});let o="";switch(s){case"bottom":o="top-full left-1/2 -translate-x-1/2 mt-2";break;case"left":o="right-full top-1/2 -translate-y-1/2 mr-2";break;case"right":o="left-full top-1/2 -translate-y-1/2 ml-2";break;default:o="bottom-full left-1/2 -translate-x-1/2 mb-2";break}const l=()=>{window.matchMedia("(hover: hover)").matches&&i(!0)};return f.jsxs("div",{className:"relative inline-block z-[500]",onMouseEnter:l,onMouseLeave:()=>i(!1),onClick:()=>i(!1),children:[e,r&&f.jsx("div",{className:`absolute ${o} px-2 py-1 text-xs rounded whitespace-nowrap z-[600] pointer-events-none`,style:{backgroundColor:"var(--text-primary)",color:"var(--bg-primary)"},children:n})]})},Z_=["Analyzing prompts","Extracting insights","Drafting summary"],ey=["Re-analyzing prompts","Re-extracting insights","Re-drafting summary"],vu=({onGenerate:n,state:e,isRegenerating:t=!1,disabled:s=!1,compact:r=!1,isGuest:i=!1})=>{const o=O.useRef(null),[l,c]=O.useState("paragraph"),[h,m]=O.useState("normal"),[p,y]=O.useState(""),T=t?ey:Z_,[N,R]=O.useState(0),[k,q]=O.useState(!1),[W,H]=O.useState(0);if(O.useEffect(()=>{if(e==="idle"){H(0),R(0),q(!1);return}if(e==="generating"){R(0),q(!1),H(0);const B=setInterval(()=>{H(_=>_+.1)},100),b=setInterval(()=>{R(_=>_<T.length?_+1:_)},800);return()=>{clearInterval(B),clearInterval(b)}}},[e,T.length]),r&&e==="idle")return f.jsx(Ae,{content:s?"Not available on this page":"Generate Summary",children:f.jsx("button",{onClick:()=>!s&&n(p,l,h),disabled:s,className:Me("w-10 h-10 rounded-full flex items-center justify-center transition-colors group shadow-md",s?"bg-gray-200 cursor-not-allowed":"bg-black hover:bg-gray-800"),children:f.jsx(Ti,{className:Me("w-5 h-5",s?"text-gray-400":"text-white")})})});if(i)return t?null:e==="idle"?f.jsx(Ae,{content:s?"Not available on this page":"Generate Summary",children:f.jsx("button",{onClick:()=>!s&&n(p,l,h),disabled:s,className:"absolute right-4 bottom-4 w-12 h-12 rounded-full flex items-center justify-center transition-colors group shadow-lg z-[210] border-[0.5px] border-gray-600",style:{backgroundColor:s?"#e5e7eb":"#ffffff",cursor:s?"not-allowed":"pointer"},children:f.jsx(Ti,{className:Me("w-5 h-5",s?"text-gray-400":"text-black")})})}):e==="generating"?f.jsx(Ae,{content:"Generating...",disabled:!0,children:f.jsx("div",{className:"absolute right-4 bottom-4 w-12 h-12 rounded-full flex items-center justify-center shadow-lg z-[210]",style:{backgroundColor:"#ffffff"},children:f.jsx($i,{className:"w-5 h-5 text-black animate-spin"})})}):null;const z=B=>{if(!B.value.trim()){B.style.height="24px";return}B.style.height="auto";const b=Math.min(B.scrollHeight,120);B.style.height=`${b}px`},ue=B=>{y(B.target.value),z(B.target)};return O.useEffect(()=>{o.current&&z(o.current)},[p]),f.jsxs("div",{className:Me("relative w-full font-medium text-sm transition-all duration-300 ease-in-out z-[210]",e==="idle"?"rounded-2xl":"rounded-xl",e==="idle"?"":e==="generating"||k?"min-h-[160px]":"h-12"),style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-primary)"},children:[e==="idle"&&f.jsxs("div",{className:"flex flex-col p-5 gap-6 animate-fade-in",children:[f.jsx("div",{className:"flex items-center justify-between",children:f.jsxs("div",{className:"flex items-center gap-2 p-1 rounded-lg w-fit",style:{backgroundColor:"var(--bg-tertiary)"},children:[f.jsx(Ae,{content:"Alignment",children:f.jsx("button",{onClick:()=>c("paragraph"),className:"p-1.5 rounded-md transition-all",style:{backgroundColor:l==="paragraph"?"var(--bg-primary)":"transparent",color:l==="paragraph"?"var(--text-primary)":"var(--text-tertiary)",boxShadow:l==="paragraph"?"var(--shadow-sm)":"none"},children:f.jsx(Zg,{className:"w-4 h-4"})})}),f.jsx(Ae,{content:"List",children:f.jsx("button",{onClick:()=>c("points"),className:"p-1.5 rounded-md transition-all",style:{backgroundColor:l==="points"?"var(--bg-primary)":"transparent",color:l==="points"?"var(--text-primary)":"var(--text-tertiary)",boxShadow:l==="points"?"var(--shadow-sm)":"none"},children:f.jsx(Ug,{className:"w-4 h-4"})})})]})}),f.jsxs("div",{className:"w-full relative",children:[f.jsx("textarea",{ref:o,placeholder:"type additional information here",value:p,onChange:ue,rows:1,spellCheck:!0,className:"w-full border-none p-0 pr-2 text-base font-medium focus:ring-0 focus:outline-none bg-transparent resize-none min-h-[24px] max-h-[120px] overflow-y-auto",style:{color:"var(--text-primary)",caretColor:"var(--text-primary)"},onFocus:B=>B.target.style.setProperty("--placeholder-color","var(--text-tertiary)")}),f.jsx("div",{className:"w-full h-px mt-3",style:{backgroundColor:"var(--border-primary)"}})]}),f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>m(B=>B==="professional"?"normal":"professional"),className:"px-3 py-1.5 rounded-full text-xs font-medium transition-colors",style:{backgroundColor:h==="professional"?"var(--bg-tertiary)":"var(--bg-secondary)",color:h==="professional"?"var(--text-primary)":"var(--text-tertiary)"},children:"professional"}),f.jsx("button",{onClick:()=>m(B=>B==="creative"?"normal":"creative"),className:"px-3 py-1.5 rounded-full text-xs font-medium transition-colors",style:{backgroundColor:h==="creative"?"var(--bg-tertiary)":"var(--bg-secondary)",color:h==="creative"?"var(--text-primary)":"var(--text-tertiary)"},children:"creative"})]}),f.jsx(Ae,{content:"Generate Summary",children:f.jsx("button",{onClick:()=>n(p,l,h),className:"w-10 h-10 rounded-full flex items-center justify-center transition-colors group shadow-md border-[0.5px] border-gray-600",style:{backgroundColor:"#ffffff"},children:f.jsx(Ti,{className:"w-5 h-5 text-black"})})})]})]}),e==="generating"&&f.jsxs("div",{className:"flex flex-col justify-center min-h-[160px] p-6 gap-3 animate-fade-in",children:[T.map((B,b)=>f.jsxs("div",{className:"flex items-center gap-3",children:[b<N?f.jsx("div",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center",children:f.jsx(Sn,{className:"w-3 h-3 text-green-600"})}):b===N?f.jsx($i,{className:"w-5 h-5 animate-spin",style:{color:"var(--text-primary)"}}):f.jsx("div",{className:"w-5 h-5 rounded-full",style:{border:"1px solid var(--border-primary)"}}),f.jsx("span",{className:"text-sm transition-colors",style:{color:b<=N?"var(--text-primary)":"var(--text-tertiary)",fontWeight:b<=N?"500":"400"},children:B})]},b)),f.jsxs("div",{className:"absolute bottom-4 right-6 text-xs text-gray-400 font-mono",children:[W.toFixed(1),"s"]})]}),e==="completed"&&f.jsxs("div",{className:"w-full h-full flex flex-col animate-fade-in",children:[!k&&f.jsxs("button",{onClick:()=>q(!0),className:"w-full h-12 flex items-center justify-center gap-2 hover:bg-gray-50 transition-colors rounded-xl",children:[f.jsxs("div",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center",children:[f.jsx(Ti,{className:"w-3 h-3 text-green-600 -rotate-90"})," "]}),f.jsx("span",{className:"font-medium text-gray-900",children:"Summary Generated"}),f.jsxs("span",{className:"text-[10px] text-gray-400 font-mono ml-1",children:[W.toFixed(1),"s"]})]}),k&&f.jsxs("div",{className:"flex flex-col justify-center min-h-[160px] p-6 gap-3 relative",children:[T.map((B,b)=>f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center",children:f.jsx(Sn,{className:"w-3 h-3 text-green-600"})}),f.jsx("span",{className:"text-sm text-gray-900 font-medium",children:B})]},b)),f.jsx("button",{onClick:()=>q(!1),className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors",children:f.jsx(Oi,{className:"w-4 h-4 text-gray-400"})}),f.jsxs("div",{className:"absolute bottom-4 right-6 text-xs text-gray-400 font-mono",children:[W.toFixed(1),"s"]})]})]})]})},ot=cl.forwardRef(({className:n,variant:e="primary",size:t="md",style:s,...r},i)=>{const o={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base",icon:"p-2"},l=()=>{switch(e){case"primary":return{backgroundColor:"var(--text-primary)",color:"var(--bg-primary)",border:"1px solid transparent",boxShadow:"var(--shadow-sm)"};case"secondary":return{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-primary)",boxShadow:"var(--shadow-sm)"};case"ghost":return{backgroundColor:"transparent",color:"var(--text-secondary)"};case"outline":return{backgroundColor:"transparent",color:"var(--text-primary)",border:"1px solid var(--border-primary)"}}};return f.jsx("button",{ref:i,className:Me("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-gray-200 disabled:opacity-50 disabled:pointer-events-none",o[t],n),style:{...l(),...s},...r})});ot.displayName="Button";const wu=({items:n,speed:e=30,className:t,reverse:s=!1})=>{const r=s?"marquee-reverse":"marquee";return f.jsxs("div",{className:Me("relative flex overflow-hidden w-full select-none pointer-events-none",t),style:{maskImage:"linear-gradient(to right, transparent, black 20%, black 80%, transparent)",WebkitMaskImage:"linear-gradient(to right, transparent, black 20%, black 80%, transparent)"},children:[f.jsx("style",{children:`
                @keyframes marquee {
                    0% { transform: translateX(0); }
                    100% { transform: translateX(-25%); }
                }
                @keyframes marquee-reverse {
                    0% { transform: translateX(-25%); }
                    100% { transform: translateX(0); }
                }
                .animate-marquee-${s?"reverse":"normal"} {
                    animation: ${r} ${e}s linear infinite;
                }
                `}),f.jsx("div",{className:`flex animate-marquee-${s?"reverse":"normal"} whitespace-nowrap w-max`,style:{willChange:"transform"},children:[...Array(4)].map((i,o)=>f.jsx("div",{className:"flex items-center shrink-0",children:n.map((l,c)=>f.jsxs("span",{className:"mx-3 text-xs font-medium flex items-center",style:{color:"var(--text-secondary)"},children:[l,f.jsx("span",{className:"ml-3",style:{color:"var(--text-tertiary)"},children:"â€¢"})]},`${o}-${c}`))},o))})]})},ty=(n,e)=>{let t="";n.conversation&&n.conversation.length>0&&(e.includeAI?t=n.conversation.map(r=>`${r.role==="user"?"User":"AI"}: ${r.content}`).join(`

`):t=n.conversation.filter(r=>r.role==="user").map(r=>r.content).join(`

`)),(!t||t.trim().length===0)&&(t=n.rawText||"");const s=n.conversation&&n.conversation.length>0;if(console.log("Lotus: Processor - isStructured:",s),console.log("Lotus: Processor - Initial textToProcess:",t),!e.includeAI&&t.length>0&&!s){console.log("Lotus: Processor - Running Heuristic Filter (Unstructured Path)");const i=t.split(/\n\n+/).filter(o=>{const l=o.toLowerCase().trim();if(l.length<2)return!1;if(/(need|want|make|change|update|remove|add|fix|replace|include|exclude)/i.test(l))return!0;if([/^here (is|are)/,/^sure,|^certainly/,/^as an ai/,/^i (have|can|will|understand|apologize)/,/^(the|this) (code|story|solution|example)/,/^output:|^response:/,/^once upon a time/,/^in the end/,/chapter \d+/,/^generated by/].some(h=>h.test(l))||o.includes("```")||o.includes("import ")&&o.includes("from "))return!1;if(o.length>80){const m=[/^(please )?(write|create|make|fix|debug|explain|generate|draft|compose|list|show|give|provide|tell|analyze|optimize|refactor|add|remove|update|change|modify)/,/^(i|we) (want|need|would like|am looking for|have)/,/^(how|what|where|when|why|who|can|could|is|are|do|does) /,/(my|the) (code|error|app|script|function|variable) (is|has|doesn't|fails)/,/(actuall+y|also|but|and|plus|instead|however|wait|this is|i need|i want)/i].some(p=>p.test(l));if(!m&&/(need|want|make|change|update|remove|add|fix)/i.test(l))return!0;if(!m)return!1}return!0});return i.length>0?i.map(o=>`User: ${o}`).join(`

`):""}return t},ny="https://tai-backend.amaravadhibharath.workers.dev",bu=async(n,e,t="auto",s,r,i)=>{try{const o={"Content-Type":"application/json"};r&&(o.Authorization=`Bearer ${r}`);const l=await fetch(ny,{method:"POST",headers:o,body:JSON.stringify({content:n,additionalInfo:s,provider:t,deviceId:i,options:{format:e.format,includeAI:e.includeAI,images:e.images,tone:e.tone}})});if(!l.ok){const m=await l.json();throw new Error(m.error||`Worker Error: ${l.status}`)}const c=await l.json();if(c.quotaUsed!==void 0&&c.quotaLimit!==void 0){const m=new Date().toDateString();chrome.storage.local.set({quotaUsed:c.quotaUsed,quotaLimit:c.quotaLimit,quotaDate:m}),c.quotaUsed>20&&chrome.storage.local.get(["heavyUserTrackedDate","user"],p=>{if(p.heavyUserTrackedDate!==m){const y=p.user?.email||"anonymous";vg(y,c.quotaUsed).then(()=>{chrome.storage.local.set({heavyUserTrackedDate:m})})}})}if(!c.summary||c.summary.trim().length===0)throw console.error("âŒ Backend returned empty summary. Full Response:",JSON.stringify(c,null,2)),new Error("AI returned an empty summary. This might be due to content safety filters or an API issue.");let h=c.summary.trim();return h.startsWith('"')&&h.endsWith('"')&&(h=h.slice(1,-1)),h}catch(o){throw console.error("Backend Error:",o),o.message?.includes("Failed to fetch")?new Error("Unable to connect to backend. Please check your internet connection."):o.message?.includes("Method Not Allowed")?new Error("Backend configuration error. Please contact support."):new Error(o.message||"Failed to generate summary. Please try again.")}},sy=()=>{};var Eu={};const Nd={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const V=function(n,e){if(!n)throw qs(e)},qs=function(n){return new Error("Firebase Database ("+Nd.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const kd=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},ry=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],l=n[t++],c=((r&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},hl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,l=o?n[r+1]:0,c=r+2<n.length,h=c?n[r+2]:0,m=i>>2,p=(i&3)<<4|l>>4;let y=(l&15)<<2|h>>6,T=h&63;c||(T=64,o||(y=64)),s.push(t[m],t[p],t[y],t[T])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(kd(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):ry(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],l=r<n.length?t[n.charAt(r)]:0;++r;const h=r<n.length?t[n.charAt(r)]:64;++r;const p=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||l==null||h==null||p==null)throw new iy;const y=i<<2|l>>4;if(s.push(y),h!==64){const T=l<<4&240|h>>2;if(s.push(T),p!==64){const N=h<<6&192|p;s.push(N)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class iy extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Pd=function(n){const e=kd(n);return hl.encodeByteArray(e,!0)},Wi=function(n){return Pd(n).replace(/\./g,"")},Sa=function(n){try{return hl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function oy(n){return Dd(void 0,n)}function Dd(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!ay(t)||(n[t]=Dd(n[t],e[t]));return n}function ay(n){return n!=="__proto__"}function ly(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const cy=()=>ly().__FIREBASE_DEFAULTS__,uy=()=>{if(typeof process>"u"||typeof Eu>"u")return;const n=Eu.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},hy=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Sa(n[1]);return e&&JSON.parse(e)},dl=()=>{try{return sy()||cy()||uy()||hy()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},dy=n=>dl()?.emulatorHosts?.[n],Vd=n=>{const e=dy(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Md=()=>dl()?.config;class fl{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Qr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Od(n){return(await fetch(n,{credentials:"include"})).ok}function Ld(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Wi(JSON.stringify(t)),Wi(JSON.stringify(o)),""].join(".")}const wr={};function fy(){const n={prod:[],emulator:[]};for(const e of Object.keys(wr))wr[e]?n.emulator.push(e):n.prod.push(e);return n}function my(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let xu=!1;function jd(n,e){if(typeof window>"u"||typeof document>"u"||!Qr(window.location.host)||wr[n]===e||wr[n]||xu)return;wr[n]=e;function t(y){return`__firebase__banner__${y}`}const s="__firebase__banner",i=fy().prod.length>0;function o(){const y=document.getElementById(s);y&&y.remove()}function l(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function c(y,T){y.setAttribute("width","24"),y.setAttribute("id",T),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{xu=!0,o()},y}function m(y,T){y.setAttribute("id",T),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function p(){const y=my(s),T=t("text"),N=document.getElementById(T)||document.createElement("span"),R=t("learnmore"),k=document.getElementById(R)||document.createElement("a"),q=t("preprendIcon"),W=document.getElementById(q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const H=y.element;l(H),m(k,R);const z=h();c(W,q),H.append(W,N,k,z),document.body.appendChild(H)}i?(N.innerText="Preview backend disconnected.",W.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(W.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Fd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ud(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fd())}function py(){const n=dl()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function gy(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function _y(){return Nd.NODE_ADMIN===!0}function yy(){return!py()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vy(){try{return typeof indexedDB=="object"}catch{return!1}}function wy(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const by="FirebaseError";class $s extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=by,Object.setPrototypeOf(this,$s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bd.prototype.create)}}class Bd{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?Ey(i,s):"Error",l=`${this.serviceName}: ${o} (${r}).`;return new $s(r,l,s)}}function Ey(n,e){return n.replace(xy,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const xy=/\{\$([^}]+)}/g;function Nr(n){return JSON.parse(n)}function ze(n){return JSON.stringify(n)}const zd=function(n){let e={},t={},s={},r="";try{const i=n.split(".");e=Nr(Sa(i[0])||""),t=Nr(Sa(i[1])||""),r=i[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:r}},Ty=function(n){const e=zd(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Iy=function(n){const e=zd(n).claims;return typeof e=="object"&&e.admin===!0};function on(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Rs(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Tu(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Hi(n,e,t){const s={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=e.call(t,n[r],r,n));return s}function kr(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(Iu(i)&&Iu(o)){if(!kr(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function Iu(n){return n!==null&&typeof n=="object"}function Cy(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class Ay{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)s[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)s[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const y=s[p-3]^s[p-8]^s[p-14]^s[p-16];s[p]=(y<<1|y>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],h,m;for(let p=0;p<80;p++){p<40?p<20?(h=l^i&(o^l),m=1518500249):(h=i^o^l,m=1859775393):p<60?(h=i&o|l&(i|o),m=2400959708):(h=i^o^l,m=3395469782);const y=(r<<5|r>>>27)+h+c+m+s[p]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=r,r=y}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function qd(n,e){return`${n} failed: ${e} argument `}const Sy=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,V(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Eo=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function Pt(n){return n&&n._delegate?n._delegate:n}class Ns{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Yn="[DEFAULT]";class Ry{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new fl;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ky(e))try{this.getOrInitializeService({instanceIdentifier:Yn})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Yn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Yn){return this.instances.has(e)}getOptions(e=Yn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);s===l&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Ny(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Yn){return this.component?this.component.multipleInstances?e:Yn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ny(n){return n===Yn?void 0:n}function ky(n){return n.instantiationMode==="EAGER"}class Py{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ry(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var ce;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ce||(ce={}));const Dy={debug:ce.DEBUG,verbose:ce.VERBOSE,info:ce.INFO,warn:ce.WARN,error:ce.ERROR,silent:ce.SILENT},Vy=ce.INFO,My={[ce.DEBUG]:"log",[ce.VERBOSE]:"log",[ce.INFO]:"info",[ce.WARN]:"warn",[ce.ERROR]:"error"},Oy=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=My[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ml{constructor(e){this.name=e,this._logLevel=Vy,this._logHandler=Oy,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ce))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Dy[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ce.DEBUG,...e),this._logHandler(this,ce.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ce.VERBOSE,...e),this._logHandler(this,ce.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ce.INFO,...e),this._logHandler(this,ce.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ce.WARN,...e),this._logHandler(this,ce.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ce.ERROR,...e),this._logHandler(this,ce.ERROR,...e)}}const Ly=(n,e)=>e.some(t=>n instanceof t);let Cu,Au;function jy(){return Cu||(Cu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fy(){return Au||(Au=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const $d=new WeakMap,Ra=new WeakMap,Gd=new WeakMap,ha=new WeakMap,pl=new WeakMap;function Uy(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(vn(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&$d.set(t,n)}).catch(()=>{}),pl.set(e,n),e}function By(n){if(Ra.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Ra.set(n,e)}let Na={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ra.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Gd.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return vn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function zy(n){Na=n(Na)}function qy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(da(this),e,...t);return Gd.set(s,e.sort?e.sort():[e]),vn(s)}:Fy().includes(n)?function(...e){return n.apply(da(this),e),vn($d.get(this))}:function(...e){return vn(n.apply(da(this),e))}}function $y(n){return typeof n=="function"?qy(n):(n instanceof IDBTransaction&&By(n),Ly(n,jy())?new Proxy(n,Na):n)}function vn(n){if(n instanceof IDBRequest)return Uy(n);if(ha.has(n))return ha.get(n);const e=$y(n);return e!==n&&(ha.set(n,e),pl.set(e,n)),e}const da=n=>pl.get(n);function Gy(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),l=vn(o);return s&&o.addEventListener("upgradeneeded",c=>{s(vn(o.result),c.oldVersion,c.newVersion,vn(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),r&&c.addEventListener("versionchange",h=>r(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const Wy=["get","getKey","getAll","getAllKeys","count"],Hy=["put","add","delete","clear"],fa=new Map;function Su(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(fa.get(e))return fa.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=Hy.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Wy.includes(t)))return;const i=async function(o,...l){const c=this.transaction(o,r?"readwrite":"readonly");let h=c.store;return s&&(h=h.index(l.shift())),(await Promise.all([h[t](...l),r&&c.done]))[0]};return fa.set(e,i),i}zy(n=>({...n,get:(e,t,s)=>Su(e,t)||n.get(e,t,s),has:(e,t)=>!!Su(e,t)||n.has(e,t)}));class Ky{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Qy(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Qy(n){return n.getComponent()?.type==="VERSION"}const ka="@firebase/app",Ru="0.14.6";const tn=new ml("@firebase/app"),Yy="@firebase/app-compat",Xy="@firebase/analytics-compat",Jy="@firebase/analytics",Zy="@firebase/app-check-compat",ev="@firebase/app-check",tv="@firebase/auth",nv="@firebase/auth-compat",sv="@firebase/database",rv="@firebase/data-connect",iv="@firebase/database-compat",ov="@firebase/functions",av="@firebase/functions-compat",lv="@firebase/installations",cv="@firebase/installations-compat",uv="@firebase/messaging",hv="@firebase/messaging-compat",dv="@firebase/performance",fv="@firebase/performance-compat",mv="@firebase/remote-config",pv="@firebase/remote-config-compat",gv="@firebase/storage",_v="@firebase/storage-compat",yv="@firebase/firestore",vv="@firebase/ai",wv="@firebase/firestore-compat",bv="firebase",Ev="12.6.0";const Pa="[DEFAULT]",xv={[ka]:"fire-core",[Yy]:"fire-core-compat",[Jy]:"fire-analytics",[Xy]:"fire-analytics-compat",[ev]:"fire-app-check",[Zy]:"fire-app-check-compat",[tv]:"fire-auth",[nv]:"fire-auth-compat",[sv]:"fire-rtdb",[rv]:"fire-data-connect",[iv]:"fire-rtdb-compat",[ov]:"fire-fn",[av]:"fire-fn-compat",[lv]:"fire-iid",[cv]:"fire-iid-compat",[uv]:"fire-fcm",[hv]:"fire-fcm-compat",[dv]:"fire-perf",[fv]:"fire-perf-compat",[mv]:"fire-rc",[pv]:"fire-rc-compat",[gv]:"fire-gcs",[_v]:"fire-gcs-compat",[yv]:"fire-fst",[wv]:"fire-fst-compat",[vv]:"fire-vertex","fire-js":"fire-js",[bv]:"fire-js-all"};const Ki=new Map,Tv=new Map,Da=new Map;function Nu(n,e){try{n.container.addComponent(e)}catch(t){tn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Pr(n){const e=n.name;if(Da.has(e))return tn.debug(`There were multiple attempts to register component ${e}.`),!1;Da.set(e,n);for(const t of Ki.values())Nu(t,n);for(const t of Tv.values())Nu(t,n);return!0}function Wd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Hd(n){return n==null?!1:n.settings!==void 0}const Iv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},wn=new Bd("app","Firebase",Iv);class Cv{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Ns("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wn.create("app-deleted",{appName:this._name})}}const Kd=Ev;function Qd(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Pa,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw wn.create("bad-app-name",{appName:String(r)});if(t||(t=Md()),!t)throw wn.create("no-options");const i=Ki.get(r);if(i){if(kr(t,i.options)&&kr(s,i.config))return i;throw wn.create("duplicate-app",{appName:r})}const o=new Py(r);for(const c of Da.values())o.addComponent(c);const l=new Cv(t,s,o);return Ki.set(r,l),l}function Yd(n=Pa){const e=Ki.get(n);if(!e&&n===Pa&&Md())return Qd();if(!e)throw wn.create("no-app",{appName:n});return e}function bn(n,e,t){let s=xv[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tn.warn(o.join(" "));return}Pr(new Ns(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const Av="firebase-heartbeat-database",Sv=1,Dr="firebase-heartbeat-store";let ma=null;function Xd(){return ma||(ma=Gy(Av,Sv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Dr)}catch(t){console.warn(t)}}}}).catch(n=>{throw wn.create("idb-open",{originalErrorMessage:n.message})})),ma}async function Rv(n){try{const t=(await Xd()).transaction(Dr),s=await t.objectStore(Dr).get(Jd(n));return await t.done,s}catch(e){if(e instanceof $s)tn.warn(e.message);else{const t=wn.create("idb-get",{originalErrorMessage:e?.message});tn.warn(t.message)}}}async function ku(n,e){try{const s=(await Xd()).transaction(Dr,"readwrite");await s.objectStore(Dr).put(e,Jd(n)),await s.done}catch(t){if(t instanceof $s)tn.warn(t.message);else{const s=wn.create("idb-set",{originalErrorMessage:t?.message});tn.warn(s.message)}}}function Jd(n){return`${n.name}!${n.options.appId}`}const Nv=1024,kv=30;class Pv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Vv(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Pu();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>kv){const r=Mv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){tn.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Pu(),{heartbeatsToSend:t,unsentEntries:s}=Dv(this._heartbeatsCache.heartbeats),r=Wi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return tn.warn(e),""}}}function Pu(){return new Date().toISOString().substring(0,10)}function Dv(n,e=Nv){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),Du(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Du(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Vv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vy()?wy().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Rv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return ku(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return ku(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Du(n){return Wi(JSON.stringify({version:2,heartbeats:n})).length}function Mv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Ov(n){Pr(new Ns("platform-logger",e=>new Ky(e),"PRIVATE")),Pr(new Ns("heartbeat",e=>new Pv(e),"PRIVATE")),bn(ka,Ru,n),bn(ka,Ru,"esm2020"),bn("fire-js","")}Ov("");var Lv="firebase",jv="12.7.0";bn(Lv,jv,"app");var Vu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var En,Zd;(function(){var n;function e(b,_){function v(){}v.prototype=_.prototype,b.F=_.prototype,b.prototype=new v,b.prototype.constructor=b,b.D=function(x,E,I){for(var w=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)w[ke-2]=arguments[ke];return _.prototype[E].apply(x,w)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(b,_,v){v||(v=0);const x=Array(16);if(typeof _=="string")for(var E=0;E<16;++E)x[E]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(E=0;E<16;++E)x[E]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=b.g[0],v=b.g[1],E=b.g[2];let I=b.g[3],w;w=_+(I^v&(E^I))+x[0]+3614090360&4294967295,_=v+(w<<7&4294967295|w>>>25),w=I+(E^_&(v^E))+x[1]+3905402710&4294967295,I=_+(w<<12&4294967295|w>>>20),w=E+(v^I&(_^v))+x[2]+606105819&4294967295,E=I+(w<<17&4294967295|w>>>15),w=v+(_^E&(I^_))+x[3]+3250441966&4294967295,v=E+(w<<22&4294967295|w>>>10),w=_+(I^v&(E^I))+x[4]+4118548399&4294967295,_=v+(w<<7&4294967295|w>>>25),w=I+(E^_&(v^E))+x[5]+1200080426&4294967295,I=_+(w<<12&4294967295|w>>>20),w=E+(v^I&(_^v))+x[6]+2821735955&4294967295,E=I+(w<<17&4294967295|w>>>15),w=v+(_^E&(I^_))+x[7]+4249261313&4294967295,v=E+(w<<22&4294967295|w>>>10),w=_+(I^v&(E^I))+x[8]+1770035416&4294967295,_=v+(w<<7&4294967295|w>>>25),w=I+(E^_&(v^E))+x[9]+2336552879&4294967295,I=_+(w<<12&4294967295|w>>>20),w=E+(v^I&(_^v))+x[10]+4294925233&4294967295,E=I+(w<<17&4294967295|w>>>15),w=v+(_^E&(I^_))+x[11]+2304563134&4294967295,v=E+(w<<22&4294967295|w>>>10),w=_+(I^v&(E^I))+x[12]+1804603682&4294967295,_=v+(w<<7&4294967295|w>>>25),w=I+(E^_&(v^E))+x[13]+4254626195&4294967295,I=_+(w<<12&4294967295|w>>>20),w=E+(v^I&(_^v))+x[14]+2792965006&4294967295,E=I+(w<<17&4294967295|w>>>15),w=v+(_^E&(I^_))+x[15]+1236535329&4294967295,v=E+(w<<22&4294967295|w>>>10),w=_+(E^I&(v^E))+x[1]+4129170786&4294967295,_=v+(w<<5&4294967295|w>>>27),w=I+(v^E&(_^v))+x[6]+3225465664&4294967295,I=_+(w<<9&4294967295|w>>>23),w=E+(_^v&(I^_))+x[11]+643717713&4294967295,E=I+(w<<14&4294967295|w>>>18),w=v+(I^_&(E^I))+x[0]+3921069994&4294967295,v=E+(w<<20&4294967295|w>>>12),w=_+(E^I&(v^E))+x[5]+3593408605&4294967295,_=v+(w<<5&4294967295|w>>>27),w=I+(v^E&(_^v))+x[10]+38016083&4294967295,I=_+(w<<9&4294967295|w>>>23),w=E+(_^v&(I^_))+x[15]+3634488961&4294967295,E=I+(w<<14&4294967295|w>>>18),w=v+(I^_&(E^I))+x[4]+3889429448&4294967295,v=E+(w<<20&4294967295|w>>>12),w=_+(E^I&(v^E))+x[9]+568446438&4294967295,_=v+(w<<5&4294967295|w>>>27),w=I+(v^E&(_^v))+x[14]+3275163606&4294967295,I=_+(w<<9&4294967295|w>>>23),w=E+(_^v&(I^_))+x[3]+4107603335&4294967295,E=I+(w<<14&4294967295|w>>>18),w=v+(I^_&(E^I))+x[8]+1163531501&4294967295,v=E+(w<<20&4294967295|w>>>12),w=_+(E^I&(v^E))+x[13]+2850285829&4294967295,_=v+(w<<5&4294967295|w>>>27),w=I+(v^E&(_^v))+x[2]+4243563512&4294967295,I=_+(w<<9&4294967295|w>>>23),w=E+(_^v&(I^_))+x[7]+1735328473&4294967295,E=I+(w<<14&4294967295|w>>>18),w=v+(I^_&(E^I))+x[12]+2368359562&4294967295,v=E+(w<<20&4294967295|w>>>12),w=_+(v^E^I)+x[5]+4294588738&4294967295,_=v+(w<<4&4294967295|w>>>28),w=I+(_^v^E)+x[8]+2272392833&4294967295,I=_+(w<<11&4294967295|w>>>21),w=E+(I^_^v)+x[11]+1839030562&4294967295,E=I+(w<<16&4294967295|w>>>16),w=v+(E^I^_)+x[14]+4259657740&4294967295,v=E+(w<<23&4294967295|w>>>9),w=_+(v^E^I)+x[1]+2763975236&4294967295,_=v+(w<<4&4294967295|w>>>28),w=I+(_^v^E)+x[4]+1272893353&4294967295,I=_+(w<<11&4294967295|w>>>21),w=E+(I^_^v)+x[7]+4139469664&4294967295,E=I+(w<<16&4294967295|w>>>16),w=v+(E^I^_)+x[10]+3200236656&4294967295,v=E+(w<<23&4294967295|w>>>9),w=_+(v^E^I)+x[13]+681279174&4294967295,_=v+(w<<4&4294967295|w>>>28),w=I+(_^v^E)+x[0]+3936430074&4294967295,I=_+(w<<11&4294967295|w>>>21),w=E+(I^_^v)+x[3]+3572445317&4294967295,E=I+(w<<16&4294967295|w>>>16),w=v+(E^I^_)+x[6]+76029189&4294967295,v=E+(w<<23&4294967295|w>>>9),w=_+(v^E^I)+x[9]+3654602809&4294967295,_=v+(w<<4&4294967295|w>>>28),w=I+(_^v^E)+x[12]+3873151461&4294967295,I=_+(w<<11&4294967295|w>>>21),w=E+(I^_^v)+x[15]+530742520&4294967295,E=I+(w<<16&4294967295|w>>>16),w=v+(E^I^_)+x[2]+3299628645&4294967295,v=E+(w<<23&4294967295|w>>>9),w=_+(E^(v|~I))+x[0]+4096336452&4294967295,_=v+(w<<6&4294967295|w>>>26),w=I+(v^(_|~E))+x[7]+1126891415&4294967295,I=_+(w<<10&4294967295|w>>>22),w=E+(_^(I|~v))+x[14]+2878612391&4294967295,E=I+(w<<15&4294967295|w>>>17),w=v+(I^(E|~_))+x[5]+4237533241&4294967295,v=E+(w<<21&4294967295|w>>>11),w=_+(E^(v|~I))+x[12]+1700485571&4294967295,_=v+(w<<6&4294967295|w>>>26),w=I+(v^(_|~E))+x[3]+2399980690&4294967295,I=_+(w<<10&4294967295|w>>>22),w=E+(_^(I|~v))+x[10]+4293915773&4294967295,E=I+(w<<15&4294967295|w>>>17),w=v+(I^(E|~_))+x[1]+2240044497&4294967295,v=E+(w<<21&4294967295|w>>>11),w=_+(E^(v|~I))+x[8]+1873313359&4294967295,_=v+(w<<6&4294967295|w>>>26),w=I+(v^(_|~E))+x[15]+4264355552&4294967295,I=_+(w<<10&4294967295|w>>>22),w=E+(_^(I|~v))+x[6]+2734768916&4294967295,E=I+(w<<15&4294967295|w>>>17),w=v+(I^(E|~_))+x[13]+1309151649&4294967295,v=E+(w<<21&4294967295|w>>>11),w=_+(E^(v|~I))+x[4]+4149444226&4294967295,_=v+(w<<6&4294967295|w>>>26),w=I+(v^(_|~E))+x[11]+3174756917&4294967295,I=_+(w<<10&4294967295|w>>>22),w=E+(_^(I|~v))+x[2]+718787259&4294967295,E=I+(w<<15&4294967295|w>>>17),w=v+(I^(E|~_))+x[9]+3951481745&4294967295,b.g[0]=b.g[0]+_&4294967295,b.g[1]=b.g[1]+(E+(w<<21&4294967295|w>>>11))&4294967295,b.g[2]=b.g[2]+E&4294967295,b.g[3]=b.g[3]+I&4294967295}s.prototype.v=function(b,_){_===void 0&&(_=b.length);const v=_-this.blockSize,x=this.C;let E=this.h,I=0;for(;I<_;){if(E==0)for(;I<=v;)r(this,b,I),I+=this.blockSize;if(typeof b=="string"){for(;I<_;)if(x[E++]=b.charCodeAt(I++),E==this.blockSize){r(this,x),E=0;break}}else for(;I<_;)if(x[E++]=b[I++],E==this.blockSize){r(this,x),E=0;break}}this.h=E,this.o+=_},s.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var _=1;_<b.length-8;++_)b[_]=0;_=this.o*8;for(var v=b.length-8;v<b.length;++v)b[v]=_&255,_/=256;for(this.v(b),b=Array(16),_=0,v=0;v<4;++v)for(let x=0;x<32;x+=8)b[_++]=this.g[v]>>>x&255;return b};function i(b,_){var v=l;return Object.prototype.hasOwnProperty.call(v,b)?v[b]:v[b]=_(b)}function o(b,_){this.h=_;const v=[];let x=!0;for(let E=b.length-1;E>=0;E--){const I=b[E]|0;x&&I==_||(v[E]=I,x=!1)}this.g=v}var l={};function c(b){return-128<=b&&b<128?i(b,function(_){return new o([_|0],_<0?-1:0)}):new o([b|0],b<0?-1:0)}function h(b){if(isNaN(b)||!isFinite(b))return p;if(b<0)return k(h(-b));const _=[];let v=1;for(let x=0;b>=v;x++)_[x]=b/v|0,v*=4294967296;return new o(_,0)}function m(b,_){if(b.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(b.charAt(0)=="-")return k(m(b.substring(1),_));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=h(Math.pow(_,8));let x=p;for(let I=0;I<b.length;I+=8){var E=Math.min(8,b.length-I);const w=parseInt(b.substring(I,I+E),_);E<8?(E=h(Math.pow(_,E)),x=x.j(E).add(h(w))):(x=x.j(v),x=x.add(h(w)))}return x}var p=c(0),y=c(1),T=c(16777216);n=o.prototype,n.m=function(){if(R(this))return-k(this).m();let b=0,_=1;for(let v=0;v<this.g.length;v++){const x=this.i(v);b+=(x>=0?x:4294967296+x)*_,_*=4294967296}return b},n.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(N(this))return"0";if(R(this))return"-"+k(this).toString(b);const _=h(Math.pow(b,6));var v=this;let x="";for(;;){const E=z(v,_).g;v=q(v,E.j(_));let I=((v.g.length>0?v.g[0]:v.h)>>>0).toString(b);if(v=E,N(v))return I+x;for(;I.length<6;)I="0"+I;x=I+x}},n.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function N(b){if(b.h!=0)return!1;for(let _=0;_<b.g.length;_++)if(b.g[_]!=0)return!1;return!0}function R(b){return b.h==-1}n.l=function(b){return b=q(this,b),R(b)?-1:N(b)?0:1};function k(b){const _=b.g.length,v=[];for(let x=0;x<_;x++)v[x]=~b.g[x];return new o(v,~b.h).add(y)}n.abs=function(){return R(this)?k(this):this},n.add=function(b){const _=Math.max(this.g.length,b.g.length),v=[];let x=0;for(let E=0;E<=_;E++){let I=x+(this.i(E)&65535)+(b.i(E)&65535),w=(I>>>16)+(this.i(E)>>>16)+(b.i(E)>>>16);x=w>>>16,I&=65535,w&=65535,v[E]=w<<16|I}return new o(v,v[v.length-1]&-2147483648?-1:0)};function q(b,_){return b.add(k(_))}n.j=function(b){if(N(this)||N(b))return p;if(R(this))return R(b)?k(this).j(k(b)):k(k(this).j(b));if(R(b))return k(this.j(k(b)));if(this.l(T)<0&&b.l(T)<0)return h(this.m()*b.m());const _=this.g.length+b.g.length,v=[];for(var x=0;x<2*_;x++)v[x]=0;for(x=0;x<this.g.length;x++)for(let E=0;E<b.g.length;E++){const I=this.i(x)>>>16,w=this.i(x)&65535,ke=b.i(E)>>>16,nt=b.i(E)&65535;v[2*x+2*E]+=w*nt,W(v,2*x+2*E),v[2*x+2*E+1]+=I*nt,W(v,2*x+2*E+1),v[2*x+2*E+1]+=w*ke,W(v,2*x+2*E+1),v[2*x+2*E+2]+=I*ke,W(v,2*x+2*E+2)}for(b=0;b<_;b++)v[b]=v[2*b+1]<<16|v[2*b];for(b=_;b<2*_;b++)v[b]=0;return new o(v,0)};function W(b,_){for(;(b[_]&65535)!=b[_];)b[_+1]+=b[_]>>>16,b[_]&=65535,_++}function H(b,_){this.g=b,this.h=_}function z(b,_){if(N(_))throw Error("division by zero");if(N(b))return new H(p,p);if(R(b))return _=z(k(b),_),new H(k(_.g),k(_.h));if(R(_))return _=z(b,k(_)),new H(k(_.g),_.h);if(b.g.length>30){if(R(b)||R(_))throw Error("slowDivide_ only works with positive integers.");for(var v=y,x=_;x.l(b)<=0;)v=ue(v),x=ue(x);var E=B(v,1),I=B(x,1);for(x=B(x,2),v=B(v,2);!N(x);){var w=I.add(x);w.l(b)<=0&&(E=E.add(v),I=w),x=B(x,1),v=B(v,1)}return _=q(b,E.j(_)),new H(E,_)}for(E=p;b.l(_)>=0;){for(v=Math.max(1,Math.floor(b.m()/_.m())),x=Math.ceil(Math.log(v)/Math.LN2),x=x<=48?1:Math.pow(2,x-48),I=h(v),w=I.j(_);R(w)||w.l(b)>0;)v-=x,I=h(v),w=I.j(_);N(I)&&(I=y),E=E.add(I),b=q(b,w)}return new H(E,b)}n.B=function(b){return z(this,b).h},n.and=function(b){const _=Math.max(this.g.length,b.g.length),v=[];for(let x=0;x<_;x++)v[x]=this.i(x)&b.i(x);return new o(v,this.h&b.h)},n.or=function(b){const _=Math.max(this.g.length,b.g.length),v=[];for(let x=0;x<_;x++)v[x]=this.i(x)|b.i(x);return new o(v,this.h|b.h)},n.xor=function(b){const _=Math.max(this.g.length,b.g.length),v=[];for(let x=0;x<_;x++)v[x]=this.i(x)^b.i(x);return new o(v,this.h^b.h)};function ue(b){const _=b.g.length+1,v=[];for(let x=0;x<_;x++)v[x]=b.i(x)<<1|b.i(x-1)>>>31;return new o(v,b.h)}function B(b,_){const v=_>>5;_%=32;const x=b.g.length-v,E=[];for(let I=0;I<x;I++)E[I]=_>0?b.i(I+v)>>>_|b.i(I+v+1)<<32-_:b.i(I+v);return new o(E,b.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Zd=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=m,En=o}).apply(typeof Vu<"u"?Vu:typeof self<"u"?self:typeof window<"u"?window:{});var Si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ef,_r,tf,Li,Va,nf,sf,rf;(function(){var n,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Si=="object"&&Si];for(var u=0;u<a.length;++u){var d=a[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var s=t(this);function r(a,u){if(u)e:{var d=s;a=a.split(".");for(var g=0;g<a.length-1;g++){var C=a[g];if(!(C in d))break e;d=d[C]}a=a[a.length-1],g=d[a],u=u(g),u!=g&&u!=null&&e(d,a,{configurable:!0,writable:!0,value:u})}}r("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(a){return a||function(u){var d=[],g;for(g in u)Object.prototype.hasOwnProperty.call(u,g)&&d.push([g,u[g]]);return d}});var i=i||{},o=this||self;function l(a){var u=typeof a;return u=="object"&&a!=null||u=="function"}function c(a,u,d){return a.call.apply(a.bind,arguments)}function h(a,u,d){return h=c,h.apply(null,arguments)}function m(a,u){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function p(a,u){function d(){}d.prototype=u.prototype,a.Z=u.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(g,C,S){for(var M=Array(arguments.length-2),ee=2;ee<arguments.length;ee++)M[ee-2]=arguments[ee];return u.prototype[C].apply(g,M)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function T(a){const u=a.length;if(u>0){const d=Array(u);for(let g=0;g<u;g++)d[g]=a[g];return d}return[]}function N(a,u){for(let g=1;g<arguments.length;g++){const C=arguments[g];var d=typeof C;if(d=d!="object"?d:C?Array.isArray(C)?"array":d:"null",d=="array"||d=="object"&&typeof C.length=="number"){d=a.length||0;const S=C.length||0;a.length=d+S;for(let M=0;M<S;M++)a[d+M]=C[M]}else a.push(C)}}class R{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function k(a){o.setTimeout(()=>{throw a},0)}function q(){var a=b;let u=null;return a.g&&(u=a.g,a.g=a.g.next,a.g||(a.h=null),u.next=null),u}class W{constructor(){this.h=this.g=null}add(u,d){const g=H.get();g.set(u,d),this.h?this.h.next=g:this.g=g,this.h=g}}var H=new R(()=>new z,a=>a.reset());class z{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let ue,B=!1,b=new W,_=()=>{const a=Promise.resolve(void 0);ue=()=>{a.then(v)}};function v(){for(var a;a=q();){try{a.h.call(a.g)}catch(d){k(d)}var u=H;u.j(a),u.h<100&&(u.h++,a.next=u.g,u.g=a)}B=!1}function x(){this.u=this.u,this.C=this.C}x.prototype.u=!1,x.prototype.dispose=function(){this.u||(this.u=!0,this.N())},x.prototype[Symbol.dispose]=function(){this.dispose()},x.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(a,u){this.type=a,this.g=this.target=u,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,u=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};o.addEventListener("test",d,u),o.removeEventListener("test",d,u)}catch{}return a})();function w(a){return/^[\s\xa0]*$/.test(a)}function ke(a,u){E.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,u)}p(ke,E),ke.prototype.init=function(a,u){const d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=u,u=a.relatedTarget,u||(d=="mouseover"?u=a.fromElement:d=="mouseout"&&(u=a.toElement)),this.relatedTarget=u,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&ke.Z.h.call(this)},ke.prototype.h=function(){ke.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var nt="closure_listenable_"+(Math.random()*1e6|0),gt=0;function It(a,u,d,g,C){this.listener=a,this.proxy=null,this.src=u,this.type=d,this.capture=!!g,this.ha=C,this.key=++gt,this.da=this.fa=!1}function $(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Wt(a,u,d){for(const g in a)u.call(d,a[g],g,a)}function ln(a,u){for(const d in a)u.call(void 0,a[d],d,a)}function Un(a){const u={};for(const d in a)u[d]=a[d];return u}const Vt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Pe(a,u){let d,g;for(let C=1;C<arguments.length;C++){g=arguments[C];for(d in g)a[d]=g[d];for(let S=0;S<Vt.length;S++)d=Vt[S],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function Re(a){this.src=a,this.g={},this.h=0}Re.prototype.add=function(a,u,d,g,C){const S=a.toString();a=this.g[S],a||(a=this.g[S]=[],this.h++);const M=Ht(a,u,g,C);return M>-1?(u=a[M],d||(u.fa=!1)):(u=new It(u,this.src,S,!!g,C),u.fa=d,a.push(u)),u};function Xe(a,u){const d=u.type;if(d in a.g){var g=a.g[d],C=Array.prototype.indexOf.call(g,u,void 0),S;(S=C>=0)&&Array.prototype.splice.call(g,C,1),S&&($(u),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Ht(a,u,d,g){for(let C=0;C<a.length;++C){const S=a[C];if(!S.da&&S.listener==u&&S.capture==!!d&&S.ha==g)return C}return-1}var be="closure_lm_"+(Math.random()*1e6|0),Kt={};function Ct(a,u,d,g,C){if(Array.isArray(u)){for(let S=0;S<u.length;S++)Ct(a,u[S],d,g,C);return null}return d=ci(d),a&&a[nt]?a.J(u,d,l(g)?!!g.capture:!1,C):Mt(a,u,d,!1,g,C)}function Mt(a,u,d,g,C,S){if(!u)throw Error("Invalid event type");const M=l(C)?!!C.capture:!!C;let ee=Js(a);if(ee||(a[be]=ee=new Re(a)),d=ee.add(u,d,g,M,S),d.proxy)return d;if(g=ht(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)I||(C=M),C===void 0&&(C=!1),a.addEventListener(u.toString(),g,C);else if(a.attachEvent)a.attachEvent(us(u.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function ht(){function a(d){return u.call(a.src,a.listener,d)}const u=li;return a}function _t(a,u,d,g,C){if(Array.isArray(u))for(var S=0;S<u.length;S++)_t(a,u[S],d,g,C);else g=l(g)?!!g.capture:!!g,d=ci(d),a&&a[nt]?(a=a.i,S=String(u).toString(),S in a.g&&(u=a.g[S],d=Ht(u,d,g,C),d>-1&&($(u[d]),Array.prototype.splice.call(u,d,1),u.length==0&&(delete a.g[S],a.h--)))):a&&(a=Js(a))&&(u=a.g[u.toString()],a=-1,u&&(a=Ht(u,d,g,C)),(d=a>-1?u[a]:null)&&Bn(d))}function Bn(a){if(typeof a!="number"&&a&&!a.da){var u=a.src;if(u&&u[nt])Xe(u.i,a);else{var d=a.type,g=a.proxy;u.removeEventListener?u.removeEventListener(d,g,a.capture):u.detachEvent?u.detachEvent(us(d),g):u.addListener&&u.removeListener&&u.removeListener(g),(d=Js(u))?(Xe(d,a),d.h==0&&(d.src=null,u[be]=null)):$(a)}}}function us(a){return a in Kt?Kt[a]:Kt[a]="on"+a}function li(a,u){if(a.da)a=!0;else{u=new ke(u,this);const d=a.listener,g=a.ha||a.src;a.fa&&Bn(a),a=d.call(g,u)}return a}function Js(a){return a=a[be],a instanceof Re?a:null}var zn="__closure_events_fn_"+(Math.random()*1e9>>>0);function ci(a){return typeof a=="function"?a:(a[zn]||(a[zn]=function(u){return a.handleEvent(u)}),a[zn])}function De(){x.call(this),this.i=new Re(this),this.M=this,this.G=null}p(De,x),De.prototype[nt]=!0,De.prototype.removeEventListener=function(a,u,d,g){_t(this,a,u,d,g)};function Je(a,u){var d,g=a.G;if(g)for(d=[];g;g=g.G)d.push(g);if(a=a.M,g=u.type||u,typeof u=="string")u=new E(u,a);else if(u instanceof E)u.target=u.target||a;else{var C=u;u=new E(g,a),Pe(u,C)}C=!0;let S,M;if(d)for(M=d.length-1;M>=0;M--)S=u.g=d[M],C=_e(S,g,!0,u)&&C;if(S=u.g=a,C=_e(S,g,!0,u)&&C,C=_e(S,g,!1,u)&&C,d)for(M=0;M<d.length;M++)S=u.g=d[M],C=_e(S,g,!1,u)&&C}De.prototype.N=function(){if(De.Z.N.call(this),this.i){var a=this.i;for(const u in a.g){const d=a.g[u];for(let g=0;g<d.length;g++)$(d[g]);delete a.g[u],a.h--}}this.G=null},De.prototype.J=function(a,u,d,g){return this.i.add(String(a),u,!1,d,g)},De.prototype.K=function(a,u,d,g){return this.i.add(String(a),u,!0,d,g)};function _e(a,u,d,g){if(u=a.i.g[String(u)],!u)return!0;u=u.concat();let C=!0;for(let S=0;S<u.length;++S){const M=u[S];if(M&&!M.da&&M.capture==d){const ee=M.listener,Ue=M.ha||M.src;M.fa&&Xe(a.i,M),C=ee.call(Ue,g)!==!1&&C}}return C&&!g.defaultPrevented}function hs(a,u){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:o.setTimeout(a,u||0)}function ui(a){a.g=hs(()=>{a.g=null,a.i&&(a.i=!1,ui(a))},a.l);const u=a.h;a.h=null,a.m.apply(null,u)}class hi extends x{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:ui(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(a){x.call(this),this.h=a,this.g={}}p(Qt,x);var ds=[];function di(a){Wt(a.g,function(u,d){this.g.hasOwnProperty(d)&&Bn(u)},a),a.g={}}Qt.prototype.N=function(){Qt.Z.N.call(this),di(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zs=o.JSON.stringify,Wo=o.JSON.parse,er=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function fs(){}function fi(){}var cn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function A(){E.call(this,"d")}p(A,E);function Y(){E.call(this,"c")}p(Y,E);var ne={},yt=null;function Fe(){return yt=yt||new De}ne.Ia="serverreachability";function qn(a){E.call(this,ne.Ia,a)}p(qn,E);function dt(a){const u=Fe();Je(u,new qn(u))}ne.STAT_EVENT="statevent";function me(a,u){E.call(this,ne.STAT_EVENT,a),this.stat=u}p(me,E);function ye(a){const u=Fe();Je(u,new me(u,a))}ne.Ja="timingevent";function mi(a,u){E.call(this,ne.Ja,a),this.size=u}p(mi,E);function bt(a,u){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},u)}function Yt(){this.g=!0}Yt.prototype.ua=function(){this.g=!1};function Ot(a,u,d,g,C,S){a.info(function(){if(a.g)if(S){var M="",ee=S.split("&");for(let pe=0;pe<ee.length;pe++){var Ue=ee[pe].split("=");if(Ue.length>1){const He=Ue[0];Ue=Ue[1];const jt=He.split("_");M=jt.length>=2&&jt[1]=="type"?M+(He+"="+Ue+"&"):M+(He+"=redacted&")}}}else M=null;else M=S;return"XMLHTTP REQ ("+g+") [attempt "+C+"]: "+u+`
`+d+`
`+M})}function $n(a,u,d,g,C,S,M){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+C+"]: "+u+`
`+d+`
`+S+" "+M})}function We(a,u,d,g){a.info(function(){return"XMLHTTP TEXT ("+u+"): "+Ko(a,d)+(g?" "+g:"")})}function Ho(a,u){a.info(function(){return"TIMEOUT: "+u})}Yt.prototype.info=function(){};function Ko(a,u){if(!a.g)return u;if(!u)return null;try{const S=JSON.parse(u);if(S){for(a=0;a<S.length;a++)if(Array.isArray(S[a])){var d=S[a];if(!(d.length<2)){var g=d[1];if(Array.isArray(g)&&!(g.length<1)){var C=g[0];if(C!="noop"&&C!="stop"&&C!="close")for(let M=1;M<g.length;M++)g[M]=""}}}}return Zs(S)}catch{return u}}var le={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},st={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Et;function tr(){}p(tr,fs),tr.prototype.g=function(){return new XMLHttpRequest},Et=new tr;function un(a){return encodeURIComponent(String(a))}function eg(a){var u=1;a=a.split(":");const d=[];for(;u>0&&a.length;)d.push(a.shift()),u--;return a.length&&d.push(a.join(":")),d}function hn(a,u,d,g){this.j=a,this.i=u,this.l=d,this.S=g||1,this.V=new Qt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ac}function Ac(){this.i=null,this.g="",this.h=!1}var Sc={},Qo={};function Yo(a,u,d){a.M=1,a.A=gi(Lt(u)),a.u=d,a.R=!0,Rc(a,null)}function Rc(a,u){a.F=Date.now(),pi(a),a.B=Lt(a.A);var d=a.B,g=a.S;Array.isArray(g)||(g=[String(g)]),zc(d.i,"t",g),a.C=0,d=a.j.L,a.h=new Ac,a.g=ou(a.j,d?u:null,!a.u),a.P>0&&(a.O=new hi(h(a.Y,a,a.g),a.P)),u=a.V,d=a.g,g=a.ba;var C="readystatechange";Array.isArray(C)||(C&&(ds[0]=C.toString()),C=ds);for(let S=0;S<C.length;S++){const M=Ct(d,C[S],g||u.handleEvent,!1,u.h||u);if(!M)break;u.g[M.key]=M}u=a.J?Un(a.J):{},a.u?(a.v||(a.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,u)):(a.v="GET",a.g.ea(a.B,a.v,null,u)),dt(),Ot(a.i,a.v,a.B,a.l,a.S,a.u)}hn.prototype.ba=function(a){a=a.target;const u=this.O;u&&mn(a)==3?u.j():this.Y(a)},hn.prototype.Y=function(a){try{if(a==this.g)e:{const ee=mn(this.g),Ue=this.g.ya(),pe=this.g.ca();if(!(ee<3)&&(ee!=3||this.g&&(this.h.h||this.g.la()||Qc(this.g)))){this.K||ee!=4||Ue==7||(Ue==8||pe<=0?dt(3):dt(2)),Xo(this);var u=this.g.ca();this.X=u;var d=tg(this);if(this.o=u==200,$n(this.i,this.v,this.B,this.l,this.S,ee,u),this.o){if(this.U&&!this.L){t:{if(this.g){var g,C=this.g;if((g=C.g?C.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!w(g)){var S=g;break t}}S=null}if(a=S)We(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Jo(this,a);else{this.o=!1,this.m=3,ye(12),Gn(this),nr(this);break e}}if(this.R){a=!0;let He;for(;!this.K&&this.C<d.length;)if(He=ng(this,d),He==Qo){ee==4&&(this.m=4,ye(14),a=!1),We(this.i,this.l,null,"[Incomplete Response]");break}else if(He==Sc){this.m=4,ye(15),We(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else We(this.i,this.l,He,null),Jo(this,He);if(Nc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ee!=4||d.length!=0||this.h.h||(this.m=1,ye(16),a=!1),this.o=this.o&&a,!a)We(this.i,this.l,d,"[Invalid Chunked Response]"),Gn(this),nr(this);else if(d.length>0&&!this.W){this.W=!0;var M=this.j;M.g==this&&M.aa&&!M.P&&(M.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),oa(M),M.P=!0,ye(11))}}else We(this.i,this.l,d,null),Jo(this,d);ee==4&&Gn(this),this.o&&!this.K&&(ee==4?nu(this.j,this):(this.o=!1,pi(this)))}else gg(this.g),u==400&&d.indexOf("Unknown SID")>0?(this.m=3,ye(12)):(this.m=0,ye(13)),Gn(this),nr(this)}}}catch{}};function tg(a){if(!Nc(a))return a.g.la();const u=Qc(a.g);if(u==="")return"";let d="";const g=u.length,C=mn(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return Gn(a),nr(a),"";a.h.i=new o.TextDecoder}for(let S=0;S<g;S++)a.h.h=!0,d+=a.h.i.decode(u[S],{stream:!(C&&S==g-1)});return u.length=0,a.h.g+=d,a.C=0,a.h.g}function Nc(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function ng(a,u){var d=a.C,g=u.indexOf(`
`,d);return g==-1?Qo:(d=Number(u.substring(d,g)),isNaN(d)?Sc:(g+=1,g+d>u.length?Qo:(u=u.slice(g,g+d),a.C=g+d,u)))}hn.prototype.cancel=function(){this.K=!0,Gn(this)};function pi(a){a.T=Date.now()+a.H,kc(a,a.H)}function kc(a,u){if(a.D!=null)throw Error("WatchDog timer not null");a.D=bt(h(a.aa,a),u)}function Xo(a){a.D&&(o.clearTimeout(a.D),a.D=null)}hn.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(Ho(this.i,this.B),this.M!=2&&(dt(),ye(17)),Gn(this),this.m=2,nr(this)):kc(this,this.T-a)};function nr(a){a.j.I==0||a.K||nu(a.j,a)}function Gn(a){Xo(a);var u=a.O;u&&typeof u.dispose=="function"&&u.dispose(),a.O=null,di(a.V),a.g&&(u=a.g,a.g=null,u.abort(),u.dispose())}function Jo(a,u){try{var d=a.j;if(d.I!=0&&(d.g==a||Zo(d.h,a))){if(!a.L&&Zo(d.h,a)&&d.I==3){try{var g=d.Ba.g.parse(u)}catch{g=null}if(Array.isArray(g)&&g.length==3){var C=g;if(C[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)bi(d),vi(d);else break e;ia(d),ye(18)}}else d.xa=C[1],0<d.xa-d.K&&C[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=bt(h(d.Va,d),6e3));Vc(d.h)<=1&&d.ta&&(d.ta=void 0)}else Hn(d,11)}else if((a.L||d.g==a)&&bi(d),!w(u))for(C=d.Ba.g.parse(u),u=0;u<C.length;u++){let pe=C[u];const He=pe[0];if(!(He<=d.K))if(d.K=He,pe=pe[1],d.I==2)if(pe[0]=="c"){d.M=pe[1],d.ba=pe[2];const jt=pe[3];jt!=null&&(d.ka=jt,d.j.info("VER="+d.ka));const Kn=pe[4];Kn!=null&&(d.za=Kn,d.j.info("SVER="+d.za));const pn=pe[5];pn!=null&&typeof pn=="number"&&pn>0&&(g=1.5*pn,d.O=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const gn=a.g;if(gn){const xi=gn.g?gn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xi){var S=g.h;S.g||xi.indexOf("spdy")==-1&&xi.indexOf("quic")==-1&&xi.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(ea(S,S.h),S.h=null))}if(g.G){const aa=gn.g?gn.g.getResponseHeader("X-HTTP-Session-Id"):null;aa&&(g.wa=aa,Ee(g.J,g.G,aa))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),g=d;var M=a;if(g.na=iu(g,g.L?g.ba:null,g.W),M.L){Mc(g.h,M);var ee=M,Ue=g.O;Ue&&(ee.H=Ue),ee.D&&(Xo(ee),pi(ee)),g.g=M}else eu(g);d.i.length>0&&wi(d)}else pe[0]!="stop"&&pe[0]!="close"||Hn(d,7);else d.I==3&&(pe[0]=="stop"||pe[0]=="close"?pe[0]=="stop"?Hn(d,7):ra(d):pe[0]!="noop"&&d.l&&d.l.qa(pe),d.A=0)}}dt(4)}catch{}}var sg=class{constructor(a,u){this.g=a,this.map=u}};function Pc(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Dc(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Vc(a){return a.h?1:a.g?a.g.size:0}function Zo(a,u){return a.h?a.h==u:a.g?a.g.has(u):!1}function ea(a,u){a.g?a.g.add(u):a.h=u}function Mc(a,u){a.h&&a.h==u?a.h=null:a.g&&a.g.has(u)&&a.g.delete(u)}Pc.prototype.cancel=function(){if(this.i=Oc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const a of this.g.values())a.cancel();this.g.clear()}};function Oc(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let u=a.i;for(const d of a.g.values())u=u.concat(d.G);return u}return T(a.i)}var Lc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rg(a,u){if(a){a=a.split("&");for(let d=0;d<a.length;d++){const g=a[d].indexOf("=");let C,S=null;g>=0?(C=a[d].substring(0,g),S=a[d].substring(g+1)):C=a[d],u(C,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function dn(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;a instanceof dn?(this.l=a.l,sr(this,a.j),this.o=a.o,this.g=a.g,rr(this,a.u),this.h=a.h,ta(this,qc(a.i)),this.m=a.m):a&&(u=String(a).match(Lc))?(this.l=!1,sr(this,u[1]||"",!0),this.o=ir(u[2]||""),this.g=ir(u[3]||"",!0),rr(this,u[4]),this.h=ir(u[5]||"",!0),ta(this,u[6]||"",!0),this.m=ir(u[7]||"")):(this.l=!1,this.i=new ar(null,this.l))}dn.prototype.toString=function(){const a=[];var u=this.j;u&&a.push(or(u,jc,!0),":");var d=this.g;return(d||u=="file")&&(a.push("//"),(u=this.o)&&a.push(or(u,jc,!0),"@"),a.push(un(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(or(d,d.charAt(0)=="/"?ag:og,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",or(d,cg)),a.join("")},dn.prototype.resolve=function(a){const u=Lt(this);let d=!!a.j;d?sr(u,a.j):d=!!a.o,d?u.o=a.o:d=!!a.g,d?u.g=a.g:d=a.u!=null;var g=a.h;if(d)rr(u,a.u);else if(d=!!a.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var C=u.h.lastIndexOf("/");C!=-1&&(g=u.h.slice(0,C+1)+g)}if(C=g,C==".."||C==".")g="";else if(C.indexOf("./")!=-1||C.indexOf("/.")!=-1){g=C.lastIndexOf("/",0)==0,C=C.split("/");const S=[];for(let M=0;M<C.length;){const ee=C[M++];ee=="."?g&&M==C.length&&S.push(""):ee==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),g&&M==C.length&&S.push("")):(S.push(ee),g=!0)}g=S.join("/")}else g=C}return d?u.h=g:d=a.i.toString()!=="",d?ta(u,qc(a.i)):d=!!a.m,d&&(u.m=a.m),u};function Lt(a){return new dn(a)}function sr(a,u,d){a.j=d?ir(u,!0):u,a.j&&(a.j=a.j.replace(/:$/,""))}function rr(a,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);a.u=u}else a.u=null}function ta(a,u,d){u instanceof ar?(a.i=u,ug(a.i,a.l)):(d||(u=or(u,lg)),a.i=new ar(u,a.l))}function Ee(a,u,d){a.i.set(u,d)}function gi(a){return Ee(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function ir(a,u){return a?u?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function or(a,u,d){return typeof a=="string"?(a=encodeURI(a).replace(u,ig),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function ig(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var jc=/[#\/\?@]/g,og=/[#\?:]/g,ag=/[#\?]/g,lg=/[#\?@]/g,cg=/#/g;function ar(a,u){this.h=this.g=null,this.i=a||null,this.j=!!u}function Wn(a){a.g||(a.g=new Map,a.h=0,a.i&&rg(a.i,function(u,d){a.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=ar.prototype,n.add=function(a,u){Wn(this),this.i=null,a=ms(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(u),this.h+=1,this};function Fc(a,u){Wn(a),u=ms(a,u),a.g.has(u)&&(a.i=null,a.h-=a.g.get(u).length,a.g.delete(u))}function Uc(a,u){return Wn(a),u=ms(a,u),a.g.has(u)}n.forEach=function(a,u){Wn(this),this.g.forEach(function(d,g){d.forEach(function(C){a.call(u,C,g,this)},this)},this)};function Bc(a,u){Wn(a);let d=[];if(typeof u=="string")Uc(a,u)&&(d=d.concat(a.g.get(ms(a,u))));else for(a=Array.from(a.g.values()),u=0;u<a.length;u++)d=d.concat(a[u]);return d}n.set=function(a,u){return Wn(this),this.i=null,a=ms(this,a),Uc(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[u]),this.h+=1,this},n.get=function(a,u){return a?(a=Bc(this,a),a.length>0?String(a[0]):u):u};function zc(a,u,d){Fc(a,u),d.length>0&&(a.i=null,a.g.set(ms(a,u),T(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],u=Array.from(this.g.keys());for(let g=0;g<u.length;g++){var d=u[g];const C=un(d);d=Bc(this,d);for(let S=0;S<d.length;S++){let M=C;d[S]!==""&&(M+="="+un(d[S])),a.push(M)}}return this.i=a.join("&")};function qc(a){const u=new ar;return u.i=a.i,a.g&&(u.g=new Map(a.g),u.h=a.h),u}function ms(a,u){return u=String(u),a.j&&(u=u.toLowerCase()),u}function ug(a,u){u&&!a.j&&(Wn(a),a.i=null,a.g.forEach(function(d,g){const C=g.toLowerCase();g!=C&&(Fc(this,g),zc(this,C,d))},a)),a.j=u}function hg(a,u){const d=new Yt;if(o.Image){const g=new Image;g.onload=m(fn,d,"TestLoadImage: loaded",!0,u,g),g.onerror=m(fn,d,"TestLoadImage: error",!1,u,g),g.onabort=m(fn,d,"TestLoadImage: abort",!1,u,g),g.ontimeout=m(fn,d,"TestLoadImage: timeout",!1,u,g),o.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else u(!1)}function dg(a,u){const d=new Yt,g=new AbortController,C=setTimeout(()=>{g.abort(),fn(d,"TestPingServer: timeout",!1,u)},1e4);fetch(a,{signal:g.signal}).then(S=>{clearTimeout(C),S.ok?fn(d,"TestPingServer: ok",!0,u):fn(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(C),fn(d,"TestPingServer: error",!1,u)})}function fn(a,u,d,g,C){try{C&&(C.onload=null,C.onerror=null,C.onabort=null,C.ontimeout=null),g(d)}catch{}}function fg(){this.g=new er}function na(a){this.i=a.Sb||null,this.h=a.ab||!1}p(na,fs),na.prototype.g=function(){return new _i(this.i,this.h)};function _i(a,u){De.call(this),this.H=a,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(_i,De),n=_i.prototype,n.open=function(a,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=u,this.readyState=1,cr(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(u.body=a),(this.H||o).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,lr(this)),this.readyState=0},n.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,cr(this)),this.g&&(this.readyState=3,cr(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;$c(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function $c(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}n.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var u=a.value?a.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!a.done}))&&(this.response=this.responseText+=u)}a.done?lr(this):cr(this),this.readyState==3&&$c(this)}},n.Oa=function(a){this.g&&(this.response=this.responseText=a,lr(this))},n.Na=function(a){this.g&&(this.response=a,lr(this))},n.ga=function(){this.g&&lr(this)};function lr(a){a.readyState=4,a.l=null,a.j=null,a.B=null,cr(a)}n.setRequestHeader=function(a,u){this.A.append(a,u)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=u.next();return a.join(`\r
`)};function cr(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(_i.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Gc(a){let u="";return Wt(a,function(d,g){u+=g,u+=":",u+=d,u+=`\r
`}),u}function sa(a,u,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Gc(d),typeof a=="string"?d!=null&&un(d):Ee(a,u,d))}function Ce(a){De.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(Ce,De);var mg=/^https?$/i,pg=["POST","PUT"];n=Ce.prototype,n.Fa=function(a){this.H=a},n.ea=function(a,u,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);u=u?u.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Et.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(u,String(a),!0),this.B=!1}catch(S){Wc(this,S);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var C in g)d.set(C,g[C]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const S of g.keys())d.set(S,g.get(S));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),C=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(pg,u,void 0)>=0)||g||C||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,M]of d)this.g.setRequestHeader(S,M);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(S){Wc(this,S)}};function Wc(a,u){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=u,a.o=5,Hc(a),yi(a)}function Hc(a){a.A||(a.A=!0,Je(a,"complete"),Je(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,Je(this,"complete"),Je(this,"abort"),yi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),yi(this,!0)),Ce.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Kc(this):this.Xa())},n.Xa=function(){Kc(this)};function Kc(a){if(a.h&&typeof i<"u"){if(a.v&&mn(a)==4)setTimeout(a.Ca.bind(a),0);else if(Je(a,"readystatechange"),mn(a)==4){a.h=!1;try{const S=a.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var g;if(g=S===0){let M=String(a.D).match(Lc)[1]||null;!M&&o.self&&o.self.location&&(M=o.self.location.protocol.slice(0,-1)),g=!mg.test(M?M.toLowerCase():"")}d=g}if(d)Je(a,"complete"),Je(a,"success");else{a.o=6;try{var C=mn(a)>2?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.ca()+"]",Hc(a)}}finally{yi(a)}}}}function yi(a,u){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const d=a.g;a.g=null,u||Je(a,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function mn(a){return a.g?a.g.readyState:0}n.ca=function(){try{return mn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(a){if(this.g){var u=this.g.responseText;return a&&u.indexOf(a)==0&&(u=u.substring(a.length)),Wo(u)}};function Qc(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function gg(a){const u={};a=(a.g&&mn(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(w(a[g]))continue;var d=eg(a[g]);const C=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const S=u[C]||[];u[C]=S,S.push(d)}ln(u,function(g){return g.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ur(a,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||u}function Yc(a){this.za=0,this.i=[],this.j=new Yt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ur("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ur("baseRetryDelayMs",5e3,a),this.Za=ur("retryDelaySeedMs",1e4,a),this.Ta=ur("forwardChannelMaxRetries",2,a),this.va=ur("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Pc(a&&a.concurrentRequestLimit),this.Ba=new fg,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Yc.prototype,n.ka=8,n.I=1,n.connect=function(a,u,d,g){ye(0),this.W=a,this.H=u||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.J=iu(this,null,this.W),wi(this)};function ra(a){if(Xc(a),a.I==3){var u=a.V++,d=Lt(a.J);if(Ee(d,"SID",a.M),Ee(d,"RID",u),Ee(d,"TYPE","terminate"),hr(a,d),u=new hn(a,a.j,u),u.M=2,u.A=gi(Lt(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(u.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=u.A,d=!0),d||(u.g=ou(u.j,null),u.g.ea(u.A)),u.F=Date.now(),pi(u)}ru(a)}function vi(a){a.g&&(oa(a),a.g.cancel(),a.g=null)}function Xc(a){vi(a),a.v&&(o.clearTimeout(a.v),a.v=null),bi(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function wi(a){if(!Dc(a.h)&&!a.m){a.m=!0;var u=a.Ea;ue||_(),B||(ue(),B=!0),b.add(u,a),a.D=0}}function _g(a,u){return Vc(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=u.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=bt(h(a.Ea,a,u),su(a,a.D)),a.D++,!0)}n.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;const C=new hn(this,this.j,a);let S=this.o;if(this.U&&(S?(S=Un(S),Pe(S,this.U)):S=this.U),this.u!==null||this.R||(C.J=S,S=null),this.S)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(u+=g,u>4096){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=Zc(this,C,u),d=Lt(this.J),Ee(d,"RID",a),Ee(d,"CVER",22),this.G&&Ee(d,"X-HTTP-Session-Id",this.G),hr(this,d),S&&(this.R?u="headers="+un(Gc(S))+"&"+u:this.u&&sa(d,this.u,S)),ea(this.h,C),this.Ra&&Ee(d,"TYPE","init"),this.S?(Ee(d,"$req",u),Ee(d,"SID","null"),C.U=!0,Yo(C,d,null)):Yo(C,d,u),this.I=2}}else this.I==3&&(a?Jc(this,a):this.i.length==0||Dc(this.h)||Jc(this))};function Jc(a,u){var d;u?d=u.l:d=a.V++;const g=Lt(a.J);Ee(g,"SID",a.M),Ee(g,"RID",d),Ee(g,"AID",a.K),hr(a,g),a.u&&a.o&&sa(g,a.u,a.o),d=new hn(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),u&&(a.i=u.G.concat(a.i)),u=Zc(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),ea(a.h,d),Yo(d,g,u)}function hr(a,u){a.H&&Wt(a.H,function(d,g){Ee(u,g,d)}),a.l&&Wt({},function(d,g){Ee(u,g,d)})}function Zc(a,u,d){d=Math.min(a.i.length,d);const g=a.l?h(a.l.Ka,a.l,a):null;e:{var C=a.i;let ee=-1;for(;;){const Ue=["count="+d];ee==-1?d>0?(ee=C[0].g,Ue.push("ofs="+ee)):ee=0:Ue.push("ofs="+ee);let pe=!0;for(let He=0;He<d;He++){var S=C[He].g;const jt=C[He].map;if(S-=ee,S<0)ee=Math.max(0,C[He].g-100),pe=!1;else try{S="req"+S+"_"||"";try{var M=jt instanceof Map?jt:Object.entries(jt);for(const[Kn,pn]of M){let gn=pn;l(pn)&&(gn=Zs(pn)),Ue.push(S+Kn+"="+encodeURIComponent(gn))}}catch(Kn){throw Ue.push(S+"type="+encodeURIComponent("_badmap")),Kn}}catch{g&&g(jt)}}if(pe){M=Ue.join("&");break e}}M=void 0}return a=a.i.splice(0,d),u.G=a,M}function eu(a){if(!a.g&&!a.v){a.Y=1;var u=a.Da;ue||_(),B||(ue(),B=!0),b.add(u,a),a.A=0}}function ia(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=bt(h(a.Da,a),su(a,a.A)),a.A++,!0)}n.Da=function(){if(this.v=null,tu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=bt(h(this.Wa,this),a)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ye(10),vi(this),tu(this))};function oa(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function tu(a){a.g=new hn(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var u=Lt(a.na);Ee(u,"RID","rpc"),Ee(u,"SID",a.M),Ee(u,"AID",a.K),Ee(u,"CI",a.F?"0":"1"),!a.F&&a.ia&&Ee(u,"TO",a.ia),Ee(u,"TYPE","xmlhttp"),hr(a,u),a.u&&a.o&&sa(u,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=gi(Lt(u)),d.u=null,d.R=!0,Rc(d,a)}n.Va=function(){this.C!=null&&(this.C=null,vi(this),ia(this),ye(19))};function bi(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function nu(a,u){var d=null;if(a.g==u){bi(a),oa(a),a.g=null;var g=2}else if(Zo(a.h,u))d=u.G,Mc(a.h,u),g=1;else return;if(a.I!=0){if(u.o)if(g==1){d=u.u?u.u.length:0,u=Date.now()-u.F;var C=a.D;g=Fe(),Je(g,new mi(g,d)),wi(a)}else eu(a);else if(C=u.m,C==3||C==0&&u.X>0||!(g==1&&_g(a,u)||g==2&&ia(a)))switch(d&&d.length>0&&(u=a.h,u.i=u.i.concat(d)),C){case 1:Hn(a,5);break;case 4:Hn(a,10);break;case 3:Hn(a,6);break;default:Hn(a,2)}}}function su(a,u){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*u}function Hn(a,u){if(a.j.info("Error code "+u),u==2){var d=h(a.bb,a),g=a.Ua;const C=!g;g=new dn(g||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||sr(g,"https"),gi(g),C?hg(g.toString(),d):dg(g.toString(),d)}else ye(2);a.I=0,a.l&&a.l.pa(u),ru(a),Xc(a)}n.bb=function(a){a?(this.j.info("Successfully pinged google.com"),ye(2)):(this.j.info("Failed to ping google.com"),ye(1))};function ru(a){if(a.I=0,a.ja=[],a.l){const u=Oc(a.h);(u.length!=0||a.i.length!=0)&&(N(a.ja,u),N(a.ja,a.i),a.h.i.length=0,T(a.i),a.i.length=0),a.l.oa()}}function iu(a,u,d){var g=d instanceof dn?Lt(d):new dn(d);if(g.g!="")u&&(g.g=u+"."+g.g),rr(g,g.u);else{var C=o.location;g=C.protocol,u=u?u+"."+C.hostname:C.hostname,C=+C.port;const S=new dn(null);g&&sr(S,g),u&&(S.g=u),C&&rr(S,C),d&&(S.h=d),g=S}return d=a.G,u=a.wa,d&&u&&Ee(g,d,u),Ee(g,"VER",a.ka),hr(a,g),g}function ou(a,u,d){if(u&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=a.Aa&&!a.ma?new Ce(new na({ab:d})):new Ce(a.ma),u.Fa(a.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function au(){}n=au.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ei(){}Ei.prototype.g=function(a,u){return new vt(a,u)};function vt(a,u){De.call(this),this.g=new Yc(u),this.l=a,this.h=u&&u.messageUrlParams||null,a=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(a?a["X-WebChannel-Content-Type"]=u.messageContentType:a={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(a?a["X-WebChannel-Client-Profile"]=u.sa:a={"X-WebChannel-Client-Profile":u.sa}),this.g.U=a,(a=u&&u.Qb)&&!w(a)&&(this.g.u=a),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!w(u)&&(this.g.G=u,a=this.h,a!==null&&u in a&&(a=this.h,u in a&&delete a[u])),this.j=new ps(this)}p(vt,De),vt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},vt.prototype.close=function(){ra(this.g)},vt.prototype.o=function(a){var u=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=Zs(a),a=d);u.i.push(new sg(u.Ya++,a)),u.I==3&&wi(u)},vt.prototype.N=function(){this.g.l=null,delete this.j,ra(this.g),delete this.g,vt.Z.N.call(this)};function lu(a){A.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var u=a.__sm__;if(u){e:{for(const d in u){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,u=u!==null&&a in u?u[a]:void 0),this.data=u}else this.data=a}p(lu,A);function cu(){Y.call(this),this.status=1}p(cu,Y);function ps(a){this.g=a}p(ps,au),ps.prototype.ra=function(){Je(this.g,"a")},ps.prototype.qa=function(a){Je(this.g,new lu(a))},ps.prototype.pa=function(a){Je(this.g,new cu)},ps.prototype.oa=function(){Je(this.g,"b")},Ei.prototype.createWebChannel=Ei.prototype.g,vt.prototype.send=vt.prototype.o,vt.prototype.open=vt.prototype.m,vt.prototype.close=vt.prototype.close,rf=function(){return new Ei},sf=function(){return Fe()},nf=ne,Va={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},le.NO_ERROR=0,le.TIMEOUT=8,le.HTTP_ERROR=6,Li=le,st.COMPLETE="complete",tf=st,fi.EventType=cn,cn.OPEN="a",cn.CLOSE="b",cn.ERROR="c",cn.MESSAGE="d",De.prototype.listen=De.prototype.J,_r=fi,Ce.prototype.listenOnce=Ce.prototype.K,Ce.prototype.getLastError=Ce.prototype.Ha,Ce.prototype.getLastErrorCode=Ce.prototype.ya,Ce.prototype.getStatus=Ce.prototype.ca,Ce.prototype.getResponseJson=Ce.prototype.La,Ce.prototype.getResponseText=Ce.prototype.la,Ce.prototype.send=Ce.prototype.ea,Ce.prototype.setWithCredentials=Ce.prototype.Fa,ef=Ce}).apply(typeof Si<"u"?Si:typeof self<"u"?self:typeof window<"u"?window:{});const Mu="@firebase/firestore",Ou="4.9.3";class it{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}it.UNAUTHENTICATED=new it(null),it.GOOGLE_CREDENTIALS=new it("google-credentials-uid"),it.FIRST_PARTY=new it("first-party-uid"),it.MOCK_USER=new it("mock-user");let Gs="12.7.0";const es=new ml("@firebase/firestore");function ys(){return es.logLevel}function j(n,...e){if(es.logLevel<=ce.DEBUG){const t=e.map(gl);es.debug(`Firestore (${Gs}): ${n}`,...t)}}function nn(n,...e){if(es.logLevel<=ce.ERROR){const t=e.map(gl);es.error(`Firestore (${Gs}): ${n}`,...t)}}function ks(n,...e){if(es.logLevel<=ce.WARN){const t=e.map(gl);es.warn(`Firestore (${Gs}): ${n}`,...t)}}function gl(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function Q(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,of(n,s,t)}function of(n,e,t){let s=`FIRESTORE (${Gs}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw nn(s),new Error(s)}function fe(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||of(e,r,s)}function Z(n,e){return n}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends $s{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class xn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class af{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(it.UNAUTHENTICATED)))}shutdown(){}}class Uv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Bv{constructor(e){this.t=e,this.currentUser=it.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){fe(this.o===void 0,42304);let s=this.i;const r=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let i=new xn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new xn,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const c=i;e.enqueueRetryable((async()=>{await c.promise,await r(this.currentUser)}))},l=c=>{j("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((c=>l(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(j("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new xn)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(j("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(fe(typeof s.accessToken=="string",31837,{l:s}),new af(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return fe(e===null||typeof e=="string",2055,{h:e}),new it(e)}}class zv{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=it.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class qv{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new zv(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(it.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Lu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $v{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Hd(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){fe(this.o===void 0,3512);const s=i=>{i.error!=null&&j("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,j("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>s(i)))};const r=i=>{j("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>r(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):j("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Lu(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(fe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Lu(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Gv(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class _l{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=Gv(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function oe(n,e){return n<e?-1:n>e?1:0}function Ma(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return pa(r)===pa(i)?oe(r,i):pa(r)?1:-1}return oe(n.length,e.length)}const Wv=55296,Hv=57343;function pa(n){const e=n.charCodeAt(0);return e>=Wv&&e<=Hv}function Ps(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}const ju="__name__";class Ft{constructor(e,t,s){t===void 0?t=0:t>e.length&&Q(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&Q(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return Ft.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ft?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=Ft.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return oe(e.length,t.length)}static compareSegments(e,t){const s=Ft.isNumericId(e),r=Ft.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?Ft.extractNumericId(e).compare(Ft.extractNumericId(t)):Ma(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return En.fromString(e.substring(4,e.length-2))}}class we extends Ft{construct(e,t,s){return new we(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new L(P.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new we(t)}static emptyPath(){return new we([])}}const Kv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends Ft{construct(e,t,s){return new et(e,t,s)}static isValidIdentifier(e){return Kv.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),et.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ju}static keyField(){return new et([ju])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new L(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const l=e[r];if(l==="\\"){if(r+1===e.length)throw new L(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new L(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=c,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(s+=l,r++):(i(),r++)}if(i(),o)throw new L(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new et(t)}static emptyPath(){return new et([])}}class G{constructor(e){this.path=e}static fromPath(e){return new G(we.fromString(e))}static fromName(e){return new G(we.fromString(e).popFirst(5))}static empty(){return new G(we.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&we.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return we.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new G(new we(e.slice()))}}function lf(n,e,t){if(!t)throw new L(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Qv(n,e,t,s){if(e===!0&&s===!0)throw new L(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Fu(n){if(!G.isDocumentKey(n))throw new L(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Uu(n){if(G.isDocumentKey(n))throw new L(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function cf(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function xo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Q(12329,{type:typeof n})}function Ds(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=xo(n);throw new L(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Le(n,e){const t={typeString:n};return e&&(t.value=e),t}function Yr(n,e){if(!cf(n))throw new L(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new L(P.INVALID_ARGUMENT,t);return!0}const Bu=-62135596800,zu=1e6;class Te{static now(){return Te.fromMillis(Date.now())}static fromDate(e){return Te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*zu);return new Te(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Bu)throw new L(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/zu}_compareTo(e){return this.seconds===e.seconds?oe(this.nanoseconds,e.nanoseconds):oe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Te._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Yr(e,Te._jsonSchema))return new Te(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Te._jsonSchemaVersion="firestore/timestamp/1.0",Te._jsonSchema={type:Le("string",Te._jsonSchemaVersion),seconds:Le("number"),nanoseconds:Le("number")};class J{static fromTimestamp(e){return new J(e)}static min(){return new J(new Te(0,0))}static max(){return new J(new Te(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Vr=-1;function Yv(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=J.fromTimestamp(s===1e9?new Te(t+1,0):new Te(t,s));return new Rn(r,G.empty(),e)}function Xv(n){return new Rn(n.readTime,n.key,Vr)}class Rn{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Rn(J.min(),G.empty(),Vr)}static max(){return new Rn(J.max(),G.empty(),Vr)}}function Jv(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=G.comparator(n.documentKey,e.documentKey),t!==0?t:oe(n.largestBatchId,e.largestBatchId))}const Zv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ew{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ws(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==Zv)throw n;j("LocalStore","Unexpectedly lost primary lease")}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D(((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):D.reject(t)}static resolve(e){return new D(((t,s)=>{t(e)}))}static reject(e){return new D(((t,s)=>{s(e)}))}static waitFor(e){return new D(((t,s)=>{let r=0,i=0,o=!1;e.forEach((l=>{++r,l.next((()=>{++i,o&&i===r&&t()}),(c=>s(c)))})),o=!0,i===r&&t()}))}static or(e){let t=D.resolve(!1);for(const s of e)t=t.next((r=>r?D.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,i)=>{s.push(t.call(this,r,i))})),this.waitFor(s)}static mapArray(e,t){return new D(((s,r)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const h=c;t(e[h]).next((m=>{o[h]=m,++l,l===i&&s(o)}),(m=>r(m)))}}))}static doWhile(e,t){return new D(((s,r)=>{const i=()=>{e()===!0?t().next((()=>{i()}),r):s()};i()}))}}function tw(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Hs(n){return n.name==="IndexedDbTransactionError"}class To{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}To.ce=-1;const yl=-1;function Io(n){return n==null}function Qi(n){return n===0&&1/n==-1/0}function nw(n){return typeof n=="number"&&Number.isInteger(n)&&!Qi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const uf="";function sw(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=qu(e)),e=rw(n.get(t),e);return qu(e)}function rw(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case uf:t+="";break;default:t+=i}}return t}function qu(n){return n+uf+""}function $u(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function is(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function hf(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}let je=class Oa{constructor(e,t){this.comparator=e,this.root=t||Tn.EMPTY}insert(e,t){return new Oa(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Tn.BLACK,null,null))}remove(e){return new Oa(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Tn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ri(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ri(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ri(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ri(this.root,e,this.comparator,!0)}},Ri=class{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Tn=class Jt{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Jt.RED,this.left=r??Jt.EMPTY,this.right=i??Jt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Jt(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Jt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Jt.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Jt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Jt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Q(27949);return e+(this.isRed()?0:1)}};Tn.EMPTY=null,Tn.RED=!0,Tn.BLACK=!1;Tn.EMPTY=new class{constructor(){this.size=0}get key(){throw Q(57766)}get value(){throw Q(16141)}get color(){throw Q(16727)}get left(){throw Q(29726)}get right(){throw Q(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Tn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ge{constructor(e){this.comparator=e,this.data=new je(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Gu(this.data.getIterator())}getIteratorFrom(e){return new Gu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Ge)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ge(this.comparator);return t.data=e,t}}class Gu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class St{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new St([])}unionWith(e){let t=new Ge(et.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new St(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ps(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class df extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new df("Invalid base64 string: "+i):i}})(e);return new tt(t)}static fromUint8Array(e){const t=(function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i})(e);return new tt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return oe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tt.EMPTY_BYTE_STRING=new tt("");const iw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nn(n){if(fe(!!n,39018),typeof n=="string"){let e=0;const t=iw.exec(n);if(fe(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ne(n.seconds),nanos:Ne(n.nanos)}}function Ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function kn(n){return typeof n=="string"?tt.fromBase64String(n):tt.fromUint8Array(n)}const ff="server_timestamp",mf="__type__",pf="__previous_value__",gf="__local_write_time__";function vl(n){return(n?.mapValue?.fields||{})[mf]?.stringValue===ff}function Co(n){const e=n.mapValue.fields[pf];return vl(e)?Co(e):e}function Mr(n){const e=Nn(n.mapValue.fields[gf].timestampValue);return new Te(e.seconds,e.nanos)}class ow{constructor(e,t,s,r,i,o,l,c,h,m){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=m}}const Yi="(default)";class Or{constructor(e,t){this.projectId=e,this.database=t||Yi}static empty(){return new Or("","")}get isDefaultDatabase(){return this.database===Yi}isEqual(e){return e instanceof Or&&e.projectId===this.projectId&&e.database===this.database}}const _f="__type__",aw="__max__",Ni={mapValue:{}},yf="__vector__",Xi="value";function Pn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vl(n)?4:cw(n)?9007199254740991:lw(n)?10:11:Q(28295,{value:n})}function Gt(n,e){if(n===e)return!0;const t=Pn(n);if(t!==Pn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Mr(n).isEqual(Mr(e));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Nn(r.timestampValue),l=Nn(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,i){return kn(r.bytesValue).isEqual(kn(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,i){return Ne(r.geoPointValue.latitude)===Ne(i.geoPointValue.latitude)&&Ne(r.geoPointValue.longitude)===Ne(i.geoPointValue.longitude)})(n,e);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return Ne(r.integerValue)===Ne(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=Ne(r.doubleValue),l=Ne(i.doubleValue);return o===l?Qi(o)===Qi(l):isNaN(o)&&isNaN(l)}return!1})(n,e);case 9:return Ps(n.arrayValue.values||[],e.arrayValue.values||[],Gt);case 10:case 11:return(function(r,i){const o=r.mapValue.fields||{},l=i.mapValue.fields||{};if($u(o)!==$u(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Gt(o[c],l[c])))return!1;return!0})(n,e);default:return Q(52216,{left:n})}}function Lr(n,e){return(n.values||[]).find((t=>Gt(t,e)))!==void 0}function Vs(n,e){if(n===e)return 0;const t=Pn(n),s=Pn(e);if(t!==s)return oe(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return oe(n.booleanValue,e.booleanValue);case 2:return(function(i,o){const l=Ne(i.integerValue||i.doubleValue),c=Ne(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1})(n,e);case 3:return Wu(n.timestampValue,e.timestampValue);case 4:return Wu(Mr(n),Mr(e));case 5:return Ma(n.stringValue,e.stringValue);case 6:return(function(i,o){const l=kn(i),c=kn(o);return l.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(i,o){const l=i.split("/"),c=o.split("/");for(let h=0;h<l.length&&h<c.length;h++){const m=oe(l[h],c[h]);if(m!==0)return m}return oe(l.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,o){const l=oe(Ne(i.latitude),Ne(o.latitude));return l!==0?l:oe(Ne(i.longitude),Ne(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Hu(n.arrayValue,e.arrayValue);case 10:return(function(i,o){const l=i.fields||{},c=o.fields||{},h=l[Xi]?.arrayValue,m=c[Xi]?.arrayValue,p=oe(h?.values?.length||0,m?.values?.length||0);return p!==0?p:Hu(h,m)})(n.mapValue,e.mapValue);case 11:return(function(i,o){if(i===Ni.mapValue&&o===Ni.mapValue)return 0;if(i===Ni.mapValue)return 1;if(o===Ni.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),h=o.fields||{},m=Object.keys(h);c.sort(),m.sort();for(let p=0;p<c.length&&p<m.length;++p){const y=Ma(c[p],m[p]);if(y!==0)return y;const T=Vs(l[c[p]],h[m[p]]);if(T!==0)return T}return oe(c.length,m.length)})(n.mapValue,e.mapValue);default:throw Q(23264,{he:t})}}function Wu(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return oe(n,e);const t=Nn(n),s=Nn(e),r=oe(t.seconds,s.seconds);return r!==0?r:oe(t.nanos,s.nanos)}function Hu(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=Vs(t[r],s[r]);if(i)return i}return oe(t.length,s.length)}function Ms(n){return La(n)}function La(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=Nn(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return kn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return G.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=La(i);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${La(t.fields[o])}`;return r+"}"})(n.mapValue):Q(61005,{value:n})}function ji(n){switch(Pn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Co(n);return e?16+ji(e):16;case 5:return 2*n.stringValue.length;case 6:return kn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,i)=>r+ji(i)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return is(s.fields,((i,o)=>{r+=i.length+ji(o)})),r})(n.mapValue);default:throw Q(13486,{value:n})}}function Ku(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ja(n){return!!n&&"integerValue"in n}function wl(n){return!!n&&"arrayValue"in n}function Qu(n){return!!n&&"nullValue"in n}function Yu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Fi(n){return!!n&&"mapValue"in n}function lw(n){return(n?.mapValue?.fields||{})[_f]?.stringValue===yf}function br(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return is(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=br(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=br(n.arrayValue.values[t]);return e}return{...n}}function cw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===aw}class xt{constructor(e){this.value=e}static empty(){return new xt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Fi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=br(t)}setAll(e){let t=et.emptyPath(),s={},r=[];e.forEach(((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,s,r),s={},r=[],t=l.popLast()}o?s[l.lastSegment()]=br(o):r.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());Fi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Gt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Fi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){is(t,((r,i)=>e[r]=i));for(const r of s)delete e[r]}clone(){return new xt(br(this.value))}}function vf(n){const e=[];return is(n.fields,((t,s)=>{const r=new et([t]);if(Fi(s)){const i=vf(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)})),new St(e)}class at{constructor(e,t,s,r,i,o,l){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new at(e,0,J.min(),J.min(),J.min(),xt.empty(),0)}static newFoundDocument(e,t,s,r){return new at(e,1,t,J.min(),s,r,0)}static newNoDocument(e,t){return new at(e,2,t,J.min(),J.min(),xt.empty(),0)}static newUnknownDocument(e,t){return new at(e,3,t,J.min(),J.min(),xt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(J.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=J.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof at&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new at(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ji{constructor(e,t){this.position=e,this.inclusive=t}}function Xu(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=G.comparator(G.fromName(o.referenceValue),t.key):s=Vs(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function Ju(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Gt(n.position[t],e.position[t]))return!1;return!0}class jr{constructor(e,t="asc"){this.field=e,this.dir=t}}function uw(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class wf{}class Oe extends wf{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new dw(e,t,s):t==="array-contains"?new pw(e,s):t==="in"?new gw(e,s):t==="not-in"?new _w(e,s):t==="array-contains-any"?new yw(e,s):new Oe(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new fw(e,s):new mw(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Vs(t,this.value)):t!==null&&Pn(this.value)===Pn(t)&&this.matchesComparison(Vs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Dt extends wf{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Dt(e,t)}matches(e){return bf(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function bf(n){return n.op==="and"}function Ef(n){return hw(n)&&bf(n)}function hw(n){for(const e of n.filters)if(e instanceof Dt)return!1;return!0}function Fa(n){if(n instanceof Oe)return n.field.canonicalString()+n.op.toString()+Ms(n.value);if(Ef(n))return n.filters.map((e=>Fa(e))).join(",");{const e=n.filters.map((t=>Fa(t))).join(",");return`${n.op}(${e})`}}function xf(n,e){return n instanceof Oe?(function(s,r){return r instanceof Oe&&s.op===r.op&&s.field.isEqual(r.field)&&Gt(s.value,r.value)})(n,e):n instanceof Dt?(function(s,r){return r instanceof Dt&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((i,o,l)=>i&&xf(o,r.filters[l])),!0):!1})(n,e):void Q(19439)}function Tf(n){return n instanceof Oe?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ms(t.value)}`})(n):n instanceof Dt?(function(t){return t.op.toString()+" {"+t.getFilters().map(Tf).join(" ,")+"}"})(n):"Filter"}class dw extends Oe{constructor(e,t,s){super(e,t,s),this.key=G.fromName(s.referenceValue)}matches(e){const t=G.comparator(e.key,this.key);return this.matchesComparison(t)}}class fw extends Oe{constructor(e,t){super(e,"in",t),this.keys=If("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class mw extends Oe{constructor(e,t){super(e,"not-in",t),this.keys=If("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function If(n,e){return(e.arrayValue?.values||[]).map((t=>G.fromName(t.referenceValue)))}class pw extends Oe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return wl(t)&&Lr(t.arrayValue,this.value)}}class gw extends Oe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Lr(this.value.arrayValue,t)}}class _w extends Oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Lr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Lr(this.value.arrayValue,t)}}class yw extends Oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!wl(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>Lr(this.value.arrayValue,s)))}}class vw{constructor(e,t=null,s=[],r=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=l,this.Te=null}}function Zu(n,e=null,t=[],s=[],r=null,i=null,o=null){return new vw(n,e,t,s,r,i,o)}function bl(n){const e=Z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>Fa(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(i){return i.field.canonicalString()+i.dir})(s))).join(","),Io(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>Ms(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>Ms(s))).join(",")),e.Te=t}return e.Te}function El(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!uw(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!xf(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ju(n.startAt,e.startAt)&&Ju(n.endAt,e.endAt)}function Ua(n){return G.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Ks{constructor(e,t=null,s=[],r=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ww(n,e,t,s,r,i,o,l){return new Ks(n,e,t,s,r,i,o,l)}function Cf(n){return new Ks(n)}function eh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Af(n){return n.collectionGroup!==null}function Er(n){const e=Z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Ge(et.comparator);return o.filters.forEach((c=>{c.getFlattenedFilters().forEach((h=>{h.isInequality()&&(l=l.add(h.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new jr(i,s))})),t.has(et.keyField().canonicalString())||e.Ie.push(new jr(et.keyField(),s))}return e.Ie}function Ut(n){const e=Z(n);return e.Ee||(e.Ee=bw(e,Er(n))),e.Ee}function bw(n,e){if(n.limitType==="F")return Zu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const i=r.dir==="desc"?"asc":"desc";return new jr(r.field,i)}));const t=n.endAt?new Ji(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Ji(n.startAt.position,n.startAt.inclusive):null;return Zu(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Ba(n,e){const t=n.filters.concat([e]);return new Ks(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Zi(n,e,t){return new Ks(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ao(n,e){return El(Ut(n),Ut(e))&&n.limitType===e.limitType}function Sf(n){return`${bl(Ut(n))}|lt:${n.limitType}`}function vs(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>Tf(r))).join(", ")}]`),Io(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>Ms(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>Ms(r))).join(",")),`Target(${s})`})(Ut(n))}; limitType=${n.limitType})`}function So(n,e){return e.isFoundDocument()&&(function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):G.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)})(n,e)&&(function(s,r){for(const i of Er(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(o,l,c){const h=Xu(o,l,c);return o.inclusive?h<=0:h<0})(s.startAt,Er(s),r)||s.endAt&&!(function(o,l,c){const h=Xu(o,l,c);return o.inclusive?h>=0:h>0})(s.endAt,Er(s),r))})(n,e)}function Ew(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Rf(n){return(e,t)=>{let s=!1;for(const r of Er(n)){const i=xw(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function xw(n,e,t){const s=n.field.isKeyField()?G.comparator(e.key,t.key):(function(i,o,l){const c=o.data.field(i),h=l.data.field(i);return c!==null&&h!==null?Vs(c,h):Q(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Q(19790,{direction:n.dir})}}class os{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){is(this.inner,((t,s)=>{for(const[r,i]of s)e(r,i)}))}isEmpty(){return hf(this.inner)}size(){return this.innerSize}}const Tw=new je(G.comparator);function sn(){return Tw}const Nf=new je(G.comparator);function yr(...n){let e=Nf;for(const t of n)e=e.insert(t.key,t);return e}function kf(n){let e=Nf;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function Jn(){return xr()}function Pf(){return xr()}function xr(){return new os((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Iw=new je(G.comparator),Cw=new Ge(G.comparator);function ae(...n){let e=Cw;for(const t of n)e=e.add(t);return e}const Aw=new Ge(oe);function Sw(){return Aw}function xl(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qi(e)?"-0":e}}function Df(n){return{integerValue:""+n}}function Rw(n,e){return nw(e)?Df(e):xl(n,e)}class Ro{constructor(){this._=void 0}}function Nw(n,e,t){return n instanceof eo?(function(r,i){const o={fields:{[mf]:{stringValue:ff},[gf]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&vl(i)&&(i=Co(i)),i&&(o.fields[pf]=i),{mapValue:o}})(t,e):n instanceof Fr?Mf(n,e):n instanceof Ur?Of(n,e):(function(r,i){const o=Vf(r,i),l=th(o)+th(r.Ae);return ja(o)&&ja(r.Ae)?Df(l):xl(r.serializer,l)})(n,e)}function kw(n,e,t){return n instanceof Fr?Mf(n,e):n instanceof Ur?Of(n,e):t}function Vf(n,e){return n instanceof to?(function(s){return ja(s)||(function(i){return!!i&&"doubleValue"in i})(s)})(e)?e:{integerValue:0}:null}class eo extends Ro{}class Fr extends Ro{constructor(e){super(),this.elements=e}}function Mf(n,e){const t=Lf(e);for(const s of n.elements)t.some((r=>Gt(r,s)))||t.push(s);return{arrayValue:{values:t}}}class Ur extends Ro{constructor(e){super(),this.elements=e}}function Of(n,e){let t=Lf(e);for(const s of n.elements)t=t.filter((r=>!Gt(r,s)));return{arrayValue:{values:t}}}class to extends Ro{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function th(n){return Ne(n.integerValue||n.doubleValue)}function Lf(n){return wl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Pw(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof Fr&&r instanceof Fr||s instanceof Ur&&r instanceof Ur?Ps(s.elements,r.elements,Gt):s instanceof to&&r instanceof to?Gt(s.Ae,r.Ae):s instanceof eo&&r instanceof eo})(n.transform,e.transform)}class Dw{constructor(e,t){this.version=e,this.transformResults=t}}class Bt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Bt}static exists(e){return new Bt(void 0,e)}static updateTime(e){return new Bt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ui(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class No{}function jf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Tl(n.key,Bt.none()):new Xr(n.key,n.data,Bt.none());{const t=n.data,s=xt.empty();let r=new Ge(et.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new as(n.key,s,new St(r.toArray()),Bt.none())}}function Vw(n,e,t){n instanceof Xr?(function(r,i,o){const l=r.value.clone(),c=sh(r.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,e,t):n instanceof as?(function(r,i,o){if(!Ui(r.precondition,i))return void i.convertToUnknownDocument(o.version);const l=sh(r.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(Ff(r)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Tr(n,e,t,s){return n instanceof Xr?(function(i,o,l,c){if(!Ui(i.precondition,o))return l;const h=i.value.clone(),m=rh(i.fieldTransforms,c,o);return h.setAll(m),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,s):n instanceof as?(function(i,o,l,c){if(!Ui(i.precondition,o))return l;const h=rh(i.fieldTransforms,c,o),m=o.data;return m.setAll(Ff(i)),m.setAll(h),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((p=>p.field)))})(n,e,t,s):(function(i,o,l){return Ui(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l})(n,e,t)}function Mw(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=Vf(s.transform,r||null);i!=null&&(t===null&&(t=xt.empty()),t.set(s.field,i))}return t||null}function nh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Ps(s,r,((i,o)=>Pw(i,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Xr extends No{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class as extends No{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ff(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function sh(n,e,t){const s=new Map;fe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,l=e.data.field(i.field);s.set(i.field,kw(o,l,t[r]))}return s}function rh(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,Nw(i,o,e))}return s}class Tl extends No{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ow extends No{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Lw{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&Vw(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Tr(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Tr(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Pf();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=t.has(r.key)?null:l;const c=jf(o,l);c!==null&&s.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(J.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ae())}isEqual(e){return this.batchId===e.batchId&&Ps(this.mutations,e.mutations,((t,s)=>nh(t,s)))&&Ps(this.baseMutations,e.baseMutations,((t,s)=>nh(t,s)))}}class Il{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){fe(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return Iw})();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new Il(e,t,s,r)}}class jw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Fw{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ve,he;function Uw(n){switch(n){case P.OK:return Q(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return Q(15467,{code:n})}}function Uf(n){if(n===void 0)return nn("GRPC error has no .code"),P.UNKNOWN;switch(n){case Ve.OK:return P.OK;case Ve.CANCELLED:return P.CANCELLED;case Ve.UNKNOWN:return P.UNKNOWN;case Ve.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ve.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ve.INTERNAL:return P.INTERNAL;case Ve.UNAVAILABLE:return P.UNAVAILABLE;case Ve.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ve.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ve.NOT_FOUND:return P.NOT_FOUND;case Ve.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ve.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ve.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ve.ABORTED:return P.ABORTED;case Ve.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ve.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ve.DATA_LOSS:return P.DATA_LOSS;default:return Q(39323,{code:n})}}(he=Ve||(Ve={}))[he.OK=0]="OK",he[he.CANCELLED=1]="CANCELLED",he[he.UNKNOWN=2]="UNKNOWN",he[he.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",he[he.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",he[he.NOT_FOUND=5]="NOT_FOUND",he[he.ALREADY_EXISTS=6]="ALREADY_EXISTS",he[he.PERMISSION_DENIED=7]="PERMISSION_DENIED",he[he.UNAUTHENTICATED=16]="UNAUTHENTICATED",he[he.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",he[he.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",he[he.ABORTED=10]="ABORTED",he[he.OUT_OF_RANGE=11]="OUT_OF_RANGE",he[he.UNIMPLEMENTED=12]="UNIMPLEMENTED",he[he.INTERNAL=13]="INTERNAL",he[he.UNAVAILABLE=14]="UNAVAILABLE",he[he.DATA_LOSS=15]="DATA_LOSS";function Bw(){return new TextEncoder}const zw=new En([4294967295,4294967295],0);function ih(n){const e=Bw().encode(n),t=new Zd;return t.update(e),new Uint8Array(t.digest())}function oh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new En([t,s],0),new En([r,i],0)]}class Cl{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new vr(`Invalid padding: ${t}`);if(s<0)throw new vr(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new vr(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new vr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=En.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(En.fromNumber(s)));return r.compare(zw)===1&&(r=new En([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=ih(e),[s,r]=oh(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Cl(i,r,t);return s.forEach((l=>o.insert(l))),o}insert(e){if(this.ge===0)return;const t=ih(e),[s,r]=oh(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class vr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ko{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,Jr.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new ko(J.min(),r,new je(oe),sn(),ae())}}class Jr{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Jr(s,t,ae(),ae(),ae())}}class Bi{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Bf{constructor(e,t){this.targetId=e,this.Ce=t}}class zf{constructor(e,t,s=tt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class ah{constructor(){this.ve=0,this.Fe=lh(),this.Me=tt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ae(),t=ae(),s=ae();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:Q(38017,{changeType:i})}})),new Jr(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=lh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,fe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class qw{constructor(e){this.Ge=e,this.ze=new Map,this.je=sn(),this.Je=ki(),this.He=ki(),this.Ye=new je(oe)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:Q(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Ua(i))if(s===0){const o=new G(i.path);this.et(t,o,at.newNoDocument(o,J.min()))}else fe(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(t);const h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,l;try{o=kn(s).toUint8Array()}catch(c){if(c instanceof df)return ks("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Cl(o,r,i)}catch(c){return ks(c instanceof vr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((i=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((i,o)=>{const l=this.ot(o);if(l){if(i.current&&Ua(l.target)){const c=new G(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,at.newNoDocument(c,e))}i.Be&&(t.set(o,i.ke()),i.qe())}}));let s=ae();this.He.forEach(((i,o)=>{let l=!0;o.forEachWhile((c=>{const h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(s=s.add(i))})),this.je.forEach(((i,o)=>o.setReadTime(e)));const r=new ko(e,t,this.Ye,this.je,s);return this.je=sn(),this.Je=ki(),this.He=ki(),this.Ye=new je(oe),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ah,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ge(oe),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ge(oe),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||j("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ah),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ki(){return new je(G.comparator)}function lh(){return new je(G.comparator)}const $w={asc:"ASCENDING",desc:"DESCENDING"},Gw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ww={and:"AND",or:"OR"};class Hw{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function za(n,e){return n.useProto3Json||Io(e)?e:{value:e}}function no(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Kw(n,e){return no(n,e.toTimestamp())}function zt(n){return fe(!!n,49232),J.fromTimestamp((function(t){const s=Nn(t);return new Te(s.seconds,s.nanos)})(n))}function Al(n,e){return qa(n,e).canonicalString()}function qa(n,e){const t=(function(r){return new we(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function $f(n){const e=we.fromString(n);return fe(Qf(e),10190,{key:e.toString()}),e}function $a(n,e){return Al(n.databaseId,e.path)}function ga(n,e){const t=$f(e);if(t.get(1)!==n.databaseId.projectId)throw new L(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new G(Wf(t))}function Gf(n,e){return Al(n.databaseId,e)}function Qw(n){const e=$f(n);return e.length===4?we.emptyPath():Wf(e)}function Ga(n){return new we(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Wf(n){return fe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ch(n,e,t){return{name:$a(n,e),fields:t.value.mapValue.fields}}function Yw(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Q(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=(function(h,m){return h.useProto3Json?(fe(m===void 0||typeof m=="string",58123),tt.fromBase64String(m||"")):(fe(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),tt.fromUint8Array(m||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&(function(h){const m=h.code===void 0?P.UNKNOWN:Uf(h.code);return new L(m,h.message||"")})(o);t=new zf(s,r,i,l||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=ga(n,s.document.name),i=zt(s.document.updateTime),o=s.document.createTime?zt(s.document.createTime):J.min(),l=new xt({mapValue:{fields:s.document.fields}}),c=at.newFoundDocument(r,i,o,l),h=s.targetIds||[],m=s.removedTargetIds||[];t=new Bi(h,m,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=ga(n,s.document),i=s.readTime?zt(s.readTime):J.min(),o=at.newNoDocument(r,i),l=s.removedTargetIds||[];t=new Bi([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=ga(n,s.document),i=s.removedTargetIds||[];t=new Bi([],i,r,null)}else{if(!("filter"in e))return Q(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new Fw(r,i),l=s.targetId;t=new Bf(l,o)}}return t}function Xw(n,e){let t;if(e instanceof Xr)t={update:ch(n,e.key,e.value)};else if(e instanceof Tl)t={delete:$a(n,e.key)};else if(e instanceof as)t={update:ch(n,e.key,e.data),updateMask:ob(e.fieldMask)};else{if(!(e instanceof Ow))return Q(16599,{Vt:e.type});t={verify:$a(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(i,o){const l=o.transform;if(l instanceof eo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Fr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ur)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof to)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw Q(20930,{transform:o.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:Kw(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Q(27497)})(n,e.precondition)),t}function Jw(n,e){return n&&n.length>0?(fe(e!==void 0,14353),n.map((t=>(function(r,i){let o=r.updateTime?zt(r.updateTime):zt(i);return o.isEqual(J.min())&&(o=zt(i)),new Dw(o,r.transformResults||[])})(t,e)))):[]}function Zw(n,e){return{documents:[Gf(n,e.path)]}}function eb(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=Gf(n,r);const i=(function(h){if(h.length!==0)return Kf(Dt.create(h,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const o=(function(h){if(h.length!==0)return h.map((m=>(function(y){return{field:ws(y.field),direction:sb(y.dir)}})(m)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=za(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:r}}function tb(n){let e=Qw(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){fe(s===1,65062);const m=t.from[0];m.allDescendants?r=m.collectionId:e=e.child(m.collectionId)}let i=[];t.where&&(i=(function(p){const y=Hf(p);return y instanceof Dt&&Ef(y)?y.getFilters():[y]})(t.where));let o=[];t.orderBy&&(o=(function(p){return p.map((y=>(function(N){return new jr(bs(N.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(N.direction))})(y)))})(t.orderBy));let l=null;t.limit&&(l=(function(p){let y;return y=typeof p=="object"?p.value:p,Io(y)?null:y})(t.limit));let c=null;t.startAt&&(c=(function(p){const y=!!p.before,T=p.values||[];return new Ji(T,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(p){const y=!p.before,T=p.values||[];return new Ji(T,y)})(t.endAt)),ww(e,r,o,i,l,"F",c,h)}function nb(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Q(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Hf(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=bs(t.unaryFilter.field);return Oe.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=bs(t.unaryFilter.field);return Oe.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=bs(t.unaryFilter.field);return Oe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=bs(t.unaryFilter.field);return Oe.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Q(61313);default:return Q(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Oe.create(bs(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Q(58110);default:return Q(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Dt.create(t.compositeFilter.filters.map((s=>Hf(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Q(1026)}})(t.compositeFilter.op))})(n):Q(30097,{filter:n})}function sb(n){return $w[n]}function rb(n){return Gw[n]}function ib(n){return Ww[n]}function ws(n){return{fieldPath:n.canonicalString()}}function bs(n){return et.fromServerFormat(n.fieldPath)}function Kf(n){return n instanceof Oe?(function(t){if(t.op==="=="){if(Yu(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NAN"}};if(Qu(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Yu(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NAN"}};if(Qu(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ws(t.field),op:rb(t.op),value:t.value}}})(n):n instanceof Dt?(function(t){const s=t.getFilters().map((r=>Kf(r)));return s.length===1?s[0]:{compositeFilter:{op:ib(t.op),filters:s}}})(n):Q(54877,{filter:n})}function ob(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Qf(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class yn{constructor(e,t,s,r,i=J.min(),o=J.min(),l=tt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new yn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new yn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new yn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new yn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ab{constructor(e){this.yt=e}}function lb(n){const e=tb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Zi(e,e.limit,"L"):e}class cb{constructor(){this.Cn=new ub}addToCollectionParentIndex(e,t){return this.Cn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(Rn.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(Rn.min())}updateCollectionGroup(e,t,s){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class ub{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ge(we.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ge(we.comparator)).toArray()}}const uh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yf=41943040;class ft{static withCacheSize(e){return new ft(e,ft.DEFAULT_COLLECTION_PERCENTILE,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}ft.DEFAULT_COLLECTION_PERCENTILE=10,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ft.DEFAULT=new ft(Yf,ft.DEFAULT_COLLECTION_PERCENTILE,ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ft.DISABLED=new ft(-1,0,0);class Os{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Os(0)}static cr(){return new Os(-1)}}const hh="LruGarbageCollector",hb=1048576;function dh([n,e],[t,s]){const r=oe(n,t);return r===0?oe(e,s):r}class db{constructor(e){this.Ir=e,this.buffer=new Ge(dh),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();dh(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fb{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){j(hh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Hs(t)?j(hh,"Ignoring IndexedDB error during garbage collection: ",t):await Ws(t)}await this.Vr(3e5)}))}}class mb{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return D.resolve(To.ce);const s=new db(t);return this.mr.forEachTarget(e,(r=>s.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>s.Ar(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(j("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(uh)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uh):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,l,c,h;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(j("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r)))).next((p=>(s=p,l=Date.now(),this.removeTargets(e,s,t)))).next((p=>(i=p,c=Date.now(),this.removeOrphanedDocuments(e,s)))).next((p=>(h=Date.now(),ys()<=ce.DEBUG&&j("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-m}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${p} documents in `+(h-c)+`ms
Total Duration: ${h-m}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:p}))))}}function pb(n,e){return new mb(n,e)}class gb{constructor(){this.changes=new os((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,at.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?D.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class _b{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class yb{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&Tr(s.mutation,r,St.empty(),Te.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,ae()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=ae()){const r=Jn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((i=>{let o=yr();return i.forEach(((l,c)=>{o=o.insert(l,c.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){const s=Jn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,ae())))}populateOverlays(e,t,s){const r=[];return s.forEach((i=>{t.has(i)||r.push(i)})),this.documentOverlayCache.getOverlays(e,r).next((i=>{i.forEach(((o,l)=>{t.set(o,l)}))}))}computeViews(e,t,s,r){let i=sn();const o=xr(),l=(function(){return xr()})();return t.forEach(((c,h)=>{const m=s.get(h.key);r.has(h.key)&&(m===void 0||m.mutation instanceof as)?i=i.insert(h.key,h):m!==void 0?(o.set(h.key,m.mutation.getFieldMask()),Tr(m.mutation,h,m.mutation.getFieldMask(),Te.now())):o.set(h.key,St.empty())})),this.recalculateAndSaveOverlays(e,i).next((c=>(c.forEach(((h,m)=>o.set(h,m))),t.forEach(((h,m)=>l.set(h,new _b(m,o.get(h)??null)))),l)))}recalculateAndSaveOverlays(e,t){const s=xr();let r=new je(((o,l)=>o-l)),i=ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(const l of o)l.keys().forEach((c=>{const h=t.get(c);if(h===null)return;let m=s.get(c)||St.empty();m=l.applyToLocalView(h,m),s.set(c,m);const p=(r.get(l.batchId)||ae()).add(c);r=r.insert(l.batchId,p)}))})).next((()=>{const o=[],l=r.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),h=c.key,m=c.value,p=Pf();m.forEach((y=>{if(!i.has(y)){const T=jf(t.get(y),s.get(y));T!==null&&p.set(y,T),i=i.add(y)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return D.waitFor(o)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return(function(o){return G.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Af(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):D.resolve(Jn());let l=Vr,c=i;return o.next((h=>D.forEach(h,((m,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),i.get(m)?D.resolve():this.remoteDocumentCache.getEntry(e,m).next((y=>{c=c.insert(m,y)}))))).next((()=>this.populateOverlays(e,h,i))).next((()=>this.computeViews(e,c,h,ae()))).next((m=>({batchId:l,changes:kf(m)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new G(t)).next((s=>{let r=yr();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=yr();return this.indexManager.getCollectionParents(e,i).next((l=>D.forEach(l,(c=>{const h=(function(p,y){return new Ks(y,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,s,r).next((m=>{m.forEach(((p,y)=>{o=o.insert(p,y)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r)))).next((o=>{i.forEach(((c,h)=>{const m=h.getKey();o.get(m)===null&&(o=o.insert(m,at.newInvalidDocument(m)))}));let l=yr();return o.forEach(((c,h)=>{const m=i.get(c);m!==void 0&&Tr(m.mutation,h,St.empty(),Te.now()),So(t,h)&&(l=l.insert(c,h))})),l}))}}class vb{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return D.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:zt(r.createTime)}})(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:lb(r.bundledQuery),readTime:zt(r.readTime)}})(t)),D.resolve()}}class wb{constructor(){this.overlays=new je(G.comparator),this.qr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Jn();return D.forEach(t,(r=>this.getOverlay(e,r).next((i=>{i!==null&&s.set(r,i)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,i)=>{this.St(e,t,i)})),D.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(s)),D.resolve()}getOverlaysForCollection(e,t,s){const r=Jn(),i=t.length+1,o=new G(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>s&&r.set(c.getKey(),c)}return D.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new je(((h,m)=>h-m));const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let m=i.get(h.largestBatchId);m===null&&(m=Jn(),i=i.insert(h.largestBatchId,m)),m.set(h.getKey(),h)}}const l=Jn(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((h,m)=>l.set(h,m))),!(l.size()>=r)););return D.resolve(l)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new jw(t,s));let i=this.qr.get(t);i===void 0&&(i=ae(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}class bb{constructor(){this.sessionToken=tt.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}class Sl{constructor(){this.Qr=new Ge(Qe.$r),this.Ur=new Ge(Qe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Qe(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Gr(new Qe(e,t))}zr(e,t){e.forEach((s=>this.removeReference(s,t)))}jr(e){const t=new G(new we([])),s=new Qe(t,e),r=new Qe(t,e+1),i=[];return this.Ur.forEachInRange([s,r],(o=>{this.Gr(o),i.push(o.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new G(new we([])),s=new Qe(t,e),r=new Qe(t,e+1);let i=ae();return this.Ur.forEachInRange([s,r],(o=>{i=i.add(o.key)})),i}containsKey(e){const t=new Qe(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Qe{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return G.comparator(e.key,t.key)||oe(e.Yr,t.Yr)}static Kr(e,t){return oe(e.Yr,t.Yr)||G.comparator(e.key,t.key)}}class Eb{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ge(Qe.$r)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Lw(i,t,s,r);this.mutationQueue.push(o);for(const l of r)this.Zr=this.Zr.add(new Qe(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return D.resolve(o)}lookupMutationBatch(e,t){return D.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return D.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?yl:this.tr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Qe(t,0),r=new Qe(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],(o=>{const l=this.Xr(o.Yr);i.push(l)})),D.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ge(oe);return t.forEach((r=>{const i=new Qe(r,0),o=new Qe(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],(l=>{s=s.add(l.Yr)}))})),D.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;G.isDocumentKey(i)||(i=i.child(""));const o=new Qe(new G(i),0);let l=new Ge(oe);return this.Zr.forEachWhile((c=>{const h=c.key.path;return!!s.isPrefixOf(h)&&(h.length===r&&(l=l.add(c.Yr)),!0)}),o),D.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((s=>{const r=this.Xr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){fe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return D.forEach(t.mutations,(r=>{const i=new Qe(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=s}))}ir(e){}containsKey(e,t){const s=new Qe(t,0),r=this.Zr.firstAfterOrEqual(s);return D.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class xb{constructor(e){this.ri=e,this.docs=(function(){return new je(G.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return D.resolve(s?s.document.mutableCopy():at.newInvalidDocument(t))}getEntries(e,t){let s=sn();return t.forEach((r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():at.newInvalidDocument(r))})),D.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=sn();const o=t.path,l=new G(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:h,value:{document:m}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Jv(Xv(m),s)<=0||(r.has(m.key)||So(t,m))&&(i=i.insert(m.key,m.mutableCopy()))}return D.resolve(i)}getAllFromCollectionGroup(e,t,s,r){Q(9500)}ii(e,t){return D.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Tb(this)}getSize(e){return D.resolve(this.size)}}class Tb extends gb{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)})),D.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Ib{constructor(e){this.persistence=e,this.si=new os((t=>bl(t)),El),this.lastRemoteSnapshotVersion=J.min(),this.highestTargetId=0,this.oi=0,this._i=new Sl,this.targetCount=0,this.ai=Os.ur()}forEachTarget(e,t){return this.si.forEach(((s,r)=>t(r))),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),D.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Os(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Pr(t),D.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach(((o,l)=>{l.sequenceNumber<=t&&s.get(l.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)})),D.waitFor(i).next((()=>r))}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return D.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),D.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((o=>{i.push(r.markPotentiallyOrphaned(e,o))})),D.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return D.resolve(s)}containsKey(e,t){return D.resolve(this._i.containsKey(t))}}class Xf{constructor(e,t){this.ui={},this.overlays={},this.ci=new To(0),this.li=!1,this.li=!0,this.hi=new bb,this.referenceDelegate=e(this),this.Pi=new Ib(this),this.indexManager=new cb,this.remoteDocumentCache=(function(r){return new xb(r)})((s=>this.referenceDelegate.Ti(s))),this.serializer=new ab(t),this.Ii=new vb(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new wb,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new Eb(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){j("MemoryPersistence","Starting transaction:",e);const r=new Cb(this.ci.next());return this.referenceDelegate.Ei(),s(r).next((i=>this.referenceDelegate.di(r).next((()=>i)))).toPromise().then((i=>(r.raiseOnCommittedEvent(),i)))}Ai(e,t){return D.or(Object.values(this.ui).map((s=>()=>s.containsKey(e,t))))}}class Cb extends ew{constructor(e){super(),this.currentSequenceNumber=e}}class Rl{constructor(e){this.persistence=e,this.Ri=new Sl,this.Vi=null}static mi(e){return new Rl(e)}get fi(){if(this.Vi)return this.Vi;throw Q(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),D.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((i=>this.fi.add(i.toString())))})).next((()=>s.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.fi,(s=>{const r=G.fromPath(s);return this.gi(e,r).next((i=>{i||t.removeEntry(r,J.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class so{constructor(e,t){this.persistence=e,this.pi=new os((s=>sw(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=pb(this,t)}static mi(e,t){return new so(e,t)}Ei(){}di(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}wr(e){let t=0;return this.pr(e,(s=>{t++})).next((()=>t))}pr(e,t){return D.forEach(this.pi,((s,r)=>this.br(e,s,r).next((i=>i?D.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(o=>this.br(e,o,t).next((l=>{l||(s++,i.removeEntry(o,J.min()))})))).next((()=>i.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),D.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ji(e.data.value)),t}br(e,t,s){return D.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return D.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Nl{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=ae(),r=ae();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Nl(e,t.fromCache,s,r)}}class Ab{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Sb{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return yy()?8:tw(Fd())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next((o=>{i.result=o})).next((()=>{if(!i.result)return this.ws(e,t,r,s).next((o=>{i.result=o}))})).next((()=>{if(i.result)return;const o=new Ab;return this.Ss(e,t,o).next((l=>{if(i.result=l,this.Vs)return this.bs(e,t,o,l.size)}))})).next((()=>i.result))}bs(e,t,s,r){return s.documentReadCount<this.fs?(ys()<=ce.DEBUG&&j("QueryEngine","SDK will not create cache indexes for query:",vs(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),D.resolve()):(ys()<=ce.DEBUG&&j("QueryEngine","Query:",vs(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(ys()<=ce.DEBUG&&j("QueryEngine","The SDK decides to create cache indexes for query:",vs(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ut(t))):D.resolve())}ys(e,t){if(eh(t))return D.resolve(null);let s=Ut(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=Zi(t,null,"F"),s=Ut(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((i=>{const o=ae(...i);return this.ps.getDocuments(e,o).next((l=>this.indexManager.getMinOffset(e,s).next((c=>{const h=this.Ds(t,l);return this.Cs(t,h,o,c.readTime)?this.ys(e,Zi(t,null,"F")):this.vs(e,h,t,c)}))))})))))}ws(e,t,s,r){return eh(t)||r.isEqual(J.min())?D.resolve(null):this.ps.getDocuments(e,s).next((i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?D.resolve(null):(ys()<=ce.DEBUG&&j("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vs(t)),this.vs(e,o,t,Yv(r,Vr)).next((l=>l)))}))}Ds(e,t){let s=new Ge(Rf(e));return t.forEach(((r,i)=>{So(e,i)&&(s=s.add(i))})),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return ys()<=ce.DEBUG&&j("QueryEngine","Using full collection scan to execute query:",vs(t)),this.ps.getDocumentsMatchingQuery(e,t,Rn.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next((i=>(t.forEach((o=>{i=i.insert(o.key,o)})),i)))}}const kl="LocalStore",Rb=3e8;class Nb{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new je(oe),this.xs=new os((i=>bl(i)),El),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yb(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function kb(n,e,t,s){return new Nb(n,e,t,s)}async function Jf(n,e){const t=Z(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s)))).next((i=>{const o=[],l=[];let c=ae();for(const h of r){o.push(h.batchId);for(const m of h.mutations)c=c.add(m.key)}for(const h of i){l.push(h.batchId);for(const m of h.mutations)c=c.add(m.key)}return t.localDocuments.getDocuments(s,c).next((h=>({Ls:h,removedBatchIds:o,addedBatchIds:l})))}))}))}function Pb(n,e){const t=Z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,c,h,m){const p=h.batch,y=p.keys();let T=D.resolve();return y.forEach((N=>{T=T.next((()=>m.getEntry(c,N))).next((R=>{const k=h.docVersions.get(N);fe(k!==null,48541),R.version.compareTo(k)<0&&(p.applyToRemoteDocument(R,h),R.isValidDocument()&&(R.setReadTime(h.commitVersion),m.addEntry(R)))}))})),T.next((()=>l.mutationQueue.removeMutationBatch(c,p)))})(t,s,e,i).next((()=>i.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(l){let c=ae();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(c=c.add(l.batch.mutations[h].key));return c})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function Zf(n){const e=Z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Db(n,e){const t=Z(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const l=[];e.targetChanges.forEach(((m,p)=>{const y=r.get(p);if(!y)return;l.push(t.Pi.removeMatchingKeys(i,m.removedDocuments,p).next((()=>t.Pi.addMatchingKeys(i,m.addedDocuments,p))));let T=y.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(p)!==null?T=T.withResumeToken(tt.EMPTY_BYTE_STRING,J.min()).withLastLimboFreeSnapshotVersion(J.min()):m.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(m.resumeToken,s)),r=r.insert(p,T),(function(R,k,q){return R.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=Rb?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0})(y,T,m)&&l.push(t.Pi.updateTargetData(i,T))}));let c=sn(),h=ae();if(e.documentUpdates.forEach((m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,m))})),l.push(Vb(i,o,e.documentUpdates).next((m=>{c=m.ks,h=m.qs}))),!s.isEqual(J.min())){const m=t.Pi.getLastRemoteSnapshotVersion(i).next((p=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s)));l.push(m)}return D.waitFor(l).next((()=>o.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,c,h))).next((()=>c))})).then((i=>(t.Ms=r,i)))}function Vb(n,e,t){let s=ae(),r=ae();return t.forEach((i=>s=s.add(i))),e.getEntries(n,s).next((i=>{let o=sn();return t.forEach(((l,c)=>{const h=i.get(l);c.isFoundDocument()!==h.isFoundDocument()&&(r=r.add(l)),c.isNoDocument()&&c.version.isEqual(J.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):j(kl,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",c.version)})),{ks:o,qs:r}}))}function Mb(n,e){const t=Z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=yl),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function Ob(n,e){const t=Z(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.Pi.getTargetData(s,e).next((i=>i?(r=i,D.resolve(r)):t.Pi.allocateTargetId(s).next((o=>(r=new yn(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s}))}async function Wa(n,e,t){const s=Z(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,(o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!Hs(o))throw o;j(kl,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function fh(n,e,t){const s=Z(n);let r=J.min(),i=ae();return s.persistence.runTransaction("Execute query","readwrite",(o=>(function(c,h,m){const p=Z(c),y=p.xs.get(m);return y!==void 0?D.resolve(p.Ms.get(y)):p.Pi.getTargetData(h,m)})(s,o,Ut(e)).next((l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,l.targetId).next((c=>{i=c}))})).next((()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:J.min(),t?i:ae()))).next((l=>(Lb(s,Ew(e),l),{documents:l,Qs:i})))))}function Lb(n,e,t){let s=n.Os.get(e)||J.min();t.forEach(((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)})),n.Os.set(e,s)}class mh{constructor(){this.activeTargetIds=Sw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class jb{constructor(){this.Mo=new mh,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new mh,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Fb{Oo(e){}shutdown(){}}const ph="ConnectivityMonitor";class gh{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){j(ph,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){j(ph,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Pi=null;function Ha(){return Pi===null?Pi=(function(){return 268435456+Math.round(2147483648*Math.random())})():Pi++,"0x"+Pi.toString(16)}const _a="RestConnection",Ub={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Bb{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===Yi?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=Ha(),l=this.zo(e,t.toUriEncodedString());j(_a,`Sending RPC '${e}' ${o}:`,l,s);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,r,i);const{host:h}=new URL(l),m=Qr(h);return this.Jo(e,l,c,s,m).then((p=>(j(_a,`Received RPC '${e}' ${o}: `,p),p)),(p=>{throw ks(_a,`RPC '${e}' ${o} failed with error: `,p,"url: ",l,"request:",s),p}))}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Gs})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,i)=>e[i]=r)),s&&s.headers.forEach(((r,i)=>e[i]=r))}zo(e,t){const s=Ub[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}class zb{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const rt="WebChannelConnection";class qb extends Bb{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=Ha();return new Promise(((l,c)=>{const h=new ef;h.setWithCredentials(!0),h.listenOnce(tf.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Li.NO_ERROR:const p=h.getResponseJson();j(rt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),l(p);break;case Li.TIMEOUT:j(rt,`RPC '${e}' ${o} timed out`),c(new L(P.DEADLINE_EXCEEDED,"Request time out"));break;case Li.HTTP_ERROR:const y=h.getStatus();if(j(rt,`RPC '${e}' ${o} failed with status:`,y,"response text:",h.getResponseText()),y>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);const N=T?.error;if(N&&N.status&&N.message){const R=(function(q){const W=q.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(W)>=0?W:P.UNKNOWN})(N.status);c(new L(R,N.message))}else c(new L(P.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new L(P.UNAVAILABLE,"Connection failed."));break;default:Q(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{j(rt,`RPC '${e}' ${o} completed.`)}}));const m=JSON.stringify(r);j(rt,`RPC '${e}' ${o} sending request:`,r),h.send(t,"POST",m,s,15)}))}T_(e,t,s){const r=Ha(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=rf(),l=sf(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,s),c.encodeInitMessageHeaders=!0;const m=i.join("");j(rt,`Creating RPC '${e}' stream ${r}: ${m}`,c);const p=o.createWebChannel(m,c);this.I_(p);let y=!1,T=!1;const N=new zb({Yo:k=>{T?j(rt,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(y||(j(rt,`Opening RPC '${e}' stream ${r} transport.`),p.open(),y=!0),j(rt,`RPC '${e}' stream ${r} sending:`,k),p.send(k))},Zo:()=>p.close()}),R=(k,q,W)=>{k.listen(q,(H=>{try{W(H)}catch(z){setTimeout((()=>{throw z}),0)}}))};return R(p,_r.EventType.OPEN,(()=>{T||(j(rt,`RPC '${e}' stream ${r} transport opened.`),N.o_())})),R(p,_r.EventType.CLOSE,(()=>{T||(T=!0,j(rt,`RPC '${e}' stream ${r} transport closed`),N.a_(),this.E_(p))})),R(p,_r.EventType.ERROR,(k=>{T||(T=!0,ks(rt,`RPC '${e}' stream ${r} transport errored. Name:`,k.name,"Message:",k.message),N.a_(new L(P.UNAVAILABLE,"The operation could not be completed")))})),R(p,_r.EventType.MESSAGE,(k=>{if(!T){const q=k.data[0];fe(!!q,16349);const W=q,H=W?.error||W[0]?.error;if(H){j(rt,`RPC '${e}' stream ${r} received error:`,H);const z=H.status;let ue=(function(_){const v=Ve[_];if(v!==void 0)return Uf(v)})(z),B=H.message;ue===void 0&&(ue=P.INTERNAL,B="Unknown error status: "+z+" with message "+H.message),T=!0,N.a_(new L(ue,B)),p.close()}else j(rt,`RPC '${e}' stream ${r} received:`,q),N.u_(q)}})),R(l,nf.STAT_EVENT,(k=>{k.stat===Va.PROXY?j(rt,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===Va.NOPROXY&&j(rt,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{N.__()}),0),N}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function ya(){return typeof document<"u"?document:null}function Po(n){return new Hw(n,!0)}class em{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&j("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const _h="PersistentStream";class tm{constructor(e,t,s,r,i,o,l,c){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new em(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(nn(t.toString()),nn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new L(P.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{s((()=>this.listener.Xo()))})),this.stream.t_((()=>{s((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return j(_h,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(j(_h,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class $b extends tm{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Yw(this.serializer,e),s=(function(i){if(!("targetChange"in i))return J.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?J.min():o.readTime?zt(o.readTime):J.min()})(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=Ga(this.serializer),t.addTarget=(function(i,o){let l;const c=o.target;if(l=Ua(c)?{documents:Zw(i,c)}:{query:eb(i,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=qf(i,o.resumeToken);const h=za(i,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(J.min())>0){l.readTime=no(i,o.snapshotVersion.toTimestamp());const h=za(i,o.expectedCount);h!==null&&(l.expectedCount=h)}return l})(this.serializer,e);const s=nb(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=Ga(this.serializer),t.removeTarget=e,this.q_(t)}}class Gb extends tm{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return fe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,fe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){fe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Jw(e.writeResults,e.commitTime),s=zt(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Ga(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>Xw(this.serializer,s)))};this.q_(t)}}class Wb{}class Hb extends Wb{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new L(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Go(e,qa(t,s),r,i,o))).catch((i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new L(P.UNKNOWN,i.toString())}))}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Ho(e,qa(t,s),r,o,l,i))).catch((o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new L(P.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Kb{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(nn(t),this.aa=!1):j("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const ts="RemoteStore";class Qb{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((o=>{s.enqueueAndForget((async()=>{ls(this)&&(j(ts,"Restarting streams for network reachability change."),await(async function(c){const h=Z(c);h.Ea.add(4),await Zr(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Do(h)})(this))}))})),this.Ra=new Kb(s,r)}}async function Do(n){if(ls(n))for(const e of n.da)await e(!0)}async function Zr(n){for(const e of n.da)await e(!1)}function nm(n,e){const t=Z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ml(t)?Vl(t):Qs(t).O_()&&Dl(t,e))}function Pl(n,e){const t=Z(n),s=Qs(t);t.Ia.delete(e),s.O_()&&sm(t,e),t.Ia.size===0&&(s.O_()?s.L_():ls(t)&&t.Ra.set("Unknown"))}function Dl(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(J.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qs(n).Y_(e)}function sm(n,e){n.Va.Ue(e),Qs(n).Z_(e)}function Vl(n){n.Va=new qw({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Qs(n).start(),n.Ra.ua()}function Ml(n){return ls(n)&&!Qs(n).x_()&&n.Ia.size>0}function ls(n){return Z(n).Ea.size===0}function rm(n){n.Va=void 0}async function Yb(n){n.Ra.set("Online")}async function Xb(n){n.Ia.forEach(((e,t)=>{Dl(n,e)}))}async function Jb(n,e){rm(n),Ml(n)?(n.Ra.ha(e),Vl(n)):n.Ra.set("Unknown")}async function Zb(n,e,t){if(n.Ra.set("Online"),e instanceof zf&&e.state===2&&e.cause)try{await(async function(r,i){const o=i.cause;for(const l of i.targetIds)r.Ia.has(l)&&(await r.remoteSyncer.rejectListen(l,o),r.Ia.delete(l),r.Va.removeTarget(l))})(n,e)}catch(s){j(ts,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await ro(n,s)}else if(e instanceof Bi?n.Va.Ze(e):e instanceof Bf?n.Va.st(e):n.Va.tt(e),!t.isEqual(J.min()))try{const s=await Zf(n.localStore);t.compareTo(s)>=0&&await(function(i,o){const l=i.Va.Tt(o);return l.targetChanges.forEach(((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const m=i.Ia.get(h);m&&i.Ia.set(h,m.withResumeToken(c.resumeToken,o))}})),l.targetMismatches.forEach(((c,h)=>{const m=i.Ia.get(c);if(!m)return;i.Ia.set(c,m.withResumeToken(tt.EMPTY_BYTE_STRING,m.snapshotVersion)),sm(i,c);const p=new yn(m.target,c,h,m.sequenceNumber);Dl(i,p)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(s){j(ts,"Failed to raise snapshot:",s),await ro(n,s)}}async function ro(n,e,t){if(!Hs(e))throw e;n.Ea.add(1),await Zr(n),n.Ra.set("Offline"),t||(t=()=>Zf(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{j(ts,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Do(n)}))}function im(n,e){return e().catch((t=>ro(n,t,e)))}async function Vo(n){const e=Z(n),t=Dn(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:yl;for(;eE(e);)try{const r=await Mb(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,tE(e,r)}catch(r){await ro(e,r)}om(e)&&am(e)}function eE(n){return ls(n)&&n.Ta.length<10}function tE(n,e){n.Ta.push(e);const t=Dn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function om(n){return ls(n)&&!Dn(n).x_()&&n.Ta.length>0}function am(n){Dn(n).start()}async function nE(n){Dn(n).ra()}async function sE(n){const e=Dn(n);for(const t of n.Ta)e.ea(t.mutations)}async function rE(n,e,t){const s=n.Ta.shift(),r=Il.from(s,e,t);await im(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await Vo(n)}async function iE(n,e){e&&Dn(n).X_&&await(async function(s,r){if((function(o){return Uw(o)&&o!==P.ABORTED})(r.code)){const i=s.Ta.shift();Dn(s).B_(),await im(s,(()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r))),await Vo(s)}})(n,e),om(n)&&am(n)}async function yh(n,e){const t=Z(n);t.asyncQueue.verifyOperationInProgress(),j(ts,"RemoteStore received new credentials");const s=ls(t);t.Ea.add(3),await Zr(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Do(t)}async function oE(n,e){const t=Z(n);e?(t.Ea.delete(2),await Do(t)):e||(t.Ea.add(2),await Zr(t),t.Ra.set("Unknown"))}function Qs(n){return n.ma||(n.ma=(function(t,s,r){const i=Z(t);return i.sa(),new $b(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:Yb.bind(null,n),t_:Xb.bind(null,n),r_:Jb.bind(null,n),H_:Zb.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Ml(n)?Vl(n):n.Ra.set("Unknown")):(await n.ma.stop(),rm(n))}))),n.ma}function Dn(n){return n.fa||(n.fa=(function(t,s,r){const i=Z(t);return i.sa(),new Gb(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:nE.bind(null,n),r_:iE.bind(null,n),ta:sE.bind(null,n),na:rE.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Vo(n)):(await n.fa.stop(),n.Ta.length>0&&(j(ts,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Ol{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new xn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,l=new Ol(e,t,o,r,i);return l.start(s),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ll(n,e){if(nn("AsyncQueue",`${e}: ${n}`),Hs(n))return new L(P.UNAVAILABLE,`${e}: ${n}`);throw n}class Ts{static emptySet(e){return new Ts(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||G.comparator(t.key,s.key):(t,s)=>G.comparator(t.key,s.key),this.keyedMap=yr(),this.sortedSet=new je(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ts)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Ts;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class vh{constructor(){this.ga=new je(G.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Q(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Ls{constructor(e,t,s,r,i,o,l,c,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach((l=>{o.push({type:0,doc:l})})),new Ls(e,t,Ts.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ao(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class aE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class lE{constructor(){this.queries=wh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=Z(t),i=r.queries;r.queries=wh(),i.forEach(((o,l)=>{for(const c of l.Sa)c.onError(s)}))})(this,new L(P.ABORTED,"Firestore shutting down"))}}function wh(){return new os((n=>Sf(n)),Ao)}async function cE(n,e){const t=Z(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new aE,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const l=Ll(o,`Initialization of query '${vs(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&jl(t)}async function uE(n,e){const t=Z(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function hE(n,e){const t=Z(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const l of o.Sa)l.Fa(r)&&(s=!0);o.wa=r}}s&&jl(t)}function dE(n,e,t){const s=Z(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function jl(n){n.Ca.forEach((e=>{e.next()}))}var Ka,bh;(bh=Ka||(Ka={})).Ma="default",bh.Cache="cache";class fE{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Ls(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ls.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ka.Cache}}class lm{constructor(e){this.key=e}}class cm{constructor(e){this.key=e}}class mE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ae(),this.mutatedKeys=ae(),this.eu=Rf(e),this.tu=new Ts(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new vh,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,l=!1;const c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,h=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((m,p)=>{const y=r.get(m),T=So(this.query,p)?p:null,N=!!y&&this.mutatedKeys.has(y.key),R=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let k=!1;y&&T?y.data.isEqual(T.data)?N!==R&&(s.track({type:3,doc:T}),k=!0):this.su(y,T)||(s.track({type:2,doc:T}),k=!0,(c&&this.eu(T,c)>0||h&&this.eu(T,h)<0)&&(l=!0)):!y&&T?(s.track({type:0,doc:T}),k=!0):y&&!T&&(s.track({type:1,doc:y}),k=!0,(c||h)&&(l=!0)),k&&(T?(o=o.add(T),i=R?i.add(m):i.delete(m)):(o=o.delete(m),i=i.delete(m)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),i=i.delete(m.key),s.track({type:1,doc:m})}return{tu:o,iu:s,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort(((m,p)=>(function(T,N){const R=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Q(20277,{Rt:k})}};return R(T)-R(N)})(m.type,p.type)||this.eu(m.doc,p.doc))),this.ou(s),r=r??!1;const l=t&&!r?this._u():[],c=this.Xa.size===0&&this.current&&!r?1:0,h=c!==this.Za;return this.Za=c,o.length!==0||h?{snapshot:new Ls(this.query,e.tu,i,o,e.mutatedKeys,c===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new vh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ae(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))}));const t=[];return e.forEach((s=>{this.Xa.has(s)||t.push(new cm(s))})),this.Xa.forEach((s=>{e.has(s)||t.push(new lm(s))})),t}cu(e){this.Ya=e.Qs,this.Xa=ae();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ls.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Fl="SyncEngine";class pE{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class gE{constructor(e){this.key=e,this.hu=!1}}class _E{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new os((l=>Sf(l)),Ao),this.Iu=new Map,this.Eu=new Set,this.du=new je(G.comparator),this.Au=new Map,this.Ru=new Sl,this.Vu={},this.mu=new Map,this.fu=Os.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function yE(n,e,t=!0){const s=pm(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await um(s,e,t,!0),r}async function vE(n,e){const t=pm(n);await um(t,e,!0,!1)}async function um(n,e,t,s){const r=await Ob(n.localStore,Ut(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let l;return s&&(l=await wE(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&nm(n.remoteStore,r),l}async function wE(n,e,t,s,r){n.pu=(p,y,T)=>(async function(R,k,q,W){let H=k.view.ru(q);H.Cs&&(H=await fh(R.localStore,k.query,!1).then((({documents:b})=>k.view.ru(b,H))));const z=W&&W.targetChanges.get(k.targetId),ue=W&&W.targetMismatches.get(k.targetId)!=null,B=k.view.applyChanges(H,R.isPrimaryClient,z,ue);return xh(R,k.targetId,B.au),B.snapshot})(n,p,y,T);const i=await fh(n.localStore,e,!0),o=new mE(e,i.Qs),l=o.ru(i.documents),c=Jr.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),h=o.applyChanges(l,n.isPrimaryClient,c);xh(n,t,h.au);const m=new pE(e,t,o);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function bE(n,e,t){const s=Z(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter((o=>!Ao(o,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Wa(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&Pl(s.remoteStore,r.targetId),Qa(s,r.targetId)})).catch(Ws)):(Qa(s,r.targetId),await Wa(s.localStore,r.targetId,!0))}async function EE(n,e){const t=Z(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Pl(t.remoteStore,s.targetId))}async function xE(n,e,t){const s=NE(n);try{const r=await(function(o,l){const c=Z(o),h=Te.now(),m=l.reduce(((T,N)=>T.add(N.key)),ae());let p,y;return c.persistence.runTransaction("Locally write mutations","readwrite",(T=>{let N=sn(),R=ae();return c.Ns.getEntries(T,m).next((k=>{N=k,N.forEach(((q,W)=>{W.isValidDocument()||(R=R.add(q))}))})).next((()=>c.localDocuments.getOverlayedDocuments(T,N))).next((k=>{p=k;const q=[];for(const W of l){const H=Mw(W,p.get(W.key).overlayedDocument);H!=null&&q.push(new as(W.key,H,vf(H.value.mapValue),Bt.exists(!0)))}return c.mutationQueue.addMutationBatch(T,h,q,l)})).next((k=>{y=k;const q=k.applyToLocalDocumentSet(p,R);return c.documentOverlayCache.saveOverlays(T,k.batchId,q)}))})).then((()=>({batchId:y.batchId,changes:kf(p)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(o,l,c){let h=o.Vu[o.currentUser.toKey()];h||(h=new je(oe)),h=h.insert(l,c),o.Vu[o.currentUser.toKey()]=h})(s,r.batchId,t),await ei(s,r.changes),await Vo(s.remoteStore)}catch(r){const i=Ll(r,"Failed to persist write");t.reject(i)}}async function hm(n,e){const t=Z(n);try{const s=await Db(t.localStore,e);e.targetChanges.forEach(((r,i)=>{const o=t.Au.get(i);o&&(fe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?fe(o.hu,14607):r.removedDocuments.size>0&&(fe(o.hu,42227),o.hu=!1))})),await ei(t,s,e)}catch(s){await Ws(s)}}function Eh(n,e,t){const s=Z(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((i,o)=>{const l=o.view.va(e);l.snapshot&&r.push(l.snapshot)})),(function(o,l){const c=Z(o);c.onlineState=l;let h=!1;c.queries.forEach(((m,p)=>{for(const y of p.Sa)y.va(l)&&(h=!0)})),h&&jl(c)})(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function TE(n,e,t){const s=Z(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new je(G.comparator);o=o.insert(i,at.newNoDocument(i,J.min()));const l=ae().add(i),c=new ko(J.min(),new Map,new je(oe),o,l);await hm(s,c),s.du=s.du.remove(i),s.Au.delete(e),Ul(s)}else await Wa(s.localStore,e,!1).then((()=>Qa(s,e,t))).catch(Ws)}async function IE(n,e){const t=Z(n),s=e.batch.batchId;try{const r=await Pb(t.localStore,e);fm(t,s,null),dm(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await ei(t,r)}catch(r){await Ws(r)}}async function CE(n,e,t){const s=Z(n);try{const r=await(function(o,l){const c=Z(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let m;return c.mutationQueue.lookupMutationBatch(h,l).next((p=>(fe(p!==null,37113),m=p.keys(),c.mutationQueue.removeMutationBatch(h,p)))).next((()=>c.mutationQueue.performConsistencyCheck(h))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(h,m,l))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,m))).next((()=>c.localDocuments.getDocuments(h,m)))}))})(s.localStore,e);fm(s,e,t),dm(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await ei(s,r)}catch(r){await Ws(r)}}function dm(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function fm(n,e,t){const s=Z(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function Qa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((s=>{n.Ru.containsKey(s)||mm(n,s)}))}function mm(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Pl(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Ul(n))}function xh(n,e,t){for(const s of t)s instanceof lm?(n.Ru.addReference(s.key,e),AE(n,s)):s instanceof cm?(j(Fl,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||mm(n,s.key)):Q(19791,{wu:s})}function AE(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(j(Fl,"New document in limbo: "+t),n.Eu.add(s),Ul(n))}function Ul(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new G(we.fromString(e)),s=n.fu.next();n.Au.set(s,new gE(t)),n.du=n.du.insert(t,s),nm(n.remoteStore,new yn(Ut(Cf(t.path)),s,"TargetPurposeLimboResolution",To.ce))}}async function ei(n,e,t){const s=Z(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach(((l,c)=>{o.push(s.pu(c,e,t).then((h=>{if((h||t)&&s.isPrimaryClient){const m=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;s.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){r.push(h);const m=Nl.As(c.targetId,h);i.push(m)}})))})),await Promise.all(o),s.Pu.H_(r),await(async function(c,h){const m=Z(c);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>D.forEach(h,(y=>D.forEach(y.Es,(T=>m.persistence.referenceDelegate.addReference(p,y.targetId,T))).next((()=>D.forEach(y.ds,(T=>m.persistence.referenceDelegate.removeReference(p,y.targetId,T)))))))))}catch(p){if(!Hs(p))throw p;j(kl,"Failed to update sequence numbers: "+p)}for(const p of h){const y=p.targetId;if(!p.fromCache){const T=m.Ms.get(y),N=T.snapshotVersion,R=T.withLastLimboFreeSnapshotVersion(N);m.Ms=m.Ms.insert(y,R)}}})(s.localStore,i))}async function SE(n,e){const t=Z(n);if(!t.currentUser.isEqual(e)){j(Fl,"User change. New user:",e.toKey());const s=await Jf(t.localStore,e);t.currentUser=e,(function(i,o){i.mu.forEach((l=>{l.forEach((c=>{c.reject(new L(P.CANCELLED,o))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await ei(t,s.Ls)}}function RE(n,e){const t=Z(n),s=t.Au.get(e);if(s&&s.hu)return ae().add(s.key);{let r=ae();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const l=t.Tu.get(o);r=r.unionWith(l.view.nu)}return r}}function pm(n){const e=Z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=hm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=RE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TE.bind(null,e),e.Pu.H_=hE.bind(null,e.eventManager),e.Pu.yu=dE.bind(null,e.eventManager),e}function NE(n){const e=Z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=IE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=CE.bind(null,e),e}class io{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Po(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return kb(this.persistence,new Sb,e.initialUser,this.serializer)}Cu(e){return new Xf(Rl.mi,this.serializer)}Du(e){return new jb}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}io.provider={build:()=>new io};class kE extends io{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){fe(this.persistence.referenceDelegate instanceof so,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new fb(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ft.withCacheSize(this.cacheSizeBytes):ft.DEFAULT;return new Xf((s=>so.mi(s,t)),this.serializer)}}class Ya{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Eh(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=SE.bind(null,this.syncEngine),await oE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new lE})()}createDatastore(e){const t=Po(e.databaseInfo.databaseId),s=(function(i){return new qb(i)})(e.databaseInfo);return(function(i,o,l,c){return new Hb(i,o,l,c)})(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,i,o,l){return new Qb(s,r,i,o,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>Eh(this.syncEngine,t,0)),(function(){return gh.v()?new gh:new Fb})())}createSyncEngine(e,t){return(function(r,i,o,l,c,h,m){const p=new _E(r,i,o,l,c,h);return m&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=Z(t);j(ts,"RemoteStore shutting down."),s.Ea.add(5),await Zr(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ya.provider={build:()=>new Ya};class PE{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):nn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Vn="FirestoreClient";class DE{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=it.UNAUTHENTICATED,this.clientId=_l.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,(async o=>{j(Vn,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(s,(o=>(j(Vn,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Ll(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function va(n,e){n.asyncQueue.verifyOperationInProgress(),j(Vn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await Jf(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Th(n,e){n.asyncQueue.verifyOperationInProgress();const t=await VE(n);j(Vn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>yh(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>yh(e.remoteStore,r))),n._onlineComponents=e}async function VE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){j(Vn,"Using user provided OfflineComponentProvider");try{await va(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===P.FAILED_PRECONDITION||r.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;ks("Error using user provided cache. Falling back to memory cache: "+t),await va(n,new io)}}else j(Vn,"Using default OfflineComponentProvider"),await va(n,new kE(void 0));return n._offlineComponents}async function gm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(j(Vn,"Using user provided OnlineComponentProvider"),await Th(n,n._uninitializedComponentsProvider._online)):(j(Vn,"Using default OnlineComponentProvider"),await Th(n,new Ya))),n._onlineComponents}function ME(n){return gm(n).then((e=>e.syncEngine))}async function OE(n){const e=await gm(n),t=e.eventManager;return t.onListen=yE.bind(null,e.syncEngine),t.onUnlisten=bE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=EE.bind(null,e.syncEngine),t}function LE(n,e,t={}){const s=new xn;return n.asyncQueue.enqueueAndForget((async()=>(function(i,o,l,c,h){const m=new PE({next:y=>{m.Nu(),o.enqueueAndForget((()=>uE(i,p))),y.fromCache&&c.source==="server"?h.reject(new L(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),p=new fE(l,m,{includeMetadataChanges:!0,qa:!0});return cE(i,p)})(await OE(n),n.asyncQueue,e,t,s))),s.promise}function _m(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Ih=new Map;const ym="firestore.googleapis.com",Ch=!0;class Ah{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ym,this.ssl=Ch}else this.host=e.host,this.ssl=e.ssl??Ch;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Yf;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<hb)throw new L(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Qv("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_m(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new L(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Mo{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ah({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ah(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new Fv;switch(s.type){case"firstParty":return new qv(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new L(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=Ih.get(t);s&&(j("ComponentProvider","Removing Datastore"),Ih.delete(t),s.terminate())})(this),Promise.resolve()}}function jE(n,e,t,s={}){n=Ds(n,Mo);const r=Qr(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;r&&(Od(`https://${l}`),jd("Firestore",!0)),i.host!==ym&&i.host!==l&&ks("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:l,ssl:r,emulatorOptions:s};if(!kr(c,o)&&(n._setSettings(c),s.mockUserToken)){let h,m;if(typeof s.mockUserToken=="string")h=s.mockUserToken,m=it.MOCK_USER;else{h=Ld(s.mockUserToken,n._app?.options.projectId);const p=s.mockUserToken.sub||s.mockUserToken.user_id;if(!p)throw new L(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new it(p)}n._authCredentials=new Uv(new af(h,m))}}class jn{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new jn(this.firestore,e,this._query)}}class $e{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new In(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $e(this.firestore,e,this._key)}toJSON(){return{type:$e._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Yr(t,$e._jsonSchema))return new $e(e,s||null,new G(we.fromString(t.referencePath)))}}$e._jsonSchemaVersion="firestore/documentReference/1.0",$e._jsonSchema={type:Le("string",$e._jsonSchemaVersion),referencePath:Le("string")};class In extends jn{constructor(e,t,s){super(e,t,Cf(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $e(this.firestore,null,new G(e))}withConverter(e){return new In(this.firestore,e,this._path)}}function Bl(n,e,...t){if(n=Pt(n),lf("collection","path",e),n instanceof Mo){const s=we.fromString(e,...t);return Uu(s),new In(n,null,s)}{if(!(n instanceof $e||n instanceof In))throw new L(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(we.fromString(e,...t));return Uu(s),new In(n.firestore,null,s)}}function vm(n,e,...t){if(n=Pt(n),arguments.length===1&&(e=_l.newId()),lf("doc","path",e),n instanceof Mo){const s=we.fromString(e,...t);return Fu(s),new $e(n,null,new G(s))}{if(!(n instanceof $e||n instanceof In))throw new L(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(we.fromString(e,...t));return Fu(s),new $e(n.firestore,n instanceof In?n.converter:null,new G(s))}}const Sh="AsyncQueue";class Rh{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new em(this,"async_queue_retry"),this._c=()=>{const s=ya();s&&j(Sh,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=ya();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ya();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new xn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Hs(e))throw e;j(Sh,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,nn("INTERNAL UNHANDLED ERROR: ",Nh(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Ol.createAndSchedule(this,e,t,s,(i=>this.hc(i)));return this.tc.push(r),r}uc(){this.nc&&Q(47125,{Pc:Nh(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Nh(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Oo extends Mo{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new Rh,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Rh(e),this._firestoreClient=void 0,await e}}}function FE(n,e){const t=typeof n=="object"?n:Yd(),s=typeof n=="string"?n:Yi,r=Wd(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=Vd("firestore");i&&jE(r,...i)}return r}function wm(n){if(n._terminated)throw new L(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||UE(n),n._firestoreClient}function UE(n){const e=n._freezeSettings(),t=(function(r,i,o,l){return new ow(r,i,o,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,_m(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new DE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}})(n._componentsProvider))}class Tt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Tt(tt.fromBase64String(e))}catch(t){throw new L(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Tt(tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Tt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Yr(e,Tt._jsonSchema))return Tt.fromBase64String(e.bytes)}}Tt._jsonSchemaVersion="firestore/bytes/1.0",Tt._jsonSchema={type:Le("string",Tt._jsonSchemaVersion),bytes:Le("string")};class zl{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class bm{constructor(e){this._methodName=e}}class qt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return oe(this._lat,e._lat)||oe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:qt._jsonSchemaVersion}}static fromJSON(e){if(Yr(e,qt._jsonSchema))return new qt(e.latitude,e.longitude)}}qt._jsonSchemaVersion="firestore/geoPoint/1.0",qt._jsonSchema={type:Le("string",qt._jsonSchemaVersion),latitude:Le("number"),longitude:Le("number")};class $t{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:$t._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Yr(e,$t._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new $t(e.vectorValues);throw new L(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$t._jsonSchemaVersion="firestore/vectorValue/1.0",$t._jsonSchema={type:Le("string",$t._jsonSchemaVersion),vectorValues:Le("object")};const BE=/^__.*__$/;class zE{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new as(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xr(e,this.data,t,this.fieldTransforms)}}function Em(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Q(40011,{Ac:n})}}class ql{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new ql({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return oo(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Em(this.Ac)&&BE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class qE{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Po(e)}Cc(e,t,s,r=!1){return new ql({Ac:e,methodName:t,Dc:s,path:et.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xm(n){const e=n._freezeSettings(),t=Po(n._databaseId);return new qE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $E(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);Cm("Data must be an object, but it was:",o,s);const l=Tm(s,o);let c,h;if(i.merge)c=new St(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const m=[];for(const p of i.mergeFields){const y=WE(e,p,t);if(!o.contains(y))throw new L(P.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);KE(m,y)||m.push(y)}c=new St(m),h=o.fieldTransforms.filter((p=>c.covers(p.field)))}else c=null,h=o.fieldTransforms;return new zE(new xt(l),c,h)}function GE(n,e,t,s=!1){return $l(t,n.Cc(s?4:3,e))}function $l(n,e){if(Im(n=Pt(n)))return Cm("Unsupported field value:",e,n),Tm(n,e);if(n instanceof bm)return(function(s,r){if(!Em(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(s,r){const i=[];let o=0;for(const l of s){let c=$l(l,r.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}})(n,e)}return(function(s,r){if((s=Pt(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Rw(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Te.fromDate(s);return{timestampValue:no(r.serializer,i)}}if(s instanceof Te){const i=new Te(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:no(r.serializer,i)}}if(s instanceof qt)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Tt)return{bytesValue:qf(r.serializer,s._byteString)};if(s instanceof $e){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Al(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof $t)return(function(o,l){return{mapValue:{fields:{[_f]:{stringValue:yf},[Xi]:{arrayValue:{values:o.toArray().map((h=>{if(typeof h!="number")throw l.Sc("VectorValues must only contain numeric values.");return xl(l.serializer,h)}))}}}}}})(s,r);throw r.Sc(`Unsupported field value: ${xo(s)}`)})(n,e)}function Tm(n,e){const t={};return hf(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):is(n,((s,r)=>{const i=$l(r,e.mc(s));i!=null&&(t[s]=i)})),{mapValue:{fields:t}}}function Im(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Te||n instanceof qt||n instanceof Tt||n instanceof $e||n instanceof bm||n instanceof $t)}function Cm(n,e,t){if(!Im(t)||!cf(t)){const s=xo(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function WE(n,e,t){if((e=Pt(e))instanceof zl)return e._internalPath;if(typeof e=="string")return Am(n,e);throw oo("Field path arguments must be of type string or ",n,!1,void 0,t)}const HE=new RegExp("[~\\*/\\[\\]]");function Am(n,e,t){if(e.search(HE)>=0)throw oo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new zl(...e.split("."))._internalPath}catch{throw oo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function oo(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${s}`),o&&(c+=` in document ${r}`),c+=")"),new L(P.INVALID_ARGUMENT,l+n+c)}function KE(n,e){return n.some((t=>t.isEqual(e)))}class Sm{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $e(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new QE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gl("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class QE extends Sm{data(){return super.data()}}function Gl(n,e){return typeof e=="string"?Am(n,e):e instanceof zl?e._internalPath:e._delegate._internalPath}function YE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Wl{}class Hl extends Wl{}function XE(n,e,...t){let s=[];e instanceof Wl&&s.push(e),s=s.concat(t),(function(i){const o=i.filter((c=>c instanceof Ql)).length,l=i.filter((c=>c instanceof Kl)).length;if(o>1||o>0&&l>0)throw new L(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(s);for(const r of s)n=r._apply(n);return n}class Kl extends Hl{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Kl(e,t,s)}_apply(e){const t=this._parse(e);return Rm(e._query,t),new jn(e.firestore,e.converter,Ba(e._query,t))}_parse(e){const t=xm(e.firestore);return(function(i,o,l,c,h,m,p){let y;if(h.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new L(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Ph(p,m);const N=[];for(const R of p)N.push(kh(c,i,R));y={arrayValue:{values:N}}}else y=kh(c,i,p)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Ph(p,m),y=GE(l,o,p,m==="in"||m==="not-in");return Oe.create(h,m,y)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Ql extends Wl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ql(e,t)}_parse(e){const t=this._queryConstraints.map((s=>s._parse(e))).filter((s=>s.getFilters().length>0));return t.length===1?t[0]:Dt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,i){let o=r;const l=i.getFlattenedFilters();for(const c of l)Rm(o,c),o=Ba(o,c)})(e._query,t),new jn(e.firestore,e.converter,Ba(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Yl extends Hl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Yl(e,t)}_apply(e){const t=(function(r,i,o){if(r.startAt!==null)throw new L(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new L(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new jr(i,o)})(e._query,this._field,this._direction);return new jn(e.firestore,e.converter,(function(r,i){const o=r.explicitOrderBy.concat([i]);return new Ks(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function JE(n,e="asc"){const t=e,s=Gl("orderBy",n);return Yl._create(s,t)}class Xl extends Hl{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Xl(e,t,s)}_apply(e){return new jn(e.firestore,e.converter,Zi(e._query,this._limit,this._limitType))}}function ZE(n){return Xl._create("limit",n,"F")}function kh(n,e,t){if(typeof(t=Pt(t))=="string"){if(t==="")throw new L(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Af(e)&&t.indexOf("/")!==-1)throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(we.fromString(t));if(!G.isDocumentKey(s))throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Ku(n,new G(s))}if(t instanceof $e)return Ku(n,t._key);throw new L(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xo(t)}.`)}function Ph(n,e){if(!Array.isArray(n)||n.length===0)throw new L(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Rm(n,e){const t=(function(r,i){for(const o of r)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new L(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class ex{convertValue(e,t="none"){switch(Pn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return is(e,((r,i)=>{s[r]=this.convertValue(i,t)})),s}convertVectorValue(e){const t=e.fields?.[Xi].arrayValue?.values?.map((s=>Ne(s.doubleValue)));return new $t(t)}convertGeoPoint(e){return new qt(Ne(e.latitude),Ne(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Co(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Mr(e));default:return null}}convertTimestamp(e){const t=Nn(e);return new Te(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=we.fromString(e);fe(Qf(s),9688,{name:e});const r=new Or(s.get(1),s.get(3)),i=new G(s.popFirst(5));return r.isEqual(t)||nn(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function tx(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class Di{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Is extends Sm{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new zi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Gl("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Is._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Is._jsonSchemaVersion="firestore/documentSnapshot/1.0",Is._jsonSchema={type:Le("string",Is._jsonSchemaVersion),bundleSource:Le("string","DocumentSnapshot"),bundleName:Le("string"),bundle:Le("string")};class zi extends Is{data(e={}){return super.data(e)}}class Cs{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Di(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new zi(this._firestore,this._userDataWriter,s.key,s,new Di(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map((l=>{const c=new zi(r._firestore,r._userDataWriter,l.doc.key,l.doc,new Di(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}}))}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const c=new zi(r._firestore,r._userDataWriter,l.doc.key,l.doc,new Di(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let h=-1,m=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),m=o.indexOf(l.doc.key)),{type:nx(l.type),doc:c,oldIndex:h,newIndex:m}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Cs._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=_l.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function nx(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Q(61501,{type:n})}}Cs._jsonSchemaVersion="firestore/querySnapshot/1.0",Cs._jsonSchema={type:Le("string",Cs._jsonSchemaVersion),bundleSource:Le("string","QuerySnapshot"),bundleName:Le("string"),bundle:Le("string")};class sx extends ex{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $e(this.firestore,null,t)}}function Nm(n){n=Ds(n,jn);const e=Ds(n.firestore,Oo),t=wm(e),s=new sx(e);return YE(n._query),LE(t,n._query).then((r=>new Cs(e,s,n,r)))}function km(n,e,t){n=Ds(n,$e);const s=Ds(n.firestore,Oo),r=tx(n.converter,e,t);return Pm(s,[$E(xm(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Bt.none())])}function rx(n){return Pm(Ds(n.firestore,Oo),[new Tl(n._key,Bt.none())])}function Pm(n,e){return(function(s,r){const i=new xn;return s.asyncQueue.enqueueAndForget((async()=>xE(await ME(s),r,i))),i.promise})(wm(n),e)}(function(e,t=!0){(function(r){Gs=r})(Kd),Pr(new Ns("firestore",((s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),l=new Oo(new Bv(s.getProvider("auth-internal")),new $v(o,s.getProvider("app-check-internal")),(function(h,m){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new L(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Or(h.options.projectId,m)})(o,r),o);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),bn(Mu,Ou,e),bn(Mu,Ou,"esm2020")})();var Dh={};const Vh="@firebase/database",Mh="1.1.0";let Dm="";function ix(n){Dm=n}class ox{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ze(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Nr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ax{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return on(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Vm=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ox(e)}}catch{}return new ax},Zn=Vm("localStorage"),lx=Vm("sessionStorage");const As=new ml("@firebase/database"),cx=(function(){let n=1;return function(){return n++}})(),Mm=function(n){const e=Sy(n),t=new Ay;t.update(e);const s=t.digest();return hl.encodeByteArray(s)},ti=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=ti.apply(null,s):typeof s=="object"?e+=ze(s):e+=s,e+=" "}return e};let Ir=null,Oh=!0;const ux=function(n,e){V(!0,"Can't turn on custom loggers persistently."),As.logLevel=ce.VERBOSE,Ir=As.log.bind(As)},lt=function(...n){if(Oh===!0&&(Oh=!1,Ir===null&&lx.get("logging_enabled")===!0&&ux()),Ir){const e=ti.apply(null,n);Ir(e)}},ni=function(n){return function(...e){lt(n,...e)}},Xa=function(...n){const e="FIREBASE INTERNAL ERROR: "+ti(...n);As.error(e)},rn=function(...n){const e=`FIREBASE FATAL ERROR: ${ti(...n)}`;throw As.error(e),new Error(e)},wt=function(...n){const e="FIREBASE WARNING: "+ti(...n);As.warn(e)},hx=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&wt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Om=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},dx=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},js="[MIN_NAME]",ns="[MAX_NAME]",Ys=function(n,e){if(n===e)return 0;if(n===js||e===ns)return-1;if(e===js||n===ns)return 1;{const t=Lh(n),s=Lh(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},fx=function(n,e){return n===e?0:n<e?-1:1},fr=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ze(e))},Jl=function(n){if(typeof n!="object"||n===null)return ze(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=ze(e[s]),t+=":",t+=Jl(n[e[s]]);return t+="}",t},Lm=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let r=0;r<t;r+=e)r+e>t?s.push(n.substring(r,t)):s.push(n.substring(r,r+e));return s};function pt(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const jm=function(n){V(!Om(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let r,i,o,l,c;n===0?(i=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),i=l+s,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-s-t))));const h=[];for(c=t;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)h.push(i%2?1:0),i=Math.floor(i/2);h.push(r?1:0),h.reverse();const m=h.join("");let p="";for(c=0;c<64;c+=8){let y=parseInt(m.substr(c,8),2).toString(16);y.length===1&&(y="0"+y),p=p+y}return p.toLowerCase()},mx=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},px=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function gx(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const _x=new RegExp("^-?(0*)\\d{1,10}$"),yx=-2147483648,vx=2147483647,Lh=function(n){if(_x.test(n)){const e=Number(n);if(e>=yx&&e<=vx)return e}return null},si=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw wt("Exception was thrown by user callback.",t),e},Math.floor(0))}},wx=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Cr=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class bx{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Hd(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){wt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Ex{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(lt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',wt(e)}}class qi{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}qi.OWNER="owner";const Zl="5",Fm="v",Um="s",Bm="r",zm="f",qm=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$m="ls",Gm="p",Ja="ac",Wm="websocket",Hm="long_polling";class Km{constructor(e,t,s,r,i=!1,o="",l=!1,c=!1,h=null){this.secure=t,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Zn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Zn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function xx(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Qm(n,e,t){V(typeof e=="string","typeof type must == string"),V(typeof t=="object","typeof params must == object");let s;if(e===Wm)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Hm)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);xx(n)&&(t.ns=n.namespace);const r=[];return pt(t,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}class Tx{constructor(){this.counters_={}}incrementCounter(e,t=1){on(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return oy(this.counters_)}}const wa={},ba={};function ec(n){const e=n.toString();return wa[e]||(wa[e]=new Tx),wa[e]}function Ix(n,e){const t=n.toString();return ba[t]||(ba[t]=e()),ba[t]}class Cx{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&si(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const jh="start",Ax="close",Sx="pLPCommand",Rx="pRTLPCB",Ym="id",Xm="pw",Jm="ser",Nx="cb",kx="seg",Px="ts",Dx="d",Vx="dframe",Zm=1870,ep=30,Mx=Zm-ep,Ox=25e3,Lx=3e4;class Es{constructor(e,t,s,r,i,o,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ni(e),this.stats_=ec(t),this.urlFn=c=>(this.appCheckToken&&(c[Ja]=this.appCheckToken),Qm(t,Hm,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Cx(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Lx)),dx(()=>{if(this.isClosed_)return;this.scriptTagHolder=new tc((...i)=>{const[o,l,c,h,m]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===jh)this.id=l,this.password=c;else if(o===Ax)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[jh]="t",s[Jm]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[Nx]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Fm]=Zl,this.transportSessionId&&(s[Um]=this.transportSessionId),this.lastSessionId&&(s[$m]=this.lastSessionId),this.applicationId&&(s[Gm]=this.applicationId),this.appCheckToken&&(s[Ja]=this.appCheckToken),typeof location<"u"&&location.hostname&&qm.test(location.hostname)&&(s[Bm]=zm);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Es.forceAllow_=!0}static forceDisallow(){Es.forceDisallow_=!0}static isAvailable(){return Es.forceAllow_?!0:!Es.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!mx()&&!px()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ze(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Pd(t),r=Lm(s,Mx);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[Vx]="t",s[Ym]=e,s[Xm]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ze(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class tc{constructor(e,t,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=cx(),window[Sx+this.uniqueCallbackIdentifier]=e,window[Rx+this.uniqueCallbackIdentifier]=t,this.myIFrame=tc.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){lt("frame writing exception"),l.stack&&lt(l.stack),lt(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||lt("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Ym]=this.myID,e[Xm]=this.myPW,e[Jm]=this.currentSerial;let t=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ep+s.length<=Zm;){const o=this.pendingSegs.shift();s=s+"&"+kx+r+"="+o.seg+"&"+Px+r+"="+o.ts+"&"+Dx+r+"="+o.d,r++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(s,Math.floor(Ox)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{lt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const jx=16384,Fx=45e3;let ao=null;typeof MozWebSocket<"u"?ao=MozWebSocket:typeof WebSocket<"u"&&(ao=WebSocket);class At{constructor(e,t,s,r,i,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ni(this.connId),this.stats_=ec(t),this.connURL=At.connectionURL_(t,o,l,r,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,r,i){const o={};return o[Fm]=Zl,typeof location<"u"&&location.hostname&&qm.test(location.hostname)&&(o[Bm]=zm),t&&(o[Um]=t),s&&(o[$m]=s),r&&(o[Ja]=r),i&&(o[Gm]=i),Qm(e,Wm,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Zn.set("previous_websocket_failure",!0);try{let s;_y(),this.mySock=new ao(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){At.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&ao!==null&&!At.forceDisallow_}static previouslyFailed(){return Zn.isInMemoryStorage||Zn.get("previous_websocket_failure")===!0}markConnectionHealthy(){Zn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=Nr(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(V(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=ze(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=Lm(t,jx);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Fx))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}At.responsesRequiredToBeHealthy=2;At.healthyTimeout=3e4;class Br{static get ALL_TRANSPORTS(){return[Es,At]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=At&&At.isAvailable();let s=t&&!At.previouslyFailed();if(e.webSocketOnly&&(t||wt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[At];else{const r=this.transports_=[];for(const i of Br.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Br.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Br.globalTransportInitialized_=!1;const Ux=6e4,Bx=5e3,zx=10*1024,qx=100*1024,Ea="t",Fh="d",$x="s",Uh="r",Gx="e",Bh="o",zh="a",qh="n",$h="p",Wx="h";class Hx{constructor(e,t,s,r,i,o,l,c,h,m){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=m,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ni("c:"+this.id+":"),this.transportManager_=new Br(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Cr(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>qx?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>zx?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ea in e){const t=e[Ea];t===zh?this.upgradeIfSecondaryHealthy_():t===Uh?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Bh&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=fr("t",e),s=fr("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:$h,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:zh,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:qh,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=fr("t",e),s=fr("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=fr(Ea,e);if(Fh in e){const s=e[Fh];if(t===Wx){const r={...s};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===qh){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===$x?this.onConnectionShutdown_(s):t===Uh?this.onReset_(s):t===Gx?Xa("Server Error: "+s):t===Bh?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Xa("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Zl!==s&&wt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Cr(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ux))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Cr(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Bx))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:$h,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Zn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class tp{put(e,t,s,r){}merge(e,t,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class np{constructor(e){this.allowedEvents_=e,this.listeners_={},V(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const r=this.getInitialEvent(e);r&&t.apply(s,r)}off(e,t,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){V(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class lo extends np{static getInstance(){return new lo}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Ud()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return V(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Gh=32,Wh=768;class ge{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function de(){return new ge("")}function re(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Mn(n){return n.pieces_.length-n.pieceNum_}function ve(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ge(n.pieces_,e)}function sp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Kx(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function rp(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ip(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ge(e,0)}function qe(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof ge)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&t.push(s[r])}return new ge(t,0)}function ie(n){return n.pieceNum_>=n.pieces_.length}function ut(n,e){const t=re(n),s=re(e);if(t===null)return e;if(t===s)return ut(ve(n),ve(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function nc(n,e){if(Mn(n)!==Mn(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Rt(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Mn(n)>Mn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class Qx{constructor(e,t){this.errorPrefix_=t,this.parts_=rp(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Eo(this.parts_[s]);op(this)}}function Yx(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Eo(e),op(n)}function Xx(n){const e=n.parts_.pop();n.byteLength_-=Eo(e),n.parts_.length>0&&(n.byteLength_-=1)}function op(n){if(n.byteLength_>Wh)throw new Error(n.errorPrefix_+"has a key path longer than "+Wh+" bytes ("+n.byteLength_+").");if(n.parts_.length>Gh)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Gh+") or object contains a cycle "+Xn(n))}function Xn(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class sc extends np{static getInstance(){return new sc}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return V(e==="visible","Unknown event type: "+e),[this.visible_]}}const mr=1e3,Jx=300*1e3,Hh=30*1e3,Zx=1.3,e0=3e4,t0="server_kill",Kh=3;class en extends tp{constructor(e,t,s,r,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=en.nextPersistentConnectionId_++,this.log_=ni("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=mr,this.maxReconnectDelay_=Jx,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");sc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&lo.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(ze(i)),V(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const t=new fl,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),V(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),V(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:r,hashFn:t,query:e,tag:s};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,h=l.s;en.warnOnListenWarnings_(c,t),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&on(e,"w")){const s=Rs(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();wt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Iy(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Hh)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Ty(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),V(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,t)}sendUnlisten_(e,t,s,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,r){const i={p:t,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,s,r){this.putInternal("p",e,t,s,r)}merge(e,t,s,r){this.putInternal("m",e,t,s,r)}putInternal(e,t,s,r,i){this.initConnection_();const o={p:t,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ze(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Xa("Unrecognized action received from server: "+ze(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){V(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=mr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=mr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>e0&&(this.reconnectDelay_=mr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Zx)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+en.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},h=function(p){V(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:h};const m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,y]=await Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);o?lt("getToken() completed but was canceled"):(lt("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=y&&y.token,l=new Hx(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,T=>{wt(T+" ("+this.repoInfo_.toString()+")"),this.interrupt(t0)},i))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&wt(p),c())}}}interrupt(e){lt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){lt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Tu(this.interruptReasons_)&&(this.reconnectDelay_=mr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(i=>Jl(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const s=new ge(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(t),i.delete(t),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,t){lt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Kh&&(this.reconnectDelay_=Hh,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){lt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Kh&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Dm.replace(/\./g,"-")]=1,Ud()?e["framework.cordova"]=1:gy()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=lo.getInstance().currentlyOnline();return Tu(this.interruptReasons_)&&e}}en.nextPersistentConnectionId_=0;en.nextConnectionId_=0;class se{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new se(e,t)}}class Lo{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new se(js,e),r=new se(js,t);return this.compare(s,r)!==0}minPost(){return se.MIN}}let Vi;class ap extends Lo{static get __EMPTY_NODE(){return Vi}static set __EMPTY_NODE(e){Vi=e}compare(e,t){return Ys(e.name,t.name)}isDefinedOn(e){throw qs("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return se.MIN}maxPost(){return new se(ns,Vi)}makePost(e,t){return V(typeof e=="string","KeyIndex indexValue must always be a string."),new se(e,Vi)}toString(){return".key"}}const Ss=new ap;class Mi{constructor(e,t,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ye{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Ye.RED,this.left=r??mt.EMPTY_NODE,this.right=i??mt.EMPTY_NODE}copy(e,t,s,r,i){return new Ye(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return mt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,r;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return mt.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ye.RED=!0;Ye.BLACK=!1;class n0{copy(e,t,s,r,i){return this}insert(e,t,s){return new Ye(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class mt{constructor(e,t=mt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new mt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ye.BLACK,null,null))}remove(e){return new mt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ye.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,r=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Mi(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Mi(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Mi(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Mi(this.root_,null,this.comparator_,!0,e)}}mt.EMPTY_NODE=new n0;function s0(n,e){return Ys(n.name,e.name)}function rc(n,e){return Ys(n,e)}let Za;function r0(n){Za=n}const lp=function(n){return typeof n=="number"?"number:"+jm(n):"string:"+n},cp=function(n){if(n.isLeafNode()){const e=n.val();V(typeof e=="string"||typeof e=="number"||typeof e=="object"&&on(e,".sv"),"Priority must be a string or number.")}else V(n===Za||n.isEmpty(),"priority of unexpected type.");V(n===Za||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Qh;class Ke{static set __childrenNodeConstructor(e){Qh=e}static get __childrenNodeConstructor(){return Qh}constructor(e,t=Ke.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,V(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),cp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ke(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ke.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ie(e)?this:re(e)===".priority"?this.priorityNode_:Ke.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ke.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=re(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(V(s!==".priority"||Mn(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Ke.__childrenNodeConstructor.EMPTY_NODE.updateChild(ve(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+lp(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=jm(this.value_):e+=this.value_,this.lazyHash_=Mm(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ke.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ke.__childrenNodeConstructor?-1:(V(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,r=Ke.VALUE_TYPE_ORDER.indexOf(t),i=Ke.VALUE_TYPE_ORDER.indexOf(s);return V(r>=0,"Unknown leaf type: "+t),V(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ke.VALUE_TYPE_ORDER=["object","boolean","number","string"];let up,hp;function i0(n){up=n}function o0(n){hp=n}class a0 extends Lo{compare(e,t){const s=e.node.getPriority(),r=t.node.getPriority(),i=s.compareTo(r);return i===0?Ys(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return se.MIN}maxPost(){return new se(ns,new Ke("[PRIORITY-POST]",hp))}makePost(e,t){const s=up(e);return new se(t,new Ke("[PRIORITY-POST]",s))}toString(){return".priority"}}const Se=new a0;const l0=Math.log(2);class c0{constructor(e){const t=i=>parseInt(Math.log(i)/l0,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const co=function(n,e,t,s){n.sort(e);const r=function(c,h){const m=h-c;let p,y;if(m===0)return null;if(m===1)return p=n[c],y=t?t(p):p,new Ye(y,p.node,Ye.BLACK,null,null);{const T=parseInt(m/2,10)+c,N=r(c,T),R=r(T+1,h);return p=n[T],y=t?t(p):p,new Ye(y,p.node,Ye.BLACK,N,R)}},i=function(c){let h=null,m=null,p=n.length;const y=function(N,R){const k=p-N,q=p;p-=N;const W=r(k+1,q),H=n[k],z=t?t(H):H;T(new Ye(z,H.node,R,null,W))},T=function(N){h?(h.left=N,h=N):(m=N,h=N)};for(let N=0;N<c.count;++N){const R=c.nextBitIsOne(),k=Math.pow(2,c.count-(N+1));R?y(k,Ye.BLACK):(y(k,Ye.BLACK),y(k,Ye.RED))}return m},o=new c0(n.length),l=i(o);return new mt(s||e,l)};let xa;const _s={};class Zt{static get Default(){return V(_s&&Se,"ChildrenNode.ts has not been loaded"),xa=xa||new Zt({".priority":_s},{".priority":Se}),xa}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Rs(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof mt?t:null}hasIndex(e){return on(this.indexSet_,e.toString())}addIndex(e,t){V(e!==Ss,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=t.getIterator(se.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let l;r?l=co(s,e.getCompare()):l=_s;const c=e.toString(),h={...this.indexSet_};h[c]=e;const m={...this.indexes_};return m[c]=l,new Zt(m,h)}addToIndexes(e,t){const s=Hi(this.indexes_,(r,i)=>{const o=Rs(this.indexSet_,i);if(V(o,"Missing index implementation for "+i),r===_s)if(o.isDefinedOn(e.node)){const l=[],c=t.getIterator(se.Wrap);let h=c.getNext();for(;h;)h.name!==e.name&&l.push(h),h=c.getNext();return l.push(e),co(l,o.getCompare())}else return _s;else{const l=t.get(e.name);let c=r;return l&&(c=c.remove(new se(e.name,l))),c.insert(e,e.node)}});return new Zt(s,this.indexSet_)}removeFromIndexes(e,t){const s=Hi(this.indexes_,r=>{if(r===_s)return r;{const i=t.get(e.name);return i?r.remove(new se(e.name,i)):r}});return new Zt(s,this.indexSet_)}}let pr;class K{static get EMPTY_NODE(){return pr||(pr=new K(new mt(rc),null,Zt.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&cp(this.priorityNode_),this.children_.isEmpty()&&V(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||pr}updatePriority(e){return this.children_.isEmpty()?this:new K(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?pr:t}}getChild(e){const t=re(e);return t===null?this:this.getImmediateChild(t).getChild(ve(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(V(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new se(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?pr:this.priorityNode_;return new K(r,o,i)}}updateChild(e,t){const s=re(e);if(s===null)return t;{V(re(e)!==".priority"||Mn(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(ve(e),t);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,r=0,i=!0;if(this.forEachChild(Se,(o,l)=>{t[o]=l.val(e),s++,i&&K.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const l in t)o[l]=t[l];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+lp(this.getPriority().val())+":"),this.forEachChild(Se,(t,s)=>{const r=s.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":Mm(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new se(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new se(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new se(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,se.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,se.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ri?-1:0}withIndex(e){if(e===Ss||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new K(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ss||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(Se),r=t.getIterator(Se);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ss?null:this.indexMap_.get(e.toString())}}K.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class u0 extends K{constructor(){super(new mt(rc),K.EMPTY_NODE,Zt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return K.EMPTY_NODE}isEmpty(){return!1}}const ri=new u0;Object.defineProperties(se,{MIN:{value:new se(js,K.EMPTY_NODE)},MAX:{value:new se(ns,ri)}});ap.__EMPTY_NODE=K.EMPTY_NODE;Ke.__childrenNodeConstructor=K;r0(ri);o0(ri);const h0=!0;function Ze(n,e=null){if(n===null)return K.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),V(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ke(t,Ze(e))}if(!(n instanceof Array)&&h0){const t=[];let s=!1;if(pt(n,(o,l)=>{if(o.substring(0,1)!=="."){const c=Ze(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),t.push(new se(o,c)))}}),t.length===0)return K.EMPTY_NODE;const i=co(t,s0,o=>o.name,rc);if(s){const o=co(t,Se.getCompare());return new K(i,Ze(e),new Zt({".priority":o},{".priority":Se}))}else return new K(i,Ze(e),Zt.Default)}else{let t=K.EMPTY_NODE;return pt(n,(s,r)=>{if(on(n,s)&&s.substring(0,1)!=="."){const i=Ze(r);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(s,i))}}),t.updatePriority(Ze(e))}}i0(Ze);class d0 extends Lo{constructor(e){super(),this.indexPath_=e,V(!ie(e)&&re(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),r=this.extractChild(t.node),i=s.compareTo(r);return i===0?Ys(e.name,t.name):i}makePost(e,t){const s=Ze(e),r=K.EMPTY_NODE.updateChild(this.indexPath_,s);return new se(t,r)}maxPost(){const e=K.EMPTY_NODE.updateChild(this.indexPath_,ri);return new se(ns,e)}toString(){return rp(this.indexPath_,0).join("/")}}class f0 extends Lo{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Ys(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return se.MIN}maxPost(){return se.MAX}makePost(e,t){const s=Ze(e);return new se(t,s)}toString(){return".value"}}const m0=new f0;function dp(n){return{type:"value",snapshotNode:n}}function Fs(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function zr(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function qr(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function p0(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class ic{constructor(e){this.index_=e}updateChild(e,t,s,r,i,o){V(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(r).equals(s.getChild(r))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(zr(t,l)):V(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Fs(t,s)):o.trackChildChange(qr(t,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Se,(r,i)=>{t.hasChild(r)||s.trackChildChange(zr(r,i))}),t.isLeafNode()||t.forEachChild(Se,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(qr(r,i,o))}else s.trackChildChange(Fs(r,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?K.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class $r{constructor(e){this.indexedFilter_=new ic(e.getIndex()),this.index_=e.getIndex(),this.startPost_=$r.getStartPost_(e),this.endPost_=$r.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,r,i,o){return this.matches(new se(t,s))||(s=K.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,r,i,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=K.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(K.EMPTY_NODE);const i=this;return t.forEachChild(Se,(o,l)=>{i.matches(new se(o,l))||(r=r.updateImmediateChild(o,K.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class g0{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new $r(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,r,i,o){return this.rangedFilter_.matches(new se(t,s))||(s=K.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,r,i,o):this.fullLimitUpdateChild_(e,t,s,i,o)}updateFullNode(e,t,s){let r;if(t.isLeafNode()||t.isEmpty())r=K.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=K.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))r=r.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(K.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:r=r.updateImmediateChild(l.name,K.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,r,i){let o;if(this.reverse_){const p=this.index_.getCompare();o=(y,T)=>p(T,y)}else o=this.index_.getCompare();const l=e;V(l.numChildren()===this.limit_,"");const c=new se(t,s),h=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),m=this.rangedFilter_.matches(c);if(l.hasChild(t)){const p=l.getImmediateChild(t);let y=r.getChildAfterChild(this.index_,h,this.reverse_);for(;y!=null&&(y.name===t||l.hasChild(y.name));)y=r.getChildAfterChild(this.index_,y,this.reverse_);const T=y==null?1:o(y,c);if(m&&!s.isEmpty()&&T>=0)return i?.trackChildChange(qr(t,s,p)),l.updateImmediateChild(t,s);{i?.trackChildChange(zr(t,p));const R=l.updateImmediateChild(t,K.EMPTY_NODE);return y!=null&&this.rangedFilter_.matches(y)?(i?.trackChildChange(Fs(y.name,y.node)),R.updateImmediateChild(y.name,y.node)):R}}else return s.isEmpty()?e:m&&o(h,c)>=0?(i!=null&&(i.trackChildChange(zr(h.name,h.node)),i.trackChildChange(Fs(t,s))),l.updateImmediateChild(t,s).updateImmediateChild(h.name,K.EMPTY_NODE)):e}}class oc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Se}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return V(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return V(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:js}hasEnd(){return this.endSet_}getIndexEndValue(){return V(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return V(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ns}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return V(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Se}copy(){const e=new oc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function _0(n){return n.loadsAllData()?new ic(n.getIndex()):n.hasLimit()?new g0(n):new $r(n)}function Yh(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Se?t="$priority":n.index_===m0?t="$value":n.index_===Ss?t="$key":(V(n.index_ instanceof d0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ze(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=ze(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+ze(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=ze(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+ze(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Xh(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Se&&(e.i=n.index_.toString()),e}class uo extends tp{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(V(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=ni("p:rest:"),this.listens_={}}listen(e,t,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=uo.getListenId_(e,s),l={};this.listens_[o]=l;const c=Yh(e._queryParams);this.restRequest_(i+".json",c,(h,m)=>{let p=m;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(i,p,!1,s),Rs(this.listens_,o)===l){let y;h?h===401?y="permission_denied":y="rest_error:"+h:y="ok",r(y,null)}})}unlisten(e,t){const s=uo.getListenId_(e,t);delete this.listens_[s]}get(e){const t=Yh(e._queryParams),s=e._path.toString(),r=new fl;return this.restRequest_(s+".json",t,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(s,l,!1,null),r.resolve(l)):r.reject(new Error(l))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Cy(t);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Nr(l.responseText)}catch{wt("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&wt("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}class y0{constructor(){this.rootNode_=K.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ho(){return{value:null,children:new Map}}function fp(n,e,t){if(ie(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=re(e);n.children.has(s)||n.children.set(s,ho());const r=n.children.get(s);e=ve(e),fp(r,e,t)}}function el(n,e,t){n.value!==null?t(e,n.value):v0(n,(s,r)=>{const i=new ge(e.toString()+"/"+s);el(r,i,t)})}function v0(n,e){n.children.forEach((t,s)=>{e(s,t)})}class w0{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&pt(this.last_,(s,r)=>{t[s]=t[s]-r}),this.last_=e,t}}const Jh=10*1e3,b0=30*1e3,E0=300*1e3;class x0{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new w0(e);const s=Jh+(b0-Jh)*Math.random();Cr(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;pt(e,(r,i)=>{i>0&&on(this.statsToReport_,r)&&(t[r]=i,s=!0)}),s&&this.server_.reportStats(t),Cr(this.reportStats_.bind(this),Math.floor(Math.random()*2*E0))}}var Nt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Nt||(Nt={}));function mp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ac(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function lc(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class fo{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Nt.ACK_USER_WRITE,this.source=mp()}operationForChild(e){if(ie(this.path)){if(this.affectedTree.value!=null)return V(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ge(e));return new fo(de(),t,this.revert)}}else return V(re(this.path)===e,"operationForChild called for unrelated child."),new fo(ve(this.path),this.affectedTree,this.revert)}}class Gr{constructor(e,t){this.source=e,this.path=t,this.type=Nt.LISTEN_COMPLETE}operationForChild(e){return ie(this.path)?new Gr(this.source,de()):new Gr(this.source,ve(this.path))}}class ss{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Nt.OVERWRITE}operationForChild(e){return ie(this.path)?new ss(this.source,de(),this.snap.getImmediateChild(e)):new ss(this.source,ve(this.path),this.snap)}}class Wr{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Nt.MERGE}operationForChild(e){if(ie(this.path)){const t=this.children.subtree(new ge(e));return t.isEmpty()?null:t.value?new ss(this.source,de(),t.value):new Wr(this.source,de(),t)}else return V(re(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Wr(this.source,ve(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class On{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ie(e))return this.isFullyInitialized()&&!this.filtered_;const t=re(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class T0{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function I0(n,e,t,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(p0(o.childName,o.snapshotNode))}),gr(n,r,"child_removed",e,s,t),gr(n,r,"child_added",e,s,t),gr(n,r,"child_moved",i,s,t),gr(n,r,"child_changed",e,s,t),gr(n,r,"value",e,s,t),r}function gr(n,e,t,s,r,i){const o=s.filter(l=>l.type===t);o.sort((l,c)=>A0(n,l,c)),o.forEach(l=>{const c=C0(n,l,i);r.forEach(h=>{h.respondsTo(l.type)&&e.push(h.createEvent(c,n.query_))})})}function C0(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function A0(n,e,t){if(e.childName==null||t.childName==null)throw qs("Should only compare child_ events.");const s=new se(e.childName,e.snapshotNode),r=new se(t.childName,t.snapshotNode);return n.index_.compare(s,r)}function jo(n,e){return{eventCache:n,serverCache:e}}function Ar(n,e,t,s){return jo(new On(e,t,s),n.serverCache)}function pp(n,e,t,s){return jo(n.eventCache,new On(e,t,s))}function mo(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function rs(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Ta;const S0=()=>(Ta||(Ta=new mt(fx)),Ta);class xe{static fromObject(e){let t=new xe(null);return pt(e,(s,r)=>{t=t.set(new ge(s),r)}),t}constructor(e,t=S0()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:de(),value:this.value};if(ie(e))return null;{const s=re(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(ve(e),t);return i!=null?{path:qe(new ge(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ie(e))return this;{const t=re(e),s=this.children.get(t);return s!==null?s.subtree(ve(e)):new xe(null)}}set(e,t){if(ie(e))return new xe(t,this.children);{const s=re(e),i=(this.children.get(s)||new xe(null)).set(ve(e),t),o=this.children.insert(s,i);return new xe(this.value,o)}}remove(e){if(ie(e))return this.children.isEmpty()?new xe(null):new xe(null,this.children);{const t=re(e),s=this.children.get(t);if(s){const r=s.remove(ve(e));let i;return r.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,r),this.value===null&&i.isEmpty()?new xe(null):new xe(this.value,i)}else return this}}get(e){if(ie(e))return this.value;{const t=re(e),s=this.children.get(t);return s?s.get(ve(e)):null}}setTree(e,t){if(ie(e))return t;{const s=re(e),i=(this.children.get(s)||new xe(null)).setTree(ve(e),t);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new xe(this.value,o)}}fold(e){return this.fold_(de(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(qe(e,r),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,de(),t)}findOnPath_(e,t,s){const r=this.value?s(t,this.value):!1;if(r)return r;if(ie(e))return null;{const i=re(e),o=this.children.get(i);return o?o.findOnPath_(ve(e),qe(t,i),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,de(),t)}foreachOnPath_(e,t,s){if(ie(e))return this;{this.value&&s(t,this.value);const r=re(e),i=this.children.get(r);return i?i.foreachOnPath_(ve(e),qe(t,r),s):new xe(null)}}foreach(e){this.foreach_(de(),e)}foreach_(e,t){this.children.inorderTraversal((s,r)=>{r.foreach_(qe(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class kt{constructor(e){this.writeTree_=e}static empty(){return new kt(new xe(null))}}function Sr(n,e,t){if(ie(e))return new kt(new xe(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=ut(r,e);return i=i.updateChild(o,t),new kt(n.writeTree_.set(r,i))}else{const r=new xe(t),i=n.writeTree_.setTree(e,r);return new kt(i)}}}function Zh(n,e,t){let s=n;return pt(t,(r,i)=>{s=Sr(s,qe(e,r),i)}),s}function ed(n,e){if(ie(e))return kt.empty();{const t=n.writeTree_.setTree(e,new xe(null));return new kt(t)}}function tl(n,e){return cs(n,e)!=null}function cs(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ut(t.path,e)):null}function td(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Se,(s,r)=>{e.push(new se(s,r))}):n.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new se(s,r.value))}),e}function Cn(n,e){if(ie(e))return n;{const t=cs(n,e);return t!=null?new kt(new xe(t)):new kt(n.writeTree_.subtree(e))}}function nl(n){return n.writeTree_.isEmpty()}function Us(n,e){return gp(de(),n.writeTree_,e)}function gp(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(V(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):t=gp(qe(n,r),i,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(qe(n,".priority"),s)),t}}function Fo(n,e){return wp(e,n)}function R0(n,e,t,s,r){V(s>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:r}),r&&(n.visibleWrites=Sr(n.visibleWrites,e,t)),n.lastWriteId=s}function N0(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function k0(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);V(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let r=s.visible,i=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const l=n.allWrites[o];l.visible&&(o>=t&&P0(l,s.path)?r=!1:Rt(s.path,l.path)&&(i=!0)),o--}if(r){if(i)return D0(n),!0;if(s.snap)n.visibleWrites=ed(n.visibleWrites,s.path);else{const l=s.children;pt(l,c=>{n.visibleWrites=ed(n.visibleWrites,qe(s.path,c))})}return!0}else return!1}function P0(n,e){if(n.snap)return Rt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Rt(qe(n.path,t),e))return!0;return!1}function D0(n){n.visibleWrites=_p(n.allWrites,V0,de()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function V0(n){return n.visible}function _p(n,e,t){let s=kt.empty();for(let r=0;r<n.length;++r){const i=n[r];if(e(i)){const o=i.path;let l;if(i.snap)Rt(t,o)?(l=ut(t,o),s=Sr(s,l,i.snap)):Rt(o,t)&&(l=ut(o,t),s=Sr(s,de(),i.snap.getChild(l)));else if(i.children){if(Rt(t,o))l=ut(t,o),s=Zh(s,l,i.children);else if(Rt(o,t))if(l=ut(o,t),ie(l))s=Zh(s,de(),i.children);else{const c=Rs(i.children,re(l));if(c){const h=c.getChild(ve(l));s=Sr(s,de(),h)}}}else throw qs("WriteRecord should have .snap or .children")}}return s}function yp(n,e,t,s,r){if(!s&&!r){const i=cs(n.visibleWrites,e);if(i!=null)return i;{const o=Cn(n.visibleWrites,e);if(nl(o))return t;if(t==null&&!tl(o,de()))return null;{const l=t||K.EMPTY_NODE;return Us(o,l)}}}else{const i=Cn(n.visibleWrites,e);if(!r&&nl(i))return t;if(!r&&t==null&&!tl(i,de()))return null;{const o=function(h){return(h.visible||r)&&(!s||!~s.indexOf(h.writeId))&&(Rt(h.path,e)||Rt(e,h.path))},l=_p(n.allWrites,o,e),c=t||K.EMPTY_NODE;return Us(l,c)}}}function M0(n,e,t){let s=K.EMPTY_NODE;const r=cs(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(Se,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(t){const i=Cn(n.visibleWrites,e);return t.forEachChild(Se,(o,l)=>{const c=Us(Cn(i,new ge(o)),l);s=s.updateImmediateChild(o,c)}),td(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=Cn(n.visibleWrites,e);return td(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function O0(n,e,t,s,r){V(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=qe(e,t);if(tl(n.visibleWrites,i))return null;{const o=Cn(n.visibleWrites,i);return nl(o)?r.getChild(t):Us(o,r.getChild(t))}}function L0(n,e,t,s){const r=qe(e,t),i=cs(n.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(t)){const o=Cn(n.visibleWrites,r);return Us(o,s.getNode().getImmediateChild(t))}else return null}function j0(n,e){return cs(n.visibleWrites,e)}function F0(n,e,t,s,r,i,o){let l;const c=Cn(n.visibleWrites,e),h=cs(c,de());if(h!=null)l=h;else if(t!=null)l=Us(c,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const m=[],p=o.getCompare(),y=i?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let T=y.getNext();for(;T&&m.length<r;)p(T,s)!==0&&m.push(T),T=y.getNext();return m}else return[]}function U0(){return{visibleWrites:kt.empty(),allWrites:[],lastWriteId:-1}}function po(n,e,t,s){return yp(n.writeTree,n.treePath,e,t,s)}function cc(n,e){return M0(n.writeTree,n.treePath,e)}function nd(n,e,t,s){return O0(n.writeTree,n.treePath,e,t,s)}function go(n,e){return j0(n.writeTree,qe(n.treePath,e))}function B0(n,e,t,s,r,i){return F0(n.writeTree,n.treePath,e,t,s,r,i)}function uc(n,e,t){return L0(n.writeTree,n.treePath,e,t)}function vp(n,e){return wp(qe(n.treePath,e),n.writeTree)}function wp(n,e){return{treePath:n,writeTree:e}}class z0{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;V(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),V(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(s,qr(s,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(s,zr(s,r.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(s,Fs(s,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(s,qr(s,e.snapshotNode,r.oldSnap));else throw qs("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class q0{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const bp=new q0;class hc{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new On(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return uc(this.writes_,e,s)}}getChildAfterChild(e,t,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:rs(this.viewCache_),i=B0(this.writes_,r,t,1,s,e);return i.length===0?null:i[0]}}function $0(n){return{filter:n}}function G0(n,e){V(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),V(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function W0(n,e,t,s,r){const i=new z0;let o,l;if(t.type===Nt.OVERWRITE){const h=t;h.source.fromUser?o=sl(n,e,h.path,h.snap,s,r,i):(V(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered()&&!ie(h.path),o=_o(n,e,h.path,h.snap,s,r,l,i))}else if(t.type===Nt.MERGE){const h=t;h.source.fromUser?o=K0(n,e,h.path,h.children,s,r,i):(V(h.source.fromServer,"Unknown source."),l=h.source.tagged||e.serverCache.isFiltered(),o=rl(n,e,h.path,h.children,s,r,l,i))}else if(t.type===Nt.ACK_USER_WRITE){const h=t;h.revert?o=X0(n,e,h.path,s,r,i):o=Q0(n,e,h.path,h.affectedTree,s,r,i)}else if(t.type===Nt.LISTEN_COMPLETE)o=Y0(n,e,t.path,s,i);else throw qs("Unknown operation type: "+t.type);const c=i.getChanges();return H0(e,o,c),{viewCache:o,changes:c}}function H0(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=mo(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&t.push(dp(mo(e)))}}function Ep(n,e,t,s,r,i){const o=e.eventCache;if(go(s,t)!=null)return e;{let l,c;if(ie(t))if(V(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=rs(e),m=h instanceof K?h:K.EMPTY_NODE,p=cc(s,m);l=n.filter.updateFullNode(e.eventCache.getNode(),p,i)}else{const h=po(s,rs(e));l=n.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const h=re(t);if(h===".priority"){V(Mn(t)===1,"Can't have a priority with additional path components");const m=o.getNode();c=e.serverCache.getNode();const p=nd(s,t,m,c);p!=null?l=n.filter.updatePriority(m,p):l=o.getNode()}else{const m=ve(t);let p;if(o.isCompleteForChild(h)){c=e.serverCache.getNode();const y=nd(s,t,o.getNode(),c);y!=null?p=o.getNode().getImmediateChild(h).updateChild(m,y):p=o.getNode().getImmediateChild(h)}else p=uc(s,h,e.serverCache);p!=null?l=n.filter.updateChild(o.getNode(),h,p,m,r,i):l=o.getNode()}}return Ar(e,l,o.isFullyInitialized()||ie(t),n.filter.filtersNodes())}}function _o(n,e,t,s,r,i,o,l){const c=e.serverCache;let h;const m=o?n.filter:n.filter.getIndexedFilter();if(ie(t))h=m.updateFullNode(c.getNode(),s,null);else if(m.filtersNodes()&&!c.isFiltered()){const T=c.getNode().updateChild(t,s);h=m.updateFullNode(c.getNode(),T,null)}else{const T=re(t);if(!c.isCompleteForPath(t)&&Mn(t)>1)return e;const N=ve(t),k=c.getNode().getImmediateChild(T).updateChild(N,s);T===".priority"?h=m.updatePriority(c.getNode(),k):h=m.updateChild(c.getNode(),T,k,N,bp,null)}const p=pp(e,h,c.isFullyInitialized()||ie(t),m.filtersNodes()),y=new hc(r,p,i);return Ep(n,p,t,r,y,l)}function sl(n,e,t,s,r,i,o){const l=e.eventCache;let c,h;const m=new hc(r,e,i);if(ie(t))h=n.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Ar(e,h,!0,n.filter.filtersNodes());else{const p=re(t);if(p===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),s),c=Ar(e,h,l.isFullyInitialized(),l.isFiltered());else{const y=ve(t),T=l.getNode().getImmediateChild(p);let N;if(ie(y))N=s;else{const R=m.getCompleteChild(p);R!=null?sp(y)===".priority"&&R.getChild(ip(y)).isEmpty()?N=R:N=R.updateChild(y,s):N=K.EMPTY_NODE}if(T.equals(N))c=e;else{const R=n.filter.updateChild(l.getNode(),p,N,y,m,o);c=Ar(e,R,l.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function sd(n,e){return n.eventCache.isCompleteForChild(e)}function K0(n,e,t,s,r,i,o){let l=e;return s.foreach((c,h)=>{const m=qe(t,c);sd(e,re(m))&&(l=sl(n,l,m,h,r,i,o))}),s.foreach((c,h)=>{const m=qe(t,c);sd(e,re(m))||(l=sl(n,l,m,h,r,i,o))}),l}function rd(n,e,t){return t.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function rl(n,e,t,s,r,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,h;ie(t)?h=s:h=new xe(null).setTree(t,s);const m=e.serverCache.getNode();return h.children.inorderTraversal((p,y)=>{if(m.hasChild(p)){const T=e.serverCache.getNode().getImmediateChild(p),N=rd(n,T,y);c=_o(n,c,new ge(p),N,r,i,o,l)}}),h.children.inorderTraversal((p,y)=>{const T=!e.serverCache.isCompleteForChild(p)&&y.value===null;if(!m.hasChild(p)&&!T){const N=e.serverCache.getNode().getImmediateChild(p),R=rd(n,N,y);c=_o(n,c,new ge(p),R,r,i,o,l)}}),c}function Q0(n,e,t,s,r,i,o){if(go(r,t)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(ie(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return _o(n,e,t,c.getNode().getChild(t),r,i,l,o);if(ie(t)){let h=new xe(null);return c.getNode().forEachChild(Ss,(m,p)=>{h=h.set(new ge(m),p)}),rl(n,e,t,h,r,i,l,o)}else return e}else{let h=new xe(null);return s.foreach((m,p)=>{const y=qe(t,m);c.isCompleteForPath(y)&&(h=h.set(m,c.getNode().getChild(y)))}),rl(n,e,t,h,r,i,l,o)}}function Y0(n,e,t,s,r){const i=e.serverCache,o=pp(e,i.getNode(),i.isFullyInitialized()||ie(t),i.isFiltered());return Ep(n,o,t,s,bp,r)}function X0(n,e,t,s,r,i){let o;if(go(s,t)!=null)return e;{const l=new hc(s,e,r),c=e.eventCache.getNode();let h;if(ie(t)||re(t)===".priority"){let m;if(e.serverCache.isFullyInitialized())m=po(s,rs(e));else{const p=e.serverCache.getNode();V(p instanceof K,"serverChildren would be complete if leaf node"),m=cc(s,p)}m=m,h=n.filter.updateFullNode(c,m,i)}else{const m=re(t);let p=uc(s,m,e.serverCache);p==null&&e.serverCache.isCompleteForChild(m)&&(p=c.getImmediateChild(m)),p!=null?h=n.filter.updateChild(c,m,p,ve(t),l,i):e.eventCache.getNode().hasChild(m)?h=n.filter.updateChild(c,m,K.EMPTY_NODE,ve(t),l,i):h=c,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=po(s,rs(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,i)))}return o=e.serverCache.isFullyInitialized()||go(s,de())!=null,Ar(e,h,o,n.filter.filtersNodes())}}class J0{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new ic(s.getIndex()),i=_0(s);this.processor_=$0(i);const o=t.serverCache,l=t.eventCache,c=r.updateFullNode(K.EMPTY_NODE,o.getNode(),null),h=i.updateFullNode(K.EMPTY_NODE,l.getNode(),null),m=new On(c,o.isFullyInitialized(),r.filtersNodes()),p=new On(h,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=jo(p,m),this.eventGenerator_=new T0(this.query_)}get query(){return this.query_}}function Z0(n){return n.viewCache_.serverCache.getNode()}function eT(n){return mo(n.viewCache_)}function tT(n,e){const t=rs(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ie(e)&&!t.getImmediateChild(re(e)).isEmpty())?t.getChild(e):null}function id(n){return n.eventRegistrations_.length===0}function nT(n,e){n.eventRegistrations_.push(e)}function od(n,e,t){const s=[];if(t){V(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return s}function ad(n,e,t,s){e.type===Nt.MERGE&&e.source.queryId!==null&&(V(rs(n.viewCache_),"We should always have a full cache before handling merges"),V(mo(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,i=W0(n.processor_,r,e,t,s);return G0(n.processor_,i.viewCache),V(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,xp(n,i.changes,i.viewCache.eventCache.getNode(),null)}function sT(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Se,(i,o)=>{s.push(Fs(i,o))}),t.isFullyInitialized()&&s.push(dp(t.getNode())),xp(n,s,t.getNode(),e)}function xp(n,e,t,s){const r=s?[s]:n.eventRegistrations_;return I0(n.eventGenerator_,e,t,r)}let yo;class Tp{constructor(){this.views=new Map}}function rT(n){V(!yo,"__referenceConstructor has already been defined"),yo=n}function iT(){return V(yo,"Reference.ts has not been loaded"),yo}function oT(n){return n.views.size===0}function dc(n,e,t,s){const r=e.source.queryId;if(r!==null){const i=n.views.get(r);return V(i!=null,"SyncTree gave us an op for an invalid query."),ad(i,e,t,s)}else{let i=[];for(const o of n.views.values())i=i.concat(ad(o,e,t,s));return i}}function Ip(n,e,t,s,r){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let l=po(t,r?s:null),c=!1;l?c=!0:s instanceof K?(l=cc(t,s),c=!1):(l=K.EMPTY_NODE,c=!1);const h=jo(new On(l,c,!1),new On(s,r,!1));return new J0(e,h)}return o}function aT(n,e,t,s,r,i){const o=Ip(n,e,s,r,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),nT(o,t),sT(o,t)}function lT(n,e,t,s){const r=e._queryIdentifier,i=[];let o=[];const l=Ln(n);if(r==="default")for(const[c,h]of n.views.entries())o=o.concat(od(h,t,s)),id(h)&&(n.views.delete(c),h.query._queryParams.loadsAllData()||i.push(h.query));else{const c=n.views.get(r);c&&(o=o.concat(od(c,t,s)),id(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Ln(n)&&i.push(new(iT())(e._repo,e._path)),{removed:i,events:o}}function Cp(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function An(n,e){let t=null;for(const s of n.views.values())t=t||tT(s,e);return t}function Ap(n,e){if(e._queryParams.loadsAllData())return Uo(n);{const s=e._queryIdentifier;return n.views.get(s)}}function Sp(n,e){return Ap(n,e)!=null}function Ln(n){return Uo(n)!=null}function Uo(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let vo;function cT(n){V(!vo,"__referenceConstructor has already been defined"),vo=n}function uT(){return V(vo,"Reference.ts has not been loaded"),vo}let hT=1;class ld{constructor(e){this.listenProvider_=e,this.syncPointTree_=new xe(null),this.pendingWriteTree_=U0(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function dT(n,e,t,s,r){return R0(n.pendingWriteTree_,e,t,s,r),r?oi(n,new ss(mp(),e,t)):[]}function xs(n,e,t=!1){const s=N0(n.pendingWriteTree_,e);if(k0(n.pendingWriteTree_,e)){let i=new xe(null);return s.snap!=null?i=i.set(de(),!0):pt(s.children,o=>{i=i.set(new ge(o),!0)}),oi(n,new fo(s.path,i,t))}else return[]}function ii(n,e,t){return oi(n,new ss(ac(),e,t))}function fT(n,e,t){const s=xe.fromObject(t);return oi(n,new Wr(ac(),e,s))}function mT(n,e){return oi(n,new Gr(ac(),e))}function pT(n,e,t){const s=fc(n,t);if(s){const r=mc(s),i=r.path,o=r.queryId,l=ut(i,e),c=new Gr(lc(o),l);return pc(n,i,c)}else return[]}function wo(n,e,t,s,r=!1){const i=e._path,o=n.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||Sp(o,e))){const c=lT(o,e,t,s);oT(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const h=c.removed;if(l=c.events,!r){const m=h.findIndex(y=>y._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(i,(y,T)=>Ln(T));if(m&&!p){const y=n.syncPointTree_.subtree(i);if(!y.isEmpty()){const T=yT(y);for(let N=0;N<T.length;++N){const R=T[N],k=R.query,q=Dp(n,R);n.listenProvider_.startListening(Rr(k),Hr(n,k),q.hashFn,q.onComplete)}}}!p&&h.length>0&&!s&&(m?n.listenProvider_.stopListening(Rr(e),null):h.forEach(y=>{const T=n.queryToTagMap.get(Bo(y));n.listenProvider_.stopListening(Rr(y),T)}))}vT(n,h)}return l}function Rp(n,e,t,s){const r=fc(n,s);if(r!=null){const i=mc(r),o=i.path,l=i.queryId,c=ut(o,e),h=new ss(lc(l),c,t);return pc(n,o,h)}else return[]}function gT(n,e,t,s){const r=fc(n,s);if(r){const i=mc(r),o=i.path,l=i.queryId,c=ut(o,e),h=xe.fromObject(t),m=new Wr(lc(l),c,h);return pc(n,o,m)}else return[]}function il(n,e,t,s=!1){const r=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(r,(y,T)=>{const N=ut(y,r);i=i||An(T,N),o=o||Ln(T)});let l=n.syncPointTree_.get(r);l?(o=o||Ln(l),i=i||An(l,de())):(l=new Tp,n.syncPointTree_=n.syncPointTree_.set(r,l));let c;i!=null?c=!0:(c=!1,i=K.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((T,N)=>{const R=An(N,de());R&&(i=i.updateImmediateChild(T,R))}));const h=Sp(l,e);if(!h&&!e._queryParams.loadsAllData()){const y=Bo(e);V(!n.queryToTagMap.has(y),"View does not exist, but we have a tag");const T=wT();n.queryToTagMap.set(y,T),n.tagToQueryMap.set(T,y)}const m=Fo(n.pendingWriteTree_,r);let p=aT(l,e,t,m,i,c);if(!h&&!o&&!s){const y=Ap(l,e);p=p.concat(bT(n,e,y))}return p}function Np(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,l)=>{const c=ut(o,e),h=An(l,c);if(h)return h});return yp(r,e,i,t,!0)}function _T(n,e){const t=e._path;let s=null;n.syncPointTree_.foreachOnPath(t,(h,m)=>{const p=ut(h,t);s=s||An(m,p)});let r=n.syncPointTree_.get(t);r?s=s||An(r,de()):(r=new Tp,n.syncPointTree_=n.syncPointTree_.set(t,r));const i=s!=null,o=i?new On(s,!0,!1):null,l=Fo(n.pendingWriteTree_,e._path),c=Ip(r,e,l,i?o.getNode():K.EMPTY_NODE,i);return eT(c)}function oi(n,e){return kp(e,n.syncPointTree_,null,Fo(n.pendingWriteTree_,de()))}function kp(n,e,t,s){if(ie(n.path))return Pp(n,e,t,s);{const r=e.get(de());t==null&&r!=null&&(t=An(r,de()));let i=[];const o=re(n.path),l=n.operationForChild(o),c=e.children.get(o);if(c&&l){const h=t?t.getImmediateChild(o):null,m=vp(s,o);i=i.concat(kp(l,c,h,m))}return r&&(i=i.concat(dc(r,n,s,t))),i}}function Pp(n,e,t,s){const r=e.get(de());t==null&&r!=null&&(t=An(r,de()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=t?t.getImmediateChild(o):null,h=vp(s,o),m=n.operationForChild(o);m&&(i=i.concat(Pp(m,l,c,h)))}),r&&(i=i.concat(dc(r,n,s,t))),i}function Dp(n,e){const t=e.query,s=Hr(n,t);return{hashFn:()=>(Z0(e)||K.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?pT(n,t._path,s):mT(n,t._path);{const i=gx(r,t);return wo(n,t,null,i)}}}}function Hr(n,e){const t=Bo(e);return n.queryToTagMap.get(t)}function Bo(n){return n._path.toString()+"$"+n._queryIdentifier}function fc(n,e){return n.tagToQueryMap.get(e)}function mc(n){const e=n.indexOf("$");return V(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ge(n.substr(0,e))}}function pc(n,e,t){const s=n.syncPointTree_.get(e);V(s,"Missing sync point for query tag that we're tracking");const r=Fo(n.pendingWriteTree_,e);return dc(s,t,r,null)}function yT(n){return n.fold((e,t,s)=>{if(t&&Ln(t))return[Uo(t)];{let r=[];return t&&(r=Cp(t)),pt(s,(i,o)=>{r=r.concat(o)}),r}})}function Rr(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(uT())(n._repo,n._path):n}function vT(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const r=Bo(s),i=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(i)}}}function wT(){return hT++}function bT(n,e,t){const s=e._path,r=Hr(n,e),i=Dp(n,t),o=n.listenProvider_.startListening(Rr(e),r,i.hashFn,i.onComplete),l=n.syncPointTree_.subtree(s);if(r)V(!Ln(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((h,m,p)=>{if(!ie(h)&&m&&Ln(m))return[Uo(m).query];{let y=[];return m&&(y=y.concat(Cp(m).map(T=>T.query))),pt(p,(T,N)=>{y=y.concat(N)}),y}});for(let h=0;h<c.length;++h){const m=c[h];n.listenProvider_.stopListening(Rr(m),Hr(n,m))}}return o}class gc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new gc(t)}node(){return this.node_}}class _c{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=qe(this.path_,e);return new _c(this.syncTree_,t)}node(){return Np(this.syncTree_,this.path_)}}const ET=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},cd=function(n,e,t){if(!n||typeof n!="object")return n;if(V(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return xT(n[".sv"],e,t);if(typeof n[".sv"]=="object")return TT(n[".sv"],e);V(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},xT=function(n,e,t){if(n==="timestamp")return t.timestamp;V(!1,"Unexpected server value: "+n)},TT=function(n,e,t){n.hasOwnProperty("increment")||V(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&V(!1,"Unexpected increment value: "+s);const r=e.node();if(V(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},IT=function(n,e,t,s){return yc(e,new _c(t,n),s)},CT=function(n,e,t){return yc(n,new gc(e),t)};function yc(n,e,t){const s=n.getPriority().val(),r=cd(s,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,l=cd(o.getValue(),e,t);return l!==o.getValue()||r!==o.getPriority().val()?new Ke(l,Ze(r)):n}else{const o=n;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new Ke(r))),o.forEachChild(Se,(l,c)=>{const h=yc(c,e.getImmediateChild(l),t);h!==c&&(i=i.updateImmediateChild(l,h))}),i}}class vc{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function wc(n,e){let t=e instanceof ge?e:new ge(e),s=n,r=re(t);for(;r!==null;){const i=Rs(s.node.children,r)||{children:{},childCount:0};s=new vc(r,s,i),t=ve(t),r=re(t)}return s}function Xs(n){return n.node.value}function Vp(n,e){n.node.value=e,ol(n)}function Mp(n){return n.node.childCount>0}function AT(n){return Xs(n)===void 0&&!Mp(n)}function zo(n,e){pt(n.node.children,(t,s)=>{e(new vc(t,n,s))})}function Op(n,e,t,s){t&&e(n),zo(n,r=>{Op(r,e,!0)})}function ST(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function ai(n){return new ge(n.parent===null?n.name:ai(n.parent)+"/"+n.name)}function ol(n){n.parent!==null&&RT(n.parent,n.name,n)}function RT(n,e,t){const s=AT(t),r=on(n.node.children,e);s&&r?(delete n.node.children[e],n.node.childCount--,ol(n)):!s&&!r&&(n.node.children[e]=t.node,n.node.childCount++,ol(n))}const NT=/[\[\].#$\/\u0000-\u001F\u007F]/,kT=/[\[\].#$\u0000-\u001F\u007F]/,Ia=10*1024*1024,Lp=function(n){return typeof n=="string"&&n.length!==0&&!NT.test(n)},jp=function(n){return typeof n=="string"&&n.length!==0&&!kT.test(n)},PT=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),jp(n)},Fp=function(n,e,t){const s=t instanceof ge?new Qx(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Xn(s));if(typeof e=="function")throw new Error(n+"contains a function "+Xn(s)+" with contents = "+e.toString());if(Om(e))throw new Error(n+"contains "+e.toString()+" "+Xn(s));if(typeof e=="string"&&e.length>Ia/3&&Eo(e)>Ia)throw new Error(n+"contains a string greater than "+Ia+" utf8 bytes "+Xn(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(pt(e,(o,l)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Lp(o)))throw new Error(n+" contains an invalid key ("+o+") "+Xn(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Yx(s,o),Fp(n,l,s),Xx(s)}),r&&i)throw new Error(n+' contains ".value" child '+Xn(s)+" in addition to actual children.")}},Up=function(n,e,t,s){if(!jp(t))throw new Error(qd(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},DT=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Up(n,e,t)},VT=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Lp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!PT(t))throw new Error(qd(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class MT{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Bp(n,e){let t=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();t!==null&&!nc(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(r)}t&&n.eventLists_.push(t)}function zp(n,e,t){Bp(n,t),qp(n,s=>nc(s,e))}function Fn(n,e,t){Bp(n,t),qp(n,s=>Rt(s,e)||Rt(e,s))}function qp(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const r=n.eventLists_[s];if(r){const i=r.path;e(i)?(OT(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function OT(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Ir&&lt("event: "+t.toString()),si(s)}}}const LT="repo_interrupt",jT=25;class FT{constructor(e,t,s,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new MT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ho(),this.transactionQueueTree_=new vc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function UT(n,e,t){if(n.stats_=ec(n.repoInfo_),n.forceRestClient_||wx())n.server_=new uo(n.repoInfo_,(s,r,i,o)=>{ud(n,s,r,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>hd(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ze(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new en(n.repoInfo_,e,(s,r,i,o)=>{ud(n,s,r,i,o)},s=>{hd(n,s)},s=>{zT(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=Ix(n.repoInfo_,()=>new x0(n.stats_,n.server_)),n.infoData_=new y0,n.infoSyncTree_=new ld({startListening:(s,r,i,o)=>{let l=[];const c=n.infoData_.getNode(s._path);return c.isEmpty()||(l=ii(n.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),bc(n,"connected",!1),n.serverSyncTree_=new ld({startListening:(s,r,i,o)=>(n.server_.listen(s,i,r,(l,c)=>{const h=o(l,c);Fn(n.eventQueue_,s._path,h)}),[]),stopListening:(s,r)=>{n.server_.unlisten(s,r)}})}function BT(n){const t=n.infoData_.getNode(new ge(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function $p(n){return ET({timestamp:BT(n)})}function ud(n,e,t,s,r){n.dataUpdateCount++;const i=new ge(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(s){const c=Hi(t,h=>Ze(h));o=gT(n.serverSyncTree_,i,c,r)}else{const c=Ze(t);o=Rp(n.serverSyncTree_,i,c,r)}else if(s){const c=Hi(t,h=>Ze(h));o=fT(n.serverSyncTree_,i,c)}else{const c=Ze(t);o=ii(n.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=Tc(n,i)),Fn(n.eventQueue_,l,o)}function hd(n,e){bc(n,"connected",e),e===!1&&GT(n)}function zT(n,e){pt(e,(t,s)=>{bc(n,t,s)})}function bc(n,e,t){const s=new ge("/.info/"+e),r=Ze(t);n.infoData_.updateSnapshot(s,r);const i=ii(n.infoSyncTree_,s,r);Fn(n.eventQueue_,s,i)}function qT(n){return n.nextWriteId_++}function $T(n,e,t){const s=_T(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(r=>{const i=Ze(r).withIndex(e._queryParams.getIndex());il(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ii(n.serverSyncTree_,e._path,i);else{const l=Hr(n.serverSyncTree_,e);o=Rp(n.serverSyncTree_,e._path,i,l)}return Fn(n.eventQueue_,e._path,o),wo(n.serverSyncTree_,e,t,null,!0),i},r=>(Ec(n,"get for query "+ze(e)+" failed: "+r),Promise.reject(new Error(r))))}function GT(n){Ec(n,"onDisconnectEvents");const e=$p(n),t=ho();el(n.onDisconnect_,de(),(r,i)=>{const o=IT(r,i,n.serverSyncTree_,e);fp(t,r,o)});let s=[];el(t,de(),(r,i)=>{s=s.concat(ii(n.serverSyncTree_,r,i));const o=XT(n,r);Tc(n,o)}),n.onDisconnect_=ho(),Fn(n.eventQueue_,de(),s)}function WT(n,e,t){let s;re(e._path)===".info"?s=il(n.infoSyncTree_,e,t):s=il(n.serverSyncTree_,e,t),zp(n.eventQueue_,e._path,s)}function HT(n,e,t){let s;re(e._path)===".info"?s=wo(n.infoSyncTree_,e,t):s=wo(n.serverSyncTree_,e,t),zp(n.eventQueue_,e._path,s)}function KT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(LT)}function Ec(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),lt(t,...e)}function Gp(n,e,t){return Np(n.serverSyncTree_,e,t)||K.EMPTY_NODE}function xc(n,e=n.transactionQueueTree_){if(e||qo(n,e),Xs(e)){const t=Hp(n,e);V(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&QT(n,ai(e),t)}else Mp(e)&&zo(e,t=>{xc(n,t)})}function QT(n,e,t){const s=t.map(h=>h.currentWriteId),r=Gp(n,e,s);let i=r;const o=r.hash();for(let h=0;h<t.length;h++){const m=t[h];V(m.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),m.status=1,m.retryCount++;const p=ut(e,m.path);i=i.updateChild(p,m.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;n.server_.put(c.toString(),l,h=>{Ec(n,"transaction put response",{path:c.toString(),status:h});let m=[];if(h==="ok"){const p=[];for(let y=0;y<t.length;y++)t[y].status=2,m=m.concat(xs(n.serverSyncTree_,t[y].currentWriteId)),t[y].onComplete&&p.push(()=>t[y].onComplete(null,!0,t[y].currentOutputSnapshotResolved)),t[y].unwatcher();qo(n,wc(n.transactionQueueTree_,e)),xc(n,n.transactionQueueTree_),Fn(n.eventQueue_,e,m);for(let y=0;y<p.length;y++)si(p[y])}else{if(h==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{wt("transaction at "+c.toString()+" failed: "+h);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=h}Tc(n,e)}},o)}function Tc(n,e){const t=Wp(n,e),s=ai(t),r=Hp(n,t);return YT(n,r,s),s}function YT(n,e,t){if(e.length===0)return;const s=[];let r=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],h=ut(t,c.path);let m=!1,p;if(V(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)m=!0,p=c.abortReason,r=r.concat(xs(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=jT)m=!0,p="maxretry",r=r.concat(xs(n.serverSyncTree_,c.currentWriteId,!0));else{const y=Gp(n,c.path,o);c.currentInputSnapshot=y;const T=e[l].update(y.val());if(T!==void 0){Fp("transaction failed: Data returned ",T,c.path);let N=Ze(T);typeof T=="object"&&T!=null&&on(T,".priority")||(N=N.updatePriority(y.getPriority()));const k=c.currentWriteId,q=$p(n),W=CT(N,y,q);c.currentOutputSnapshotRaw=N,c.currentOutputSnapshotResolved=W,c.currentWriteId=qT(n),o.splice(o.indexOf(k),1),r=r.concat(dT(n.serverSyncTree_,c.path,W,c.currentWriteId,c.applyLocally)),r=r.concat(xs(n.serverSyncTree_,k,!0))}else m=!0,p="nodata",r=r.concat(xs(n.serverSyncTree_,c.currentWriteId,!0))}Fn(n.eventQueue_,t,r),r=[],m&&(e[l].status=2,(function(y){setTimeout(y,Math.floor(0))})(e[l].unwatcher),e[l].onComplete&&(p==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(p),!1,null))))}qo(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)si(s[l]);xc(n,n.transactionQueueTree_)}function Wp(n,e){let t,s=n.transactionQueueTree_;for(t=re(e);t!==null&&Xs(s)===void 0;)s=wc(s,t),e=ve(e),t=re(e);return s}function Hp(n,e){const t=[];return Kp(n,e,t),t.sort((s,r)=>s.order-r.order),t}function Kp(n,e,t){const s=Xs(e);if(s)for(let r=0;r<s.length;r++)t.push(s[r]);zo(e,r=>{Kp(n,r,t)})}function qo(n,e){const t=Xs(e);if(t){let s=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[s]=t[r],s++);t.length=s,Vp(e,t.length>0?t:void 0)}zo(e,s=>{qo(n,s)})}function XT(n,e){const t=ai(Wp(n,e)),s=wc(n.transactionQueueTree_,e);return ST(s,r=>{Ca(n,r)}),Ca(n,s),Op(s,r=>{Ca(n,r)}),t}function Ca(n,e){const t=Xs(e);if(t){const s=[];let r=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(V(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(V(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(xs(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Vp(e,void 0):t.length=i+1,Fn(n.eventQueue_,ai(e),r);for(let o=0;o<s.length;o++)si(s[o])}}function JT(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let r=t[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function ZT(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):wt(`Invalid query segment '${t}' in query '${n}'`)}return e}const dd=function(n,e){const t=eI(n),s=t.namespace;t.domain==="firebase.com"&&rn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&rn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||hx();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Km(t.host,t.secure,s,r,e,"",s!==t.subdomain),path:new ge(t.pathString)}},eI=function(n){let e="",t="",s="",r="",i="",o=!0,l="https",c=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));let m=n.indexOf("/");m===-1&&(m=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(m,p)),m<p&&(r=JT(n.substring(m,p)));const y=ZT(n.substring(Math.min(n.length,p)));h=e.indexOf(":"),h>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(h+1),10)):h=e.length;const T=e.slice(0,h);if(T.toLowerCase()==="localhost")t="localhost";else if(T.split(".").length<=2)t=T;else{const N=e.indexOf(".");s=e.substring(0,N).toLowerCase(),t=e.substring(N+1),i=s}"ns"in y&&(i=y.ns)}return{host:e,port:c,domain:t,subdomain:s,secure:o,scheme:l,pathString:r,namespace:i}};class tI{constructor(e,t,s,r){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ze(this.snapshot.exportVal())}}class nI{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Qp{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return V(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Ic{constructor(e,t,s,r){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=r}get key(){return ie(this._path)?null:sp(this._path)}get ref(){return new an(this._repo,this._path)}get _queryIdentifier(){const e=Xh(this._queryParams),t=Jl(e);return t==="{}"?"default":t}get _queryObject(){return Xh(this._queryParams)}isEqual(e){if(e=Pt(e),!(e instanceof Ic))return!1;const t=this._repo===e._repo,s=nc(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Kx(this._path)}}class an extends Ic{constructor(e,t){super(e,t,new oc,!1)}get parent(){const e=ip(this._path);return e===null?null:new an(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Kr{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ge(e),s=al(this.ref,e);return new Kr(this._node.getChild(t),s,Se)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new Kr(r,al(this.ref,s),Se)))}hasChild(e){const t=new ge(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Yp(n,e){return n=Pt(n),n._checkNotDeleted("ref"),e!==void 0?al(n._root,e):n._root}function al(n,e){return n=Pt(n),re(n._path)===null?DT("child","path",e):Up("child","path",e),new an(n._repo,qe(n._path,e))}function sI(n){n=Pt(n);const e=new Qp(()=>{}),t=new $o(e);return $T(n._repo,n,t).then(s=>new Kr(s,new an(n._repo,n._path),n._queryParams.getIndex()))}class $o{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new tI("value",this,new Kr(e.snapshotNode,new an(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new nI(this,e,t):null}matches(e){return e instanceof $o?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function rI(n,e,t,s,r){const i=new Qp(t,void 0),o=new $o(i);return WT(n._repo,n,o),()=>HT(n._repo,n,o)}function iI(n,e,t,s){return rI(n,"value",e)}rT(an);cT(an);const oI="FIREBASE_DATABASE_EMULATOR_HOST",ll={};let aI=!1;function lI(n,e,t,s){const r=e.lastIndexOf(":"),i=e.substring(0,r),o=Qr(i);n.repoInfo_=new Km(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function cI(n,e,t,s,r){let i=s||n.options.databaseURL;i===void 0&&(n.options.projectId||rn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),lt("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=dd(i,r),l=o.repoInfo,c;typeof process<"u"&&Dh&&(c=Dh[oI]),c?(i=`http://${c}?ns=${l.namespace}`,o=dd(i,r),l=o.repoInfo):o.repoInfo.secure;const h=new Ex(n.name,n.options,e);VT("Invalid Firebase Database URL",o),ie(o.path)||rn("Database URL must point to the root of a Firebase Database (not including a child path).");const m=hI(l,n,h,new bx(n,t));return new dI(m,n)}function uI(n,e){const t=ll[e];(!t||t[n.key]!==n)&&rn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),KT(n),delete t[n.key]}function hI(n,e,t,s){let r=ll[e.name];r||(r={},ll[e.name]=r);let i=r[n.toURLString()];return i&&rn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new FT(n,aI,t,s),r[n.toURLString()]=i,i}class dI{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(UT(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new an(this._repo,de())),this._rootInternal}_delete(){return this._rootInternal!==null&&(uI(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&rn("Cannot call "+e+" on a deleted database.")}}function fI(n=Yd(),e){const t=Wd(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Vd("database");s&&mI(t,...s)}return t}function mI(n,e,t,s={}){n=Pt(n),n._checkNotDeleted("useEmulator");const r=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&kr(s,i.repoInfo_.emulatorOptions))return;rn("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&rn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new qi(qi.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:Ld(s.mockUserToken,n.app.options.projectId);o=new qi(l)}Qr(e)&&(Od(e),jd("Database",!0)),lI(i,r,s,o)}function pI(n){ix(Kd),Pr(new Ns("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return cI(s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),bn(Vh,Mh,n),bn(Vh,Mh,"esm2020")}en.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};en.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};pI();const gI={apiKey:"AIzaSyCub0XtA27wJfA8QzLWTRcVvsn4Wiz84H0",authDomain:"tiger-superextension-09.firebaseapp.com",projectId:"tiger-superextension-09",storageBucket:"tiger-superextension-09.firebasestorage.app",messagingSenderId:"523127017746",appId:"1:523127017746:web:c58418b3ad5009509823cb",measurementId:"G-53CSV68T7D"},Xp=Qd(gI,"extension-app"),Go=FE(Xp),Jp=fI(Xp),_I=async(n,e,t)=>{try{const s=vm(Bl(Go,`users/${n}/history`));await km(s,{summary:e,url:t,timestamp:new Date().toISOString()})}catch(s){console.error("Error saving history to Firestore",s)}},yI=async n=>{try{const e=Bl(Go,`users/${n}/history`),t=XE(e,JE("timestamp","desc"),ZE(50));return(await Nm(t)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return console.error("Error fetching history from Firestore",e),[]}},vI=async n=>{try{const e=Bl(Go,`users/${n}/history`),s=(await Nm(e)).docs.map(r=>rx(r.ref));await Promise.all(s)}catch(e){throw console.error("Error clearing history from Firestore",e),e}},wI=async n=>{try{const e=vm(Go,"users",n.id);await km(e,{email:n.email,name:n.name,picture:n.picture,lastLogin:new Date().toISOString()},{merge:!0})}catch(e){throw console.error("Error saving user profile",e),e}},bI=async n=>{try{const e=n.replace(/\./g,"_"),t=Yp(Jp,`admin/users/${e}`);return(await sI(t)).val()?.isPro||!1}catch(e){return console.error("Error checking user pro status",e),!1}},EI=n=>{const e=Yp(Jp,"admin/features");return iI(e,t=>{t.val()})},xI="phc_CnQoAhO7LuIZtFrzKlzsMKL3bVmWtGv4sEUgMFnnM4I",TI="https://us.i.posthog.com";let Zp=!1,Cc=null;const II=()=>{Zp=!0},ct=async(n,e)=>{if(Zp)try{const t={api_key:xI,event:n,properties:{distinct_id:Cc||"anonymous_user",$lib:"summarai-extension",...e},timestamp:new Date().toISOString()};await fetch(`${TI}/capture/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){console.warn("Analytics Error:",t)}},CI=(n,e)=>{Cc=n,e&&ct("$identify",{$set:{email:e}})},AI=()=>{Cc=null},SI=[{name:"ChatGPT",domain:"chatgpt.com",url:"https://chatgpt.com"},{name:"Claude",domain:"claude.ai",url:"https://claude.ai"},{name:"OpenAI",domain:"openai.com",url:"https://openai.com"},{name:"Perplexity",domain:"perplexity.ai",url:"https://perplexity.ai"},{name:"Gemini",domain:"gemini.google.com",url:"https://gemini.google.com"},{name:"Meta AI",domain:"meta.ai",url:"https://meta.ai"},{name:"Microsoft Copilot",domain:"copilot.microsoft.com",url:"https://copilot.microsoft.com"},{name:"Poe",domain:"poe.com",url:"https://poe.com"},{name:"Character.AI",domain:"character.ai",url:"https://character.ai"},{name:"You.com",domain:"you.com",url:"https://you.com"},{name:"Pi",domain:"pi.ai",url:"https://pi.ai"},{name:"HuggingChat",domain:"huggingface.co",url:"https://huggingface.co/chat"},{name:"DeepSeek",domain:"deepseek.com",url:"https://deepseek.com"},{name:"Phind",domain:"phind.com",url:"https://phind.com"},{name:"Cursor",domain:"cursor.sh",url:"https://cursor.sh"},{name:"Figma",domain:"figma.com",url:"https://figma.com"},{name:"Visily",domain:"visily.ai",url:"https://visily.ai"},{name:"Uizard",domain:"uizard.io",url:"https://uizard.io"},{name:"UX Magic",domain:"uxmagic.ai",url:"https://uxmagic.ai"},{name:"Banani",domain:"banani.co",url:"https://banani.co"},{name:"Emergent",domain:"app.emergent.sh",url:"https://app.emergent.sh"},{name:"Rocket",domain:"rocket.new",url:"https://rocket.new"},{name:"Lovable",domain:"lovable.dev",url:"https://lovable.dev"},{name:"Bolt",domain:"bolt.new",url:"https://bolt.new"},{name:"Base44",domain:"base44.com",url:"https://base44.com"},{name:"Create XYZ",domain:"create.xyz",url:"https://create.xyz"},{name:"Memex",domain:"memex.tech",url:"https://memex.tech"},{name:"BuildFire",domain:"buildfire.com",url:"https://buildfire.com"},{name:"Glide",domain:"glideapps.com",url:"https://glideapps.com"},{name:"Flatlogic",domain:"flatlogic.com",url:"https://flatlogic.com"},{name:"Retool",domain:"retool.com",url:"https://retool.com"},{name:"UI Bakery",domain:"uibakery.io",url:"https://uibakery.io"},{name:"Zoho",domain:"zoho.com",url:"https://zoho.com"},{name:"Appy Pie",domain:"appypie.com",url:"https://appypie.com"}],RI=n=>{const e=n.replace("www.","").toLowerCase();return SI.some(t=>e.includes(t.domain))},NI=({open:n,onClose:e,summary:t,prompts:s,initialFeedback:r=""})=>{const[i,o]=O.useState(r),[l,c]=O.useState(!1),[h,m]=O.useState(!1),[p,y]=O.useState(""),[T,N]=O.useState(!1);cl.useEffect(()=>{n&&o(r)},[n,r]);const R=async()=>{if(!i.trim()){y("Please describe what went wrong.");return}m(!0),y("");try{const k={rating:"negative",feedback:i,summary_length:t.length,prompts_length:s.length};l&&(k.summary_text=t,k.input_prompts=s),ct("feedback_negative_detailed",k),N(!0),setTimeout(()=>{o(""),c(!1),N(!1),e()},1500)}catch(k){console.error("Failed to submit feedback:",k),y("Failed to submit feedback. Please try again.")}finally{m(!1)}};return n?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] animate-fade-in",onClick:e}),f.jsx("div",{className:"fixed inset-0 z-[201] flex items-center justify-center p-4",children:f.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slide-up-fade",onClick:k=>k.stopPropagation(),children:[f.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-200",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(uu,{className:"w-5 h-5 text-orange-500"}),f.jsx("h3",{className:"font-semibold text-gray-900",children:"Report Issue"})]}),f.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:f.jsx(bo,{className:"w-5 h-5"})})]}),f.jsx("div",{className:"p-5 space-y-4",children:T?f.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[f.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:f.jsx(Sn,{className:"w-8 h-8 text-green-600"})}),f.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Thank you!"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Your feedback has been submitted."})]}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"What went wrong?"}),f.jsx("textarea",{value:i,onChange:k=>{o(k.target.value),y("")},placeholder:"Describe the issue...",className:`w-full h-32 px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-black focus:border-transparent resize-none ${p?"border-red-300":"border-gray-300"}`,autoFocus:!0}),p&&f.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[f.jsx(uu,{className:"w-4 h-4"}),p]})]}),f.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>c(!l),children:[f.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-all ${l?"bg-black border-black":"bg-white border-gray-300"}`,children:l&&f.jsx(Sn,{className:"w-3 h-3 text-white"})}),f.jsxs("div",{className:"flex-1",children:[f.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Include conversation data for debugging"}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional."})]})]})]})}),f.jsxs("div",{className:"flex items-center justify-end gap-3 p-5 border-t border-gray-200",children:[f.jsx(ot,{variant:"ghost",onClick:e,disabled:h,children:"Cancel"}),f.jsx(ot,{onClick:R,disabled:h,className:"bg-black text-white hover:bg-gray-800",children:h?"Submitting...":"Submit Feedback"})]})]})})]}):null},kI=({isOpen:n,onClose:e})=>{const[t,s]=O.useState(!1),[r,i]=O.useState(null),o=async()=>{s(!0),i(null),setTimeout(()=>{s(!1),e(),X.success("Welcome to Pro! (Beta Access Granted)",{icon:"ðŸŒŸ"})},1500)};return n?f.jsxs("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-4",children:[f.jsx("div",{onClick:e,className:"absolute inset-0 bg-black/20 backdrop-blur-sm"}),f.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden",children:[f.jsx("button",{onClick:e,className:"absolute top-3 right-3 p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors z-10",children:f.jsx(bo,{className:"w-4 h-4"})}),f.jsxs("div",{className:"p-6 text-center",children:[f.jsx("div",{className:"mx-auto w-14 h-14 mb-4",children:f.jsx("img",{src:"/src/assets/logo.png",alt:"SummarAI",className:"w-full h-full object-contain"})}),f.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Upgrade to Pro"}),f.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Get 100 summaries per day"}),f.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full mb-5",children:[f.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),"Free during Beta"]}),f.jsx("div",{className:"space-y-2 mb-5 text-left",children:["100 daily summaries","Priority processing","Advanced AI models","Premium support"].map((l,c)=>f.jsxs("div",{className:"flex items-center gap-2.5 text-sm text-gray-600",children:[f.jsx(Sn,{className:"w-4 h-4 text-gray-400"}),l]},c))}),r&&f.jsx("div",{className:"mb-4 p-2.5 bg-red-50 text-red-600 text-xs rounded-lg",children:r}),f.jsx(ot,{onClick:o,disabled:t,className:"w-full h-10 text-sm font-medium bg-black hover:bg-gray-800 text-white rounded-xl transition-colors",children:t?f.jsxs(f.Fragment,{children:[f.jsx($i,{className:"w-4 h-4 mr-2 animate-spin"})," Activating..."]}):"Claim Free Pro"}),f.jsxs("p",{className:"mt-3 text-[10px] text-gray-400",children:[f.jsx("span",{className:"line-through",children:"$0.99/mo"})," â†’ Free in beta"]})]})]})]}):null},PI=({isOpen:n,onClose:e})=>{const[t,s]=O.useState(!1),r=async()=>{s(!0);try{await md(),e(),X.success("Successfully signed in!")}catch(i){console.error("Sign in failed:",i),X.error("Sign in failed")}finally{s(!1)}};return n?f.jsxs("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-4",children:[f.jsx("div",{onClick:e,className:"absolute inset-0 bg-black/20 backdrop-blur-sm"}),f.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden",children:[f.jsx("button",{onClick:e,className:"absolute top-3 right-3 p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors z-10",children:f.jsx(bo,{className:"w-4 h-4"})}),f.jsxs("div",{className:"p-6 text-center",children:[f.jsx("div",{className:"mx-auto w-14 h-14 mb-4",children:f.jsx("img",{src:"/src/assets/logo.png",alt:"SummarAI",className:"w-full h-full object-contain"})}),f.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Create Free Account"}),f.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Get 10 summaries per day"}),f.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full mb-5",children:[f.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),"Free Forever"]}),f.jsx("div",{className:"space-y-2 mb-5 text-left",children:["10 daily summaries","Save your history","Sync across devices","No credit card required"].map((i,o)=>f.jsxs("div",{className:"flex items-center gap-2.5 text-sm text-gray-600",children:[f.jsx(Sn,{className:"w-4 h-4 text-gray-400"}),i]},o))}),f.jsx(ot,{onClick:r,disabled:t,className:"w-full h-10 text-sm font-medium bg-black hover:bg-gray-800 text-white rounded-xl transition-colors",children:t?f.jsxs(f.Fragment,{children:[f.jsx($i,{className:"w-4 h-4 mr-2 animate-spin"})," Signing in..."]}):"Sign In with Google"}),f.jsx("p",{className:"mt-3 text-[10px] text-gray-400",children:"No credit card required"})]})]})]}):null},fd=({label:n,subtext:e,checked:t,onChange:s})=>f.jsxs("div",{className:"flex items-center gap-4 p-2 cursor-pointer group rounded-xl transition-colors",style:{backgroundColor:"transparent"},onMouseEnter:r=>r.currentTarget.style.backgroundColor="var(--bg-tertiary)",onMouseLeave:r=>r.currentTarget.style.backgroundColor="transparent",onClick:s,children:[f.jsx("div",{className:"w-5 h-5 rounded-md flex items-center justify-center transition-all duration-200 shrink-0",style:{backgroundColor:t?"var(--text-primary)":"var(--bg-secondary)",border:`2px solid ${t?"var(--text-primary)":"var(--border-primary)"}`},children:t&&f.jsx(Sn,{className:"w-3.5 h-3.5",style:{color:"var(--bg-primary)"},strokeWidth:3})}),f.jsxs("div",{className:"flex flex-col select-none",children:[f.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:n}),f.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:e})]})]}),DI=({user:n,isPro:e})=>{const[t,s]=O.useState(0),[r,i]=O.useState(n?10:5);if(O.useEffect(()=>{chrome.storage.local.get(["quotaUsed","quotaLimit"],c=>{c.quotaUsed!==void 0&&s(c.quotaUsed),c.quotaLimit!==void 0&&i(c.quotaLimit)});const l=c=>{c.quotaUsed&&s(c.quotaUsed.newValue),c.quotaLimit&&i(c.quotaLimit.newValue)};return chrome.storage.onChanged.addListener(l),()=>chrome.storage.onChanged.removeListener(l)},[]),O.useEffect(()=>{i(n?10:5)},[n]),e)return null;const o=Math.max(0,r-t);return f.jsx(Ae,{content:"Daily Quota",side:"bottom",children:f.jsxs("span",{className:"px-2 py-0.5 rounded-md text-[10px] font-semibold shadow-sm transition-colors",style:{backgroundColor:o===0?"#fee2e2":"var(--bg-secondary)",color:o===0?"#dc2626":"var(--text-secondary)",border:`1px solid ${o===0?"#fecaca":"var(--border-primary)"}`},children:[o," left"]})})},VI=({summary:n,onRegenerate:e,onReportIssue:t,isRegenerating:s,isGuest:r=!1})=>{const[i,o]=O.useState("idle"),[l,c]=O.useState(!1),[h,m]=O.useState(!1),[p,y]=O.useState(!1),T=R=>{R==="good"?l?c(!1):(c(!0),m(!1),o("good"),ct("summary_rated",{rating:"positive",summary_length:n.length}),setTimeout(()=>o("idle"),1e3)):(m(!h),c(!1),h||(o("bad"),t(),setTimeout(()=>o("idle"),2e3)))},N=()=>{navigator.clipboard.writeText(n),o("copied"),X.success("Copied to clipboard"),setTimeout(()=>o("idle"),2e3)};return f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-1 p-1 rounded-xl shadow-lg",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)"},children:[f.jsx(Ae,{content:"Good Response",children:f.jsx(ot,{variant:"ghost",size:"icon",onClick:()=>T("good"),className:Me("h-8 w-8 rounded-lg transition-colors",i==="good"?"text-green-600 bg-green-50":l&&"text-black"),children:f.jsx(gd,{className:Me("w-4 h-4",(l||i==="good")&&"fill-current")})})}),f.jsx(Ae,{content:"Bad Response",children:f.jsx(ot,{variant:"ghost",size:"icon",onClick:()=>T("bad"),className:Me("h-8 w-8 rounded-lg",h&&"text-black"),children:f.jsx(t_,{className:Me("w-4 h-4",h&&"fill-current")})})}),f.jsx("div",{className:"w-px h-4 bg-gray-200 mx-0.5 shrink-0"}),!r&&f.jsx(Ae,{content:s?"Regenerating...":"Regenerate",children:f.jsx(ot,{variant:"ghost",size:"icon",onClick:e,disabled:s,className:Me("h-8 w-8 rounded-lg transition-colors",s&&"bg-gray-100"),children:f.jsx(pd,{className:Me("w-4 h-4",s&&"animate-spin text-black")})})}),f.jsx(Ae,{content:"Copy",children:f.jsx(ot,{variant:"ghost",size:"icon",onClick:N,className:"h-8 w-8 rounded-lg",children:i==="copied"?f.jsx(Sn,{className:"w-4 h-4 text-green-600"}):f.jsx(Pg,{className:"w-4 h-4"})})}),!r&&f.jsx(Ae,{content:"More",disabled:p,children:f.jsx(ot,{variant:"ghost",size:"icon",onClick:()=>y(!p),className:"h-8 w-8 rounded-lg",children:f.jsx(Vg,{className:"w-4 h-4"})})})]}),p&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-[90]",onClick:()=>y(!1)}),f.jsxs("div",{className:"absolute bottom-full right-0 mb-2 z-[100] w-40 bg-white rounded-xl shadow-xl border border-gray-200 py-1 overflow-hidden",children:[f.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2 transition-colors",onClick:()=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const R=new SpeechSynthesisUtterance(n);window.speechSynthesis.speak(R),X.success("Listening...")}else X.error("Not supported");y(!1)},children:[f.jsx("svg",{className:"w-3.5 h-3.5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),"Listen"]}),f.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2 transition-colors",onClick:()=>{const R=window.open("","_blank");R&&(R.document.write(`
                                        <html>
                                            <head>
                                                <title>Summary - SummarAI</title>
                                                <style>
                                                    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 40px; line-height: 1.6; color: #111; max-width: 800px; margin: 0 auto; }
                                                    .header { border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; items-align: center; }
                                                    .brand { font-weight: 700; font-size: 20px; display: flex; align-items: center; gap: 10px; }
                                                    .logo { width: 24px; height: 24px; background: #000; border-radius: 6px; }
                                                    .meta { font-size: 12px; color: #666; }
                                                    p { white-space: pre-wrap; margin-bottom: 16px; }
                                                    ul { margin-left: 20px; }
                                                    li { margin-bottom: 8px; }
                                                </style>
                                            </head>
                                            <body>
                                                <div class="header">
                                                    <div class="brand">
                                                        <div class="logo"></div>
                                                        SummarAI
                                                    </div>
                                                    <div class="meta">
                                                        Generated on ${new Date().toLocaleDateString()}
                                                    </div>
                                                </div>
                                                ${n.replace(/\n/g,"<br>")}
                                            </body>
                                        </html>
                                    `),R.document.close(),R.print()),y(!1)},children:[f.jsx("svg",{className:"w-3.5 h-3.5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"PDF"]}),f.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs text-gray-700 hover:bg-gray-50 flex items-center gap-2 transition-colors",onClick:()=>{const R=encodeURIComponent("Summary from SummarAI"),k=encodeURIComponent(n);window.open(`mailto:?subject=${R}&body=${k}`),y(!1)},children:[f.jsx("svg",{className:"w-3.5 h-3.5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Mail"]}),f.jsx("div",{className:"h-px bg-gray-100 my-1"}),f.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs text-red-600 hover:bg-red-50 flex items-center gap-2 transition-colors",onClick:()=>{t(),y(!1)},children:[f.jsx(Og,{className:"w-3.5 h-3.5"}),"Report Issue"]})]})]})]})},MI="amaravadhibharath@gmail.com",OI=({onGenerateComplete:n,autoGenerate:e,onAutoGenerateHandled:t})=>{const[s,r]=O.useState("idle"),[i,o]=O.useState(!1),[l,c]=O.useState(!1),[h,m]=O.useState("none"),[p,y]=O.useState("TXT"),[T,N]=O.useState("auto"),[R,k]=O.useState(null),[q,W]=O.useState(!1),[H,z]=O.useState([]),[ue,B]=O.useState(!1),[b,_]=O.useState(!1),[v,x]=O.useState(!0),[E,I]=O.useState(!0),[w,ke]=O.useState(window.innerHeight||800),[nt,gt]=O.useState(""),[It,$]=O.useState(!1),[Wt,ln]=O.useState(!1),[Un,Vt]=O.useState(!1),[Pe,Re]=O.useState(0),[Xe,Ht]=O.useState("none"),[be,Kt]=O.useState(!1),[Ct,Mt]=O.useState(!1),[ht,_t]=O.useState(""),[Bn,us]=O.useState(!1),[li,Js]=O.useState(!1),[zn,ci]=O.useState(!0),[De,Je]=O.useState(!0),_e=Xe==="none"?R:Xe==="guest"?null:R,hs=Xe==="none"?q:Xe==="pro",ui=async()=>{if(!R?.email)return X.error("No email found");try{const A=X.loading("Sending email...");await fetch("https://tai-backend.amaravadhibharath.workers.dev/send-welcome-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:R.email,name:R.name})}),X.dismiss(A),X.success("Email sent!")}catch(A){X.dismiss(),X.error("Failed to send"),console.error(A)}};O.useEffect(()=>{const A=()=>ke(window.innerHeight||800);return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),O.useEffect(()=>{const A=EI();return()=>A()},[]),O.useEffect(()=>{const A=Y=>{Y.key==="Escape"&&(Bn?us(!1):s==="completed"&&ht&&(_t(""),r("idle")))};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[s,ht,Bn]),O.useEffect(()=>{R?.email&&bI(R.email).then(A=>{A&&W(!0)})},[R]),O.useEffect(()=>{e&&t&&(cn(),t())},[e]);const hi=w<250,Qt=async()=>{try{const[A]=await chrome.tabs.query({active:!0,currentWindow:!0}),Y=A?.url;if(Y){const ne=RI(Y);if(B(ne),A.id&&ne)try{await chrome.tabs.sendMessage(A.id,{action:"ping"}),_(!0)}catch{_(!0)}else _(!1)}else B(!1),_(!1)}catch(A){console.error("Tab check failed:",A),B(!1)}finally{I(!1)}},ds=async()=>{try{const[A]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!A?.id){x(!1);return}const Y=A.url||"";if(!(Y.includes("chatgpt.com")||Y.includes("gemini.google.com")||Y.includes("claude.ai"))){x(!0);return}x(!0)}catch{x(!0)}};O.useEffect(()=>{II(),setTimeout(()=>{ct("extension_opened")},100),chrome.storage.local.get(["isPro"],ne=>{W(!!ne.isPro)}),Qt(),ds();const A=()=>{I(!0),Qt(),ds()},Y=(ne,yt,Fe)=>{Fe.active&&(Qt(),ds())};return chrome.tabs.onActivated.addListener(A),chrome.tabs.onUpdated.addListener(Y),()=>{chrome.tabs.onActivated.removeListener(A),chrome.tabs.onUpdated.removeListener(Y)}},[]),O.useEffect(()=>{const A=wg(async Y=>{if(k(Y),Y){CI(Y.id,Y.email||void 0),wI(Y);const ne=await yI(Y.id);ne&&ne.length>0&&(z(ne),chrome.storage.local.set({history:ne})),chrome.storage.local.set({quotaUsed:0})}else AI()});return()=>A()},[]),O.useEffect(()=>{chrome.storage.local.get(["summaryType","provider","history"],A=>{A.summaryType&&y(A.summaryType),A.provider&&N(A.provider),A.history&&Array.isArray(A.history)&&z(A.history)})},[]);const di=async()=>{Kt(!0);try{await md(),Ht("none"),m("none"),X.success("Successfully signed in!")}catch(A){console.error("Login Error:",A),X.error(`Login failed: ${A.message}`)}finally{Kt(!1)}},Zs=async()=>{await Eg(),m("none"),X("Successfully signed out.",{icon:"ðŸ‘‹"})},Wo=A=>{m("none"),ct("history_item_viewed",{item_id:A.id}),n&&n(A.summary)},er=A=>{A==="docs"?window.open("https://docs.google.com/document/d/1L1BC8IQIQW72Rdpqi1L7TPmeQyc2e9mQAxzExC5un_A/edit?usp=sharing","_blank"):window.open(`https://superextension.in/help?topic=${A}`,"_blank"),m("none"),ct("help_action_clicked",{action:A})},fs=async(A,Y,ne)=>{const yt=typeof A=="string"?A:"";let Fe=Y||p;(p==="JSON"||p==="XML")&&Fe==="paragraph"&&(Fe=p);const qn=ne||"normal";r("generating");try{const[dt]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!dt.id)throw new Error("No active tab found");const me=await chrome.tabs.sendMessage(dt.id,{action:"getPageContent",includeImages:l},{frameId:0});if(me&&"code"in me){r("error"),X.error(f.jsxs("div",{children:[f.jsx("div",{className:"font-semibold",children:me.message}),f.jsxs("div",{className:"text-xs mt-1 opacity-90",children:["ðŸ’¡ ",me.suggestion]}),me.platform&&f.jsxs("div",{className:"text-xs mt-1 opacity-75",children:["Platform: ",me.platform]})]}),{duration:8e3}),ct("scraping_failed",{code:me.code,platform:me.platform||"unknown",url:dt.url});return}if(!me){r("error"),X.error(f.jsxs("div",{children:[f.jsx("div",{className:"font-semibold",children:"Unable to access page content"}),f.jsx("div",{className:"text-xs mt-1 opacity-90",children:"ðŸ’¡ Try refreshing the page and waiting for it to fully load"})]}),{duration:6e3});return}ct("scraping_success",{platform:me.platform||"unknown",messageCount:me.conversation?.length||0,hasStructuredData:me.conversation&&me.conversation.length>0});let ye="";if(me.conversation&&me.conversation.length>0?ye=me.conversation.filter(le=>i?!0:le.role==="user").map(le=>`${le.role==="user"?"User":"AI"}: ${le.content}`).join(`

`):ye=ty(me,{includeAI:i}),(!ye||ye.trim().length===0)&&(ye=me.rawText||"",!ye))throw new Error("No content found");gt(ye);const mi=new Promise(le=>setTimeout(le,1e3));let bt="";try{const le=await chrome.storage.local.get(["deviceId"]);le.deviceId?bt=le.deviceId:(bt=`device_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,await chrome.storage.local.set({deviceId:bt}))}catch{bt=`temp_${Date.now()}`}let Yt;if(R)try{const le=await new Promise(st=>{chrome.identity.getAuthToken({interactive:!1},Et=>{st(Et||void 0)})});le&&(Yt=le)}catch(le){console.error("Auth token error:",le)}let Ot=T;const $n=ye.trim().length;$n<50&&(Ot="openai");let We,Ho=Ot;hs&&await new Promise((le,st)=>{chrome.storage.local.get(["quotaUsed","quotaDate"],Et=>{const tr=new Date().toDateString();let un=Et.quotaUsed||0;Et.quotaDate!==tr&&(un=0),un>=99?st(new Error("Daily Quota Exceeded")):le()})});try{const[le]=await Promise.all([bu(ye,{includeAI:i,format:Fe,length:"medium",apiKey:"",provider:Ot,images:l?me.images:void 0,tone:qn},Ot,yt,Yt,bt),mi]);We=le,ct("summary_generated_success",{provider:Ot,contentLength:$n,wasShortContent:$n<50,format:Fe,tone:qn})}catch(le){if(console.error(`Lotus: ${Ot} failed:`,le),Ot==="openai")try{const[st]=await Promise.all([bu(ye,{includeAI:i,format:Fe,length:"medium",apiKey:"",provider:"google",images:l?me.images:void 0,tone:qn},"google",yt,Yt,bt),new Promise(Et=>setTimeout(Et,500))]);We=st,Ho="google",ct("summary_generated_fallback",{primaryProvider:"openai",fallbackProvider:"gemini",contentLength:$n,primaryError:le.message}),setTimeout(()=>{X.success("âœ¨ Summary generated using Gemini (OpenAI temporarily unavailable)",{duration:4e3})},1200)}catch(st){throw console.error("Lotus: Gemini fallback also failed:",st),ct("summary_generation_failed",{primaryProvider:"openai",fallbackProvider:"gemini",primaryError:le.message,fallbackError:st.message}),new Error(`Both providers failed. OpenAI: ${le.message}, Gemini: ${st.message}`)}else throw ct("summary_generation_failed",{provider:Ot,error:le.message,contentLength:$n}),le}if(!We||We.trim().length===0)throw new Error("AI returned an empty summary");_t(We),r("completed"),Mt(!1);const Ko={id:Date.now(),summary:We,date:new Date().toISOString(),preview:We.slice(0,100)+"...",platform:me.platform||"generic",type:l?"prompt+response+image":i?"prompt+response":"prompt"};chrome.storage.local.get(["history"],le=>{const st=le.history||[],Et=[Ko,...st].slice(0,50);chrome.storage.local.set({history:Et}),z(Et)}),chrome.storage.local.get(["summarizeCount"],le=>{const st=le.summarizeCount||0;chrome.storage.local.set({summarizeCount:st+1})}),R&&dt.url&&We&&_I(R.id,We,dt.url),ct("summary_generated",{type:p,length:We.length,is_pro:hs,include_ai:i,analyze_images:l,format:Fe,tone:qn,provider:T}),_e||setTimeout(()=>{X.success("ðŸŽ‰ Summary generated! Sign in for more features.",{duration:6e3,icon:"ðŸš€"})},1e3),n&&n(We)}catch(dt){console.error("Generation failed:",dt);const me=dt.message||"Failed to generate summary";me.includes("Guest Quota Exceeded")||me.includes("Daily Quota Exceeded")?(_e?ln(!0):Vt(!0),r("error")):(r("error"),X.error(me)),ct("generation_failed",{error:me})}finally{Mt(!1)}},fi=()=>{confirm("Are you sure you want to clear your history?")&&(chrome.storage.local.set({history:[]}),z([]),R&&vI(R.id),X.success("History cleared successfully."))},cn=()=>{Mt(!0),ct("regenerate_clicked"),fs()};return O.useEffect(()=>{const A=Y=>{if(h!=="none"){const ne=Y.target;!ne.closest(".popup-content")&&!ne.closest("button")&&m("none")}};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[h]),O.useEffect(()=>{_e&&bg(_e)},[_e]),f.jsxs(J_,{children:[f.jsxs("div",{className:"flex flex-col h-full relative",children:[f.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:f.jsxs("div",{className:"w-full h-full flex flex-col relative rounded-2xl overflow-hidden",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)"},children:[f.jsxs("div",{className:"absolute top-4 right-4 z-[300] flex items-center gap-2",children:[(()=>{const A=R?.email===MI;let Y="GUEST",ne="bg-blue-50 text-blue-600 border-blue-100";return Xe==="none"&&A?(Y="ADMIN",ne="bg-black text-white border-black"):hs?(Y="PRO",ne="bg-yellow-50 text-yellow-600 border-yellow-100"):_e&&(Y="FREE",ne="bg-green-50 text-green-600 border-green-100"),f.jsx("span",{className:Me("px-1.5 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider border shadow-sm cursor-pointer transition-colors",ne),onClick:()=>{const yt=Pe+1;Re(yt),yt===6&&(m("feedback"),Re(0))},children:Y})})(),f.jsx(DI,{user:_e,isPro:hs}),f.jsx(Ae,{content:"Profile",disabled:h==="profile",side:"bottom",children:f.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600 cursor-pointer hover:bg-gray-300 transition-colors overflow-hidden",onClick:()=>m(h==="profile"?"none":"profile"),children:_e&&_e.picture?f.jsx("img",{src:_e.picture,alt:"Profile",className:"w-full h-full object-cover"}):_e&&_e.name?_e.name[0].toUpperCase():f.jsx(fu,{className:"w-4 h-4"})})}),h==="profile"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-[150]",onClick:()=>m("none")}),f.jsx("div",{className:"popup-content fixed top-[74px] right-8 w-auto min-w-[200px] max-w-[400px] max-h-[400px] overflow-y-auto rounded-2xl shadow-xl z-[300] flex flex-col py-1",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},onClick:A=>A.stopPropagation(),children:_e?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[f.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:_e.name}),f.jsx("p",{className:"text-[10px] truncate",style:{color:"var(--text-secondary)"},children:_e.email})]}),!(R?.email==="amaravadhibharath@gmail.com"&&Xe==="none")&&f.jsxs("button",{onClick:Zs,className:"flex items-center gap-2 px-4 py-2.5 text-xs text-red-600 hover:bg-red-50 w-full text-left transition-colors",children:[f.jsx(Wg,{className:"w-3.5 h-3.5"}),"Logout"]}),R?.email==="amaravadhibharath@gmail.com"&&Xe==="none"&&f.jsxs("div",{className:"px-4 py-2 border-t border-gray-100",children:[f.jsx("p",{className:"text-[10px] font-semibold text-gray-400 uppercase tracking-wider mb-2",children:"Simulate Mode"}),f.jsx("div",{className:"grid grid-cols-4 gap-1",children:["none","guest","free","pro"].map(A=>f.jsx("button",{onClick:Y=>{Y.stopPropagation(),Ht(A)},className:Me("px-1 py-1 text-[9px] font-medium rounded border transition-all text-center",Xe===A?"bg-black text-white border-black":"bg-white text-gray-600 border-gray-200 hover:border-gray-300"),children:A==="none"?"Real":A.charAt(0).toUpperCase()},A))}),f.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[f.jsx(Ae,{content:"Test Welcome Email",children:f.jsx("button",{onClick:A=>{A.stopPropagation(),ui()},className:"w-full py-1.5 flex items-center justify-center text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100",children:f.jsx(qg,{className:"w-4 h-4"})})}),f.jsx(Ae,{content:"Extract Prompts (Admin)",children:f.jsx("button",{onClick:async A=>{A.stopPropagation();try{const[Y]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!Y?.id)return X.error("No active tab");const ne=await chrome.tabs.sendMessage(Y.id,{action:"getPageContent",includeImages:!1});if(ne?.error){X.error(ne.error);return}const yt=ne.conversation.filter(Fe=>Fe.role==="user").map(Fe=>Fe.text).join(`

---

`);if(!yt){X.error("No user prompts found");return}await navigator.clipboard.writeText(yt),X.success(`Copied ${ne.conversation.filter(Fe=>Fe.role==="user").length} prompts!`)}catch(Y){Y.message?.includes("No tab with id")||Y.message?.includes("Cannot access")?X.error("Tab closed or inaccessible. Please reload the page."):X.error(Y.message||"Failed to extract prompts")}},className:"w-full py-1.5 flex items-center justify-center text-green-600 bg-green-50 border border-green-200 rounded hover:bg-green-100",children:f.jsx(la,{className:"w-4 h-4"})})}),f.jsx(Ae,{content:"Clear Cache",children:f.jsx("button",{onClick:async A=>{A.stopPropagation();try{await chrome.storage.local.clear(),X.success("Cache cleared successfully."),z([]),_t(""),r("idle")}catch{X.error("Failed to clear cache")}},className:"w-full py-1.5 flex items-center justify-center text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100",children:f.jsx(r_,{className:"w-4 h-4"})})})]}),f.jsxs("div",{className:"relative mt-2",children:[f.jsxs("button",{onClick:A=>{A.stopPropagation(),Js(!li)},className:"w-full py-1 text-[10px] font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded hover:bg-gray-100 flex items-center justify-center gap-1",children:["Test Toasts",f.jsx(Oi,{className:"w-3 h-3"})]}),li&&f.jsxs("div",{className:"mt-1 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col p-1 gap-1",children:[f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsxs("div",{className:"flex items-center justify-between text-[9px] font-semibold text-gray-400 px-1 uppercase tracking-wider cursor-pointer hover:text-gray-600",onClick:A=>{A.stopPropagation(),ci(!zn)},children:[f.jsx("span",{children:"Success Types"}),f.jsx(Oi,{className:Me("w-3 h-3 transition-transform",!zn&&"-rotate-90")})]}),zn&&f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:A=>{A.stopPropagation(),X.success("Successfully signed in!")},className:"py-1 text-[10px] font-medium text-green-600 bg-green-50 border border-green-200 rounded hover:bg-green-100 text-left px-2",children:"Login Success"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X("Successfully signed out.",{icon:"ðŸ‘‹"})},className:"py-1 text-[10px] font-medium text-green-600 bg-green-50 border border-green-200 rounded hover:bg-green-100 text-left px-2",children:"Logout Success"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X.success("Format changed to JSON")},className:"py-1 text-[10px] font-medium text-green-600 bg-green-50 border border-green-200 rounded hover:bg-green-100 text-left px-2",children:"Format Change"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X.success("History cleared successfully.")},className:"py-1 text-[10px] font-medium text-green-600 bg-green-50 border border-green-200 rounded hover:bg-green-100 text-left px-2",children:"History Cleared"})]})]}),f.jsx("div",{className:"h-px bg-gray-100 my-1"}),f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsxs("div",{className:"flex items-center justify-between text-[9px] font-semibold text-gray-400 px-1 uppercase tracking-wider cursor-pointer hover:text-gray-600",onClick:A=>{A.stopPropagation(),Je(!De)},children:[f.jsx("span",{children:"Error Types"}),f.jsx(Oi,{className:Me("w-3 h-3 transition-transform",!De&&"-rotate-90")})]}),De&&f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:A=>{A.stopPropagation(),X.error("Login failed. Please try again.")},className:"py-1 text-[10px] font-medium text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100 text-left px-2",children:"Auth Failed"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X.error("You've used all 5 free summaries today! Sign in with Google to get 10 daily summaries.",{duration:5e3})},className:"py-1 text-[10px] font-medium text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100 text-left px-2",children:"Quota Exceeded"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X.error("No user prompts found")},className:"py-1 text-[10px] font-medium text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100 text-left px-2",children:"No Content"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X.error("Tab closed or inaccessible. Please reload the page.")},className:"py-1 text-[10px] font-medium text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100 text-left px-2",children:"Connection Error"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X.error("Error! Something went wrong.")},className:"py-1 text-[10px] font-medium text-red-600 bg-red-50 border border-red-200 rounded hover:bg-red-100 text-left px-2",children:"Generic Error"})]})]}),f.jsx("div",{className:"h-px bg-gray-100 my-1"}),f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsx("div",{className:"text-[9px] font-semibold text-gray-400 px-1 uppercase tracking-wider",children:"Modals"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),ln(!0)},className:"py-1 text-[10px] font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 text-left px-2",children:"Test Upgrade Modal"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),Vt(!0)},className:"py-1 text-[10px] font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 text-left px-2",children:"Test Guest Limit Modal"})]}),f.jsx("div",{className:"h-px bg-gray-100 my-1"}),f.jsx("button",{onClick:A=>{A.stopPropagation();const Y=X.loading("Loading data...");setTimeout(()=>X.dismiss(Y),2e3)},className:"py-1 text-[10px] font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100",children:"Loading"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),X("Custom Icon Toast",{icon:"ðŸš€"})},className:"py-1 text-[10px] font-medium text-purple-600 bg-purple-50 border border-purple-200 rounded hover:bg-purple-100",children:"Custom"}),f.jsx("div",{className:"h-px bg-gray-100 my-1"}),f.jsx("div",{className:"text-[9px] font-semibold text-gray-400 px-1 uppercase tracking-wider",children:"Pages"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),chrome.tabs.create({url:chrome.runtime.getURL("welcome.html")})},className:"py-1 text-[10px] font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded hover:bg-gray-100 text-left px-2",children:"Open Welcome"}),f.jsx("button",{onClick:A=>{A.stopPropagation(),window.open("https://www.superextension.in/","_blank")},className:"py-1 text-[10px] font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded hover:bg-gray-100 text-left px-2",children:"Open Landing"})]})]})]})]}):f.jsxs("div",{className:"p-4 flex flex-col gap-3",children:[f.jsx("p",{className:"text-xs text-gray-600 text-center",children:"Sign in to sync and upgrade"}),f.jsx("button",{onClick:di,disabled:be,className:"flex items-center justify-center gap-2 w-full py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors text-xs font-medium",children:be?"Signing in...":f.jsxs(f.Fragment,{children:[f.jsx(fu,{className:"w-3.5 h-3.5"})," Sign in with Google"]})})]})})]})]}),f.jsx("div",{className:"w-full h-full flex flex-col relative",children:s==="completed"&&ht?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"shrink-0 p-4 pb-0",children:f.jsx(Ae,{content:"Back",side:"right",children:f.jsx(ot,{variant:"secondary",size:"icon",onClick:()=>{_t(""),r("idle")},className:"rounded-full w-8 h-8 shadow-sm backdrop-blur-sm",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},children:f.jsx(Cg,{className:"w-4 h-4 text-gray-600"})})})}),f.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-6 py-4 pb-24",children:Bn?f.jsx("textarea",{value:ht,onChange:A=>_t(A.target.value),onBlur:()=>us(!1),autoFocus:!0,className:"w-full h-full resize-none p-0 text-sm leading-relaxed bg-transparent border-none focus:ring-0 focus:outline-none",style:{color:"var(--text-primary)"}}):f.jsx("div",{onClick:()=>us(!0),className:"text-sm leading-relaxed cursor-text space-y-2",style:{color:"var(--text-primary)",textAlign:"justify"},children:ht.split(`
`).map((A,Y)=>{const ne=A.trim();return ne.startsWith("-")||ne.startsWith("*")?f.jsxs("div",{className:"flex gap-2 items-start",children:[f.jsx("span",{className:"shrink-0 font-bold",style:{color:"var(--text-primary)"},children:"â€¢"}),f.jsx("span",{children:ne.substring(1).trim()})]},Y):f.jsx("p",{children:A},Y)})})}),f.jsx("div",{className:"absolute bottom-16 left-0 right-0 flex justify-center z-20 pointer-events-none",children:f.jsx("span",{className:"text-[10px] px-3 py-1 rounded-full shadow-sm backdrop-blur-sm",style:{color:"var(--text-secondary)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},children:"Captures your final intent. Regenerate if needed."})})]}):E?f.jsx("div",{className:"flex items-center justify-center h-full",children:f.jsx("div",{className:"w-6 h-6 border-2 border-gray-100 border-t-gray-400 rounded-full animate-spin"})}):ue?v?b?f.jsx("div",{className:"flex items-center justify-center h-full",children:f.jsx("span",{className:"text-sm",style:{color:"var(--text-tertiary)"},children:"Ready to generate"})}):f.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-50 flex items-center justify-center",children:f.jsx(pd,{className:"w-6 h-6 text-orange-600"})}),f.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"Reload Required"}),f.jsx("button",{onClick:async()=>{const[A]=await chrome.tabs.query({active:!0,currentWindow:!0});A.id&&chrome.tabs.reload(A.id)},className:"px-4 py-2 bg-black text-white rounded-lg text-sm font-medium",children:"Reload Page"})]}):f.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-center max-w-sm mx-auto",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center",children:f.jsx(Ii,{className:"w-6 h-6 text-blue-600"})}),f.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"No conversation found"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Start a chat first"})]}):f.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-center max-w-sm mx-auto",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-50 flex items-center justify-center",children:f.jsx(Ii,{className:"w-6 h-6 text-amber-600"})}),f.jsx("h3",{className:"text-base font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Page not supported"}),f.jsxs("div",{className:"w-full max-w-[300px] flex flex-col gap-1",children:[f.jsx(wu,{items:["ChatGPT","Claude","OpenAI","Perplexity","Gemini","Figma","Cursor"],speed:16}),f.jsx(wu,{items:["Emergent","Rocket","Lovable","Bolt","Base44","Meta AI","MS Copilot"],speed:16,reverse:!0})]})]})}),s==="completed"&&ht&&f.jsx("div",{className:"absolute bottom-4 right-4 z-40",children:f.jsx(VI,{summary:ht,onRegenerate:cn,onReportIssue:()=>$(!0),isRegenerating:Ct,isGuest:!_e})}),!_e&&!hi&&s!=="completed"&&f.jsx(vu,{onGenerate:fs,state:s,isRegenerating:Ct,disabled:!ue||!v,includeAI:i,analyzeImages:l,isGuest:!0})]})}),f.jsxs("div",{className:Me("shrink-0 flex flex-col gap-4 pt-4 pb-2",hi&&"gap-0 pb-0"),children:[_e&&s!=="completed"&&f.jsx(vu,{onGenerate:fs,state:s,isRegenerating:Ct,disabled:!ue,includeAI:i,analyzeImages:l,isGuest:!1}),f.jsxs("div",{className:"space-y-3 px-1",children:[f.jsx(fd,{label:"Include AI responses",subtext:"Full conversation",checked:i,onChange:()=>{const A=!i;o(A),A?X.success(l?"Including AI responses & Images":"Including AI responses"):X.success(l?"Prompts & Images only":"Prompts only")}}),f.jsx(fd,{label:"Read images",subtext:"Visual context",checked:l,onChange:()=>{const A=!l;c(A),A?X.success(i?"Including AI responses & Images":"Including Images"):X.success(i?"AI responses only":"Images excluded")}})]}),f.jsxs("div",{className:"relative z-[400]",children:[f.jsxs("div",{className:"flex items-center justify-between pt-2 px-1",children:[f.jsx(Ae,{content:"Info",disabled:h==="metadata",children:f.jsx(ot,{variant:"secondary",size:"icon",className:"rounded-full w-8 h-8",onClick:()=>m("metadata"),children:f.jsx(Ii,{className:"w-4 h-4"})})}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Ae,{content:"Feedback",disabled:h==="feedback",children:f.jsx(ot,{variant:"secondary",size:"icon",className:"rounded-full w-8 h-8",onClick:()=>m("feedback"),children:f.jsx(la,{className:"w-4 h-4"})})}),f.jsx(Ae,{content:"History",side:"top",disabled:h==="history",children:f.jsx(ot,{variant:"secondary",size:"icon",className:"rounded-full w-8 h-8",onClick:()=>m("history"),children:f.jsx(du,{className:"w-4 h-4"})})}),_e&&f.jsx(Ae,{content:"Settings",disabled:h==="settings",children:f.jsx(ot,{variant:"secondary",size:"icon",className:"rounded-full w-8 h-8",onClick:()=>m("settings"),children:f.jsx(Xg,{className:"w-4 h-4"})})}),f.jsx(Ae,{content:"Help",disabled:h==="help",children:f.jsx(ot,{variant:"secondary",size:"icon",className:"rounded-full w-8 h-8",onClick:()=>m("help"),children:f.jsx(hu,{className:"w-4 h-4"})})})]})]}),h==="metadata"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-[90]",onClick:()=>m("none")}),f.jsxs("div",{className:"popup-content absolute bottom-full left-0 mb-2 z-[300] w-auto min-w-[240px] max-h-[500px] overflow-y-auto rounded-2xl shadow-xl p-4 text-sm origin-bottom-left",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},onClick:A=>A.stopPropagation(),children:[f.jsx("h3",{className:"font-semibold mb-3 text-xs",style:{color:"var(--text-primary)"},children:"Metadata"}),f.jsxs("div",{className:"space-y-2.5",style:{color:"var(--text-secondary)"},children:[f.jsxs("div",{className:"flex justify-between items-center gap-4",children:[f.jsx("span",{className:"text-xs",children:"Version"}),f.jsx("span",{className:"font-medium px-2 py-0.5 rounded text-xs",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:"v1.9.0"})]}),f.jsxs("div",{className:"flex justify-between items-center gap-4",children:[f.jsx("span",{className:"text-xs",children:"AI Engine"}),f.jsx("span",{className:"font-medium text-xs text-right",style:{color:"var(--text-primary)"},children:"GPT-4o-mini & Gemini 2.0"})]}),f.jsxs("div",{className:"flex justify-between items-center gap-4",children:[f.jsx("span",{className:"text-xs",children:"Status"}),f.jsxs("span",{className:"font-medium text-xs inline-flex items-center gap-1.5 bg-green-50 text-green-600 px-2 py-0.5 rounded-full border border-green-100",children:[f.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Active"]})]}),f.jsxs("div",{className:"flex justify-between items-center gap-4",children:[f.jsx("span",{className:"text-xs",children:"Developer"}),f.jsx("span",{className:"font-medium text-xs",style:{color:"var(--text-primary)"},children:"Bharath Amaravadhi"})]})]})]})]}),h==="history"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-[90]",onClick:()=>m("none")}),f.jsxs("div",{className:"popup-content absolute bottom-full left-1/2 -translate-x-1/2 mb-2 z-[300] w-full max-h-[500px] overflow-y-auto rounded-2xl shadow-xl p-5 text-sm",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},onClick:A=>A.stopPropagation(),children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"History"}),f.jsx("button",{onClick:fi,className:"text-[10px] font-medium text-red-500 hover:text-red-600 transition-colors",children:"Clear all"})]}),f.jsx("div",{className:"space-y-3 max-h-[250px] overflow-y-auto pr-1 custom-scrollbar",children:H.length===0?f.jsxs("div",{className:"text-center py-8",style:{color:"var(--text-tertiary)"},children:[f.jsx(du,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),f.jsx("p",{children:"No history yet"})]}):H.map(A=>f.jsxs("div",{onClick:()=>Wo(A),className:"flex flex-col gap-1 p-3 rounded-xl transition-colors cursor-pointer shrink-0",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},children:[f.jsxs("div",{className:"flex justify-between items-start",children:[f.jsx("span",{className:"font-medium text-xs line-clamp-1 capitalize",style:{color:"var(--text-primary)"},children:A.platform?`${A.platform} | ${A.type} summary`:"Summary"}),f.jsx("span",{className:"text-[10px] whitespace-nowrap ml-2",style:{color:"var(--text-tertiary)"},children:new Date(A.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),f.jsx("p",{className:"text-[10px] line-clamp-2 leading-relaxed",style:{color:"var(--text-secondary)"},children:A.preview})]},A.id))})]})]}),h==="settings"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-[90]",onClick:()=>m("none")}),f.jsxs("div",{className:"popup-content absolute bottom-full right-0 mb-2 z-[300] w-max max-h-[500px] overflow-y-auto rounded-2xl shadow-xl p-5 text-sm origin-bottom-right",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},onClick:A=>A.stopPropagation(),children:[f.jsx("h3",{className:"font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Summary Format"}),f.jsx("div",{className:"space-y-2",children:f.jsx("div",{className:"flex flex-col gap-2",children:["TXT","JSON","XML"].map(A=>f.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors",style:{border:"1px solid var(--border-primary)",backgroundColor:p===A?"var(--bg-secondary)":"transparent"},children:[f.jsx("div",{className:"w-4 h-4 rounded-full flex items-center justify-center transition-all",style:{border:`2px solid ${p===A?"var(--text-primary)":"var(--border-primary)"}`,backgroundColor:p===A?"var(--text-primary)":"transparent"},children:p===A&&f.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--bg-primary)"}})}),f.jsx("input",{type:"radio",name:"summaryType",value:A,checked:p===A,onChange:()=>{y(A),chrome.storage.local.set({summaryType:A}),X.success(`Format changed to ${A}`)},className:"hidden"}),f.jsx("span",{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:A})]},A))})})]})]}),h==="help"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-[90]",onClick:()=>m("none")}),f.jsxs("div",{className:"popup-content absolute bottom-full right-0 mb-2 z-[300] w-max max-h-[500px] overflow-y-auto rounded-2xl shadow-xl p-5 text-sm origin-bottom-right",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-primary)"},onClick:A=>A.stopPropagation(),children:[f.jsx("h3",{className:"font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Help & Support"}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("button",{onClick:()=>er("docs"),className:"flex items-center gap-3 w-full text-left transition-colors cursor-pointer p-2 rounded-lg hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},children:[f.jsx(Ii,{className:"w-4 h-4"})," Documentation"]}),f.jsxs("button",{onClick:()=>er("faqs"),className:"flex items-center gap-3 w-full text-left transition-colors cursor-pointer p-2 rounded-lg hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},children:[f.jsx(hu,{className:"w-4 h-4"})," FAQs"]}),f.jsxs("button",{onClick:()=>er("support"),className:"flex items-center gap-3 w-full text-left transition-colors cursor-pointer p-2 rounded-lg hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},children:[f.jsx(la,{className:"w-4 h-4"})," Contact Support"]})]})]})]}),f.jsx(X_,{open:h==="feedback",onOpenChange:A=>m(A?"feedback":"none"),userEmail:_e?.email})]})," "]})]}),f.jsx(NI,{open:It,onClose:()=>$(!1),summary:ht,prompts:nt}),f.jsx(kI,{isOpen:Wt,onClose:()=>ln(!1)}),f.jsx(PI,{isOpen:Un,onClose:()=>Vt(!1)})]})},LI=n=>{const e=O.useRef({light:null,dark:null}),t=O.useRef(!1);O.useEffect(()=>{(async()=>{if(!t.current)try{const r=new Image;r.src=chrome.runtime.getURL("src/assets/logo.png"),await new Promise((p,y)=>{r.onload=p,r.onerror=y});const i=128,o=document.createElement("canvas");o.width=i,o.height=i;const l=o.getContext("2d");if(!l)return;l.drawImage(r,0,0,i,i);const c=l.getImageData(0,0,i,i),h=new ImageData(new Uint8ClampedArray(c.data),i,i);for(let p=0;p<h.data.length;p+=4)h.data[p+3]>0&&(h.data[p]=0,h.data[p+1]=0,h.data[p+2]=0);e.current.light=h;const m=new ImageData(new Uint8ClampedArray(c.data),i,i);for(let p=0;p<m.data.length;p+=4)m.data[p+3]>0&&(m.data[p]=255,m.data[p+1]=255,m.data[p+2]=255);e.current.dark=m,t.current=!0,e.current[n]&&chrome.action.setIcon({imageData:e.current[n]})}catch(r){console.error("Failed to prepare dynamic icons:",r)}})()},[]),O.useEffect(()=>{t.current&&e.current[n]&&chrome.action.setIcon({imageData:e.current[n]})},[n])};function jI(){const[n,e]=O.useState(""),[t,s]=O.useState(!1),{resolvedTheme:r}=xg();LI(r);const i=o=>{e(o)};return f.jsxs("div",{className:"w-full h-screen",style:{backgroundColor:"var(--bg-primary)"},children:[f.jsx(OI,{onGenerateComplete:i,autoGenerate:t,onAutoGenerateHandled:()=>s(!1)}),f.jsx(Tg,{position:"top-center",toastOptions:{duration:1e3,style:{background:r==="dark"?"#292a2d":"#fff",color:r==="dark"?"#e8eaed":"#111",border:`1px solid ${r==="dark"?"#3c4043":"#e5e7eb"}`,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},success:{iconTheme:{primary:"#10b981",secondary:r==="dark"?"#292a2d":"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:r==="dark"?"#292a2d":"#fff"}}}})]})}yg.createRoot(document.getElementById("root")).render(f.jsx(cl.StrictMode,{children:f.jsx(jI,{})}));
