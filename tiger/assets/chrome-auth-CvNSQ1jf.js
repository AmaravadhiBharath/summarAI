import{z as f}from"./vendor-CW_Uz-VJ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();let c=null;const i=[],h=t=>new Promise((e,o)=>{chrome.identity.getAuthToken({interactive:t},s=>{chrome.runtime.lastError?o(chrome.runtime.lastError):s&&typeof s=="string"?e(s):s&&typeof s=="object"&&"token"in s?e(s.token):o(new Error("No token received"))})}),l=async t=>{const e=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to get user info");const o=await e.json();return{email:o.email,id:o.id,name:o.name,picture:o.picture}},d=async()=>{try{await u();const t=await h(!0),e=await l(t);return c=e,i.forEach(o=>o(e)),await chrome.storage.local.set({chromeUser:e,authToken:t}),e}catch(t){throw f.error("Sign In Error: "+(t.message||t)),t}},g=async()=>{try{await u(),c=null,i.forEach(t=>t(null)),await chrome.storage.local.remove(["chromeUser","authToken"])}catch{}},u=async()=>new Promise(t=>{chrome.identity.getAuthToken({interactive:!1},e=>{const o=typeof e=="string"?e:e?.token;o?chrome.identity.removeCachedAuthToken({token:o},()=>t()):t()})}),p=t=>(i.push(t),chrome.storage.local.get(["chromeUser"],e=>{e.chromeUser?(c=e.chromeUser,t(c)):t(null)}),()=>{const e=i.indexOf(t);e>-1&&i.splice(e,1)});export{d as a,u as c,g as l,p as s};
