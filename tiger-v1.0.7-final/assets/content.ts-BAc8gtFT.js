(function(){chrome.runtime.onMessage.addListener((a,s,c)=>{if(a.action==="ping")return c({pong:!0}),!0;if(a.action==="getPageContent")try{const o=h(a.includeImages);c(o)}catch(o){c({error:o.message})}return!0});function h(a=!1){const s=window.location.href,c=document.title;if(!s.startsWith("http://")&&!s.startsWith("https://"))throw new Error("Cannot summarize this page. Please use a valid website (http/https).");let o="generic",i=[],u=[];const l=r=>{if(!a)return;r.querySelectorAll("img").forEach(e=>{e.width>50&&e.height>50&&e.src&&(u.includes(e.src)||u.push(e.src))})};if(s.includes("chatgpt.com")?(o="chatgpt",document.querySelectorAll("[data-message-author-role]").forEach(t=>{const e=t.getAttribute("data-message-author-role"),n=t.innerText;e&&n&&i.push({role:e,text:n}),l(t)})):s.includes("gemini.google.com")?(o="gemini",document.querySelectorAll("user-query").forEach(e=>{const n=e.innerText?.trim();n&&n.length>2&&(i.push({role:"user",text:n}),l(e))}),document.querySelectorAll("model-response").forEach(e=>{const n=e.innerText?.trim();n&&n.length>2&&(i.push({role:"assistant",text:n}),l(e))})):s.includes("claude.ai")&&(o="claude",document.querySelectorAll(".font-user-message, .font-claude-message").forEach(t=>{const e=t.classList.contains("font-user-message");i.push({role:e?"user":"assistant",text:t.innerText}),l(t)})),i.length===0){const r=document.querySelectorAll("p, h1, h2, h3, h4, h5, li");let t="";if(r.forEach(e=>{const n=e.innerText;n&&n.length>20&&(t+=n+`

`)}),t.trim()||(t=document.body.innerText),!t||t.trim().length<50)throw new Error("No conversation content found. Please ensure you are on a valid page with content.");return l(document),{url:s,title:c,platform:"generic",conversation:[],rawText:t,images:u.slice(0,10)}}return{url:s,title:c,platform:o,conversation:i,rawText:i.map(r=>`${r.role.toUpperCase()}: ${r.text}`).join(`

`),images:u.slice(0,10)}}
})()
